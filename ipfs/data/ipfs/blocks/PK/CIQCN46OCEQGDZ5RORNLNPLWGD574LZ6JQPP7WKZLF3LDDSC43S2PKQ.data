eturn Promise.reject(new Xe(n?.errorMessage,n?.errorCode,n?.errorName));let r;const o=new Xe(n?.errorMessage,n?.errorCode,n?.errorName);try{return await Promise.race([e,new Promise(((e,n)=>{r=()=>{n(o)},t.addEventListener("abort",r)}))])}finally{null!=r&&t.removeEventListener("abort",r)}}(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach((t=>{t.deferred.resolve(e)})),this.status="complete"}catch(e){this.recipients.forEach((t=>{t.deferred.reject(e)})),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach((e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)}))}}class ut extends EventTarget{#c=new Map;constructor(){super()}listenerCount(e){const t=this.#c.get(e);return null==t?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let r=this.#c.get(e);null==r&&(r=[],this.#c.set(e,r)),r.push({callback:t,once:(!0!==n&&!1!==n&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let r=this.#c.get(e);null!=r&&(r=r.filter((({callback:e})=>e!==t)),this.#c.set(e,r))}dispatchEvent(e){const t=super.dispatchEvent(e);let n=this.#c.get(e.type);return null==n||(n=n.filter((({once:e})=>!e)),this.#c.set(e.type,n)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}}class lt extends ut{concurrency;maxSize;queue;pending;sort;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,null!=e.metricName&&e.metrics?.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=e.sort,this.queue=[]}tryToStartAnother(){if(0===this.size)return queueMicrotask((()=>{this.safeDispatchEvent("empty")})),0===this.running&&queueMicrotask((()=>{this.safeDispatchEvent("idle")})),!1;if(this.pending<this.concurrency){let e;for(const t of this.queue)if("queued"===t.status){e=t;break}return null!=e&&(this.safeDispatchEvent("active"),this.pending++,e.run().finally((()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")})),!0)}return!1}enqueue(e){this.queue.push(e),null!=this.sort&&this.queue.sort(this.sort)}async add(e,t){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new Je;const n=new at(e,t);return this.enqueue(n),this.safeDispatchEvent("add"),this.tryToStartAnother(),n.join(t).then((e=>(this.safeDispatchEvent("completed",{detail:e}),this.safeDispatchEvent("success",{detail:{job:n,result:e}}),e))).catch((e=>{if("queued"===n.status)for(let t=0;t<this.queue.length;t++)if(this.queue[t]===n){this.queue.splice(t,1);break}throw this.safeDispatchEvent("error",{detail:e}),this.safeDispatchEvent("failure",{detail:{job:n,error:e}}),e}))}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach((e=>{e.abort(new Qe)})),this.clear()}async onEmpty(e){0!==this.size&&await Ye(this,"empty",e?.signal)}async onSizeLessThan(e,t){this.size<e||await Ye(this,"next",t?.signal,{filter:()=>this.size<e})}async onIdle(e){0===this.pending&&0===this.size||await Ye(this,"idle",e?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(e){e?.signal?.throwIfAborted();const t=Ke({objectMode:!0}),n=e=>{null!=e?this.abort():this.clear(),t.end(e)},r=e=>{null!=e.detail&&t.push(e.detail)},o=e=>{n(e.detail)},i=()=>{n()},s=()=>{n(new Qe("Queue aborted"))};this.addEventListener("completed",r),this.addEventListener("error",o),this.addEventListener("idle",i),e?.signal?.addEventListener("abort",s);try{yield*t}finally{this.removeEventListener("completed",r),this.removeEventListener("error",o),this.removeEventListener("idle",i),e?.signal?.removeEventListener("abort",s),n()}}}const ct="object"===typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function ft(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function ht(e,...t){if(!((n=e)instanceof Uint8Array||null!=n&&"object"===typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");var n;if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function dt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}const pt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),gt=(e,t)=>e<<32-t|e>>>t;function yt(e){return"string"===typeof e&&(e=function(e){if("string"!==typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),ht(e),e}new Uint8Array(new Uint32Array([287454020]).buffer)[0];class mt{clone(){return this._cloneInto()}}function bt(e){const t=t=>e().update(yt(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function vt(e=32){if(ct&&"function"===typeof ct.getRandomValues)return ct.getRandomValues(new Uint8Array(e));if(ct&&"function"===typeof ct.randomBytes)return ct.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}function wt(e){if(isNaN(e)||e<=0)throw new et("random bytes length must be a Number bigger than 0");return vt(e)}var Et,At,Ct={exports:{}};Et=Ct,At=Ct.exports,function(e,t){var n={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function r(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function o(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function i(e,t){return e<<t|e>>>32-t}function s(e){return e=o(e^=e>>>16,2246822507),e=o(e^=e>>>13,3266489909),e^=e>>>16}function a(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function u(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function l(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function c(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function f(e,t){return[e[0]^t[0],e[1]^t[1]]}function h(e){return e=f(e,[0,e[0]>>>1]),e=f(e=u(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=f(e=u(e,[3301882366,444984403]),[0,e[0]>>>1])}n.x86.hash32=function(e,a){if(n.inputValidation&&!r(e))return t;a=a||0;for(var u=e.length%4,l=e.length-u,c=a,f=0,h=3432918353,d=461845907,p=0;p<l;p+=4)f=o(f=e[p]|e[p+1]<<8|e[p+2]<<16|e[p+3]<<24,h),f=o(f=i(f,15),d),c=o(c=i(c^=f,13),5)+3864292196;switch(f=0,u){case 3:f^=e[p+2]<<16;case 2:f^=e[p+1]<<8;case 1:f=o(f^=e[p],h),c^=f=o(f=i(f,15),d)}return(c=s(c^=e.length))>>>0},n.x86.hash128=function(e,a){if(n.inputValidation&&!r(e))return t;a=a||0;for(var u=e.length%16,l=e.length-u,c=a,f=a,h=a,d=a,p=0,g=0,y=0,m=0,b=597399067,v=2869860233,w=951274213,E=2716044179,A=0;A<l;A+=16)p=e[A]|e[A+1]<<8|e[A+2]<<16|e[A+3]<<24,g=e[A+4]|e[A+5]<<8|e[A+6]<<16|e[A+7]<<24,y=e[A+8]|e[A+9]<<8|e[A+10]<<16|e[A+11]<<24,m=e[A+12]|e[A+13]<<8|e[A+14]<<16|e[A+15]<<24,p=i(p=o(p,b),15),c=i(c^=p=o(p,v),19),c=o(c+=f,5)+1444728091,g=i(g=o(g,v),16),f=i(f^=g=o(g,w),17),f=o(f+=h,5)+197830471,y=i(y=o(y,w),17),h=i(h^=y=o(y,E),15),h=o(h+=d,5)+2530024501,m=i(m=o(m,E),18),d=i(d^=m=o(m,b),13),d=o(d+=c,5)+850148119;switch(p=0,g=0,y=0,m=0,u){case 15:m^=e[A+14]<<16;case 14:m^=e[A+13]<<8;case 13:m=o(m^=e[A+12],E),d^=m=o(m=i(m,18),b);case 12:y^=e[A+11]<<24;case 11:y^=e[A+10]<<16;case 10:y^=e[A+9]<<8;case 9:y=o(y^=e[A+8],w),h^=y=o(y=i(y,17),E);case 8:g^=e[A+7]<<24;case 7:g^=e[A+6]<<16;case 6:g^=e[A+5]<<8;case 5:g=o(g^=e[A+4],v),f^=g=o(g=i(g,16),w);case 4:p^=e[A+3]<<24;case 3:p^=e[A+2]<<16;case 2:p^=e[A+1]<<8;case 1:p=o(p^=e[A],b),c^=p=o(p=i(p,15),v)}return c^=e.length,c+=f^=e.length,c+=h^=e.length,f+=c+=d^=e.length,h+=c,d+=c,c=s(c),c+=f=s(f),c+=h=s(h),f+=c+=d=s(d),h+=c,d+=c,("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(f>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)},n.x64.hash128=function(e,o){if(n.inputValidation&&!r(e))return t;o=o||0;for(var i=e.length%16,s=e.length-i,d=[0,o],p=[0,o],g=[0,0],y=[0,0],m=[2277735313,289559509],b=[1291169091,658871167],v=0;v<s;v+=16)g=[e[v+4]|e[v+5]<<8|e[v+6]<<16|e[v+7]<<24,e[v]|e[v+1]<<8|e[v+2]<<16|e[v+3]<<24],y=[e[v+12]|e[v+13]<<8|e[v+14]<<16|e[v+15]<<24,e[v+8]|e[v+9]<<8|e[v+10]<<16|e[v+11]<<24],g=l(g=u(g,m),31),d=a(d=l(d=f(d,g=u(g,b)),27),p),d=a(u(d,[0,5]),[0,1390208809]),y=l(y=u(y,b),33),p=a(p=l(p=f(p,y=u(y,m)),31),d),p=a(u(p,[0,5]),[0,944331445]);switch(g=[0,0],y=[0,0],i){case 15:y=f(y,c([0,e[v+14]],48));case 14:y=f(y,c([0,e[v+13]],40));case 13:y=f(y,c([0,e[v+12]],32));case 12:y=f(y,c([0,e[v+11]],24));case 11:y=f(y,c([0,e[v+10]],16));case 10:y=f(y,c([0,e[v+9]],8));case 9:y=u(y=f(y,[0,e[v+8]]),b),p=f(p,y=u(y=l(y,33),m));case 8:g=f(g,c([0,e[v+7]],56));case 7:g=f(g,c([0,e[v+6]],48));case 6:g=f(g,c([0,e[v+5]],40));case 5:g=f(g,c([0,e[v+4]],32));case 4:g=f(g,c([0,e[v+3]],24));case 3:g=f(g,c([0,e[v+2]],16));case 2:g=f(g,c([0,e[v+1]],8));case 1:g=u(g=f(g,[0,e[v]]),m),d=f(d,g=u(g=l(g,31),b))}return d=a(d=f(d,[0,e.length]),p=f(p,[0,e.length])),p=a(p,d),d=a(d=h(d),p=h(p)),p=a(p,d),("00000000"+(d[0]>>>0).toString(16)).slice(-8)+("00000000"+(d[1]>>>0).toString(16)).slice(-8)+("00000000"+(p[0]>>>0).toString(16)).slice(-8)+("00000000"+(p[1]>>>0).toString(16)).slice(-8)},Et.exports&&(At=Et.exports=n),At.murmurHash3=n}();var St=Ct.exports;const Tt=(0,h.g)(St),kt=Symbol.for("@achingbrain/uint8arraylist");function xt(e,t){if(null==t||t<0)throw new RangeError("index is out of bounds");let n=0;for(const r of e){const e=n+r.byteLength;if(t<e)return{buf:r,index:t-n};n=e}throw new RangeError("index is out of bounds")}function It(e){return Boolean(e?.[kt])}class Ot{bufs;length;[kt]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else{if(!It(n))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");t+=n.byteLength,this.bufs.push(...n.bufs)}this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else{if(!It(n))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");t+=n.byteLength,this.bufs.unshift(...n.bufs)}this.length+=t}get(e){const t=xt(this.bufs,e);return t.buf[t.index]}set(e,t){const n=xt(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else{if(!It(e))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let n=0;n<e.length;n++)this.set(t+n,e.get(n))}}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength)return this.bufs=[],void(this.length=0);for(;this.bufs.length>0;){if(!(e>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}}slice(e,t){const{bufs:n,length:r}=this._subList(e,t);return ee(n,r)}subarray(e,t){const{bufs:n,length:r}=this._subList(e,t);return 1===n.length?n[0]:ee(n,r)}sublist(e,t){const{bufs:n,length:r}=this._subList(e,t),o=new Ot;return o.length=r,o.bufs=[...n],o}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let r=0;for(let o=0;o<this.bufs.length;o++){const i=this.bufs[o],s=r,a=s+i.byteLength;if(r=a,e>=a)continue;const u=e>=s&&e<a,l=t>s&&t<=a;if(u&&l){if(e===s&&t===a){n.push(i);break}const r=e-s;n.push(i.subarray(r,r+(t-e)));break}if(u){if(0===e){n.push(i);continue}n.push(i.subarray(e-s))}else{if(l){if(t===a){n.push(i);break}n.push(i.subarray(0,t-s));break}n.push(i)}}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!It(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const r=n.byteLength;if(0===r)throw new TypeError("search must be at least 1 byte long");const o=new Int32Array(256);for(let l=0;l<256;l++)o[l]=-1;for(let l=0;l<r;l++)o[n[l]]=l;const i=o,s=this.byteLength-n.byteLength,a=n.byteLength-1;let u;for(let l=t;l<=s;l+=u){u=0;for(let e=a;e>=0;e--){const t=this.get(l+e);if(n[e]!==t){u=Math.max(1,e-i[t]);break}}if(0===u)return l}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=(0,Q.K)(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const r=(0,Q.c)(2);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt16(0,t,n),this.write(r,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const r=(0,Q.c)(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt32(0,t,n),this.write(r,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const r=(0,Q.c)(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setBigInt64(0,t,n),this.write(r,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=(0,Q.K)(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const r=(0,Q.c)(2);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint16(0,t,n),this.write(r,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const r=(0,Q.c)(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint32(0,t,n),this.write(r,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const r=(0,Q.c)(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setBigUint64(0,t,n),this.write(r,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const r=(0,Q.c)(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setFloat32(0,t,n),this.write(r,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const r=(0,Q.c)(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setFloat64(0,t,n),this.write(r,e)}equals(e){if(null==e)return!1;if(!(e instanceof Ot))return!1;if(e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Z(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Ot;return n.bufs=e,null==t&&(t=e.reduce(((e,t)=>e+t.byteLength),0)),n.length=t,n}}const Bt=Math.LN2*Math.LN2;class Dt{static create(e,t=.005){const n=function(e,t=.005){const n=Math.round(-1*e*Math.log(t)/Bt),r=Math.round(n/e*Math.LN2);return{bits:n,hashes:r}}(e,t);return new Dt(n)}seeds;bits;buffer;constructor(e={}){null!=e.seeds?this.seeds=e.seeds:this.seeds=function(e){let t,n;const r=[];for(let o=0;o<e;o++)for(t=new Ot(wt(4)),r[o]=t.getUint32(0,!0),n=0;n<o;n++)if(r[o]===r[n]){o--;break}return r}(e.hashes??8),this.bits=e.bits??1024,this.buffer=(0,Q.c)(Math.ceil(this.bits/8))}add(e){"string"===typeof e&&(e=(0,oe.s)(e));for(let t=0;t<this.seeds.length;t++){const n=Tt.x86.hash32(e,this.seeds[t])%this.bits;this.setbit(n)}}has(e){"string"===typeof e&&(e=(0,oe.s)(e));for(let t=0;t<this.seeds.length;t++){const n=Tt.x86.hash32(e,this.seeds[t])%this.bits;if(!this.getbit(n))return!1}return!0}clear(){this.buffer.fill(0)}setbit(e){let t=0,n=e;for(;n>7;)t++,n-=8;let r=this.buffer[t];r|=1<<n,this.buffer[t]=r}getbit(e){let t=0,n=e;for(;n>7;)t++,n-=8;return 0!==(this.buffer[t]&1<<n)}}class Nt extends Error{static name="InsufficientProvidersError";constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}class Pt extends Error{static name="NoRoutersAvailableError";constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}class Ft extends Error{static name="UnknownHashAlgorithmError";constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}class _t extends Error{static name="UnknownCodecError";constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}class Lt extends ut{intialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;constructor(e,t){super(),this.name=t.name,this.logger=e.logger,this.log=e.logger.forComponent(this.name),this.requests=new Map,this.minProviders=t.minProviders??1,this.maxProviders=t.maxProviders??5,this.providers=[],this.evictionFilter=Dt.create(this.maxProviders)}async retrieve(e,t={}){const n=m.base64.encode(e.multihash.bytes),r=this.requests.get(n);if(null!=r)return this.log("join existing request for %c",e),r;const o=Ve();if(this.requests.set(n,o.promise),0===this.providers.length){let n=!1;null==this.intialPeerSearchComplete&&(n=!0,this.log=this.logger.forComponent(`${this.name}:${e}`),this.intialPeerSearchComplete=this.findProviders(e,this.minProviders,t)),await this.intialPeerSearchComplete,n&&this.log("found initial session peers for %c",e)}let i=!1;const s=new lt({concurrency:this.maxProviders});s.addEventListener("error",(()=>{})),s.addEventListener("failure",(e=>{this.log.error("error querying provider %o, evicting from session",e.detail.job.options.provider,e.detail.error),this.evict(e.detail.job.options.provider)})),s.addEventListener("success",(e=>{i=!0,o.resolve(e.detail.result)})),s.addEventListener("idle",(()=>{i||!0===t.signal?.aborted||Promise.resolve().then((async()=>{this.log("no session peers had block for for %c, finding new providers",e);for(let e=0;e<this.minProviders&&0!==this.providers.length;e++){const e=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(e)}await this.findProviders(e,this.minProviders,t),this.log("found new providers re-retrieving %c",e),this.requests.delete(n),o.resolve(await this.retrieve(e,t))})).catch((t=>{this.log.error("could not find new providers for %c",e,t),o.reject(t)}))}));const a=n=>{s.add((async()=>this.queryProvider(e,n.detail,t)),{provider:n.detail}).catch((n=>{!0!==t.signal?.aborted&&this.log.error("error retrieving session block for %c",e,n)}))};this.addEventListener("provider",a),Promise.all([...this.providers].map((async n=>s.add((async()=>this.queryProvider(e,n,t)),{provider:n})))).catch((n=>{!0!==t.signal?.aborted&&this.log.error("error retrieving session block for %c",e,n)}));try{return await o.promise}finally{this.removeEventListener("provider",a),s.clear(),this.requests.delete(n)}}evict(e){this.evictionFilter.add(this.toEvictionKey(e));const t=this.providers.findIndex((t=>this.equals(t,e)));-1!==t&&this.providers.splice(t,1)}isEvicted(e){return this.evictionFilter.has(this.toEvictionKey(e))}hasProvider(e){return null!=this.providers.find((t=>this.equals(t,e)))||!!this.isEvicted(e)}async findProviders(e,t,n){const r=Ve();let o=0;return Promise.resolve().then((async()=>{this.log("finding %d-%d new provider(s) for %c",t,this.maxProviders,e);for await(const i of this.findNewProviders(e,n)){if(o===this.maxProviders||!0===n.signal?.aborted)break;if(!this.hasProvider(i)&&(this.log("found %d/%d new providers",o,this.maxProviders),this.providers.push(i),this.safeDispatchEvent("provider",{detail:i}),o++,o===t&&(this.log("session is ready"),r.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",o);break}}if(this.log("found %d/%d new session peers",o,this.maxProviders),o<t)throw new Nt(`Found ${o} of ${t} ${this.name} providers for ${e}`)})).catch((t=>{this.log.error("error searching routing for potential session peers for %c",e,t.errors??t),r.reject(t)})),r.promise}}class Rt extends Lt{routing;allowInsecure;allowLocal;constructor(e,t){super(e,{...t,name:"helia:trustless-gateway:session"}),this.routing=e.routing,this.allowInsecure=t.allowInsecure??Mt,this.allowLocal=t.allowLocal??jt}async queryProvider(e,t,n){this.log("fetching BLOCK for %c from %s",e,t.url);const r=await t.getRawBlock(e,n.signal);return this.log.trace("got block for %c from %s",e,t.url),await(n.validateFn?.(r)),r}async*findNewProviders(e,t={}){yield*ze(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,t)}toEvictionKey(e){return e.url.toString()}equals(e,t){return e.url.toString()===t.url.toString()}}class Ut{allowInsecure;allowLocal;routing;log;logger;constructor(e,t={}){this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??Mt,this.allowLocal=t.allowLocal??jt}async retrieve(e,t={}){const n=[];for await(const o of ze(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,t)){this.log("getting block for %c from %s",e,o.url);try{const n=await o.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,o.url);try{await(t.validateFn?.(n))}catch(r){this.log.error("failed to validate block for %c from %s",e,o.url,r);continue}return n}catch(r){if(this.log.error("failed to get block for %c from %s",e,o.url,r),r instanceof Error?n.push(r):n.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${o.url}`)),!0===t.signal?.aborted){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,o.url);break}}}throw n.length>0?new AggregateError(n,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return t={logger:this.logger,routing:this.routing},n={...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure},new Rt(t,n);var t,n}}const Mt=!1,jt=!1;function $t(e={}){return t=>new Ut(t,e)}const Ht=1e3,zt=60*Ht,Vt=60*zt,Gt=24*Vt,Wt=7*Gt,qt=365.25*Gt;function Kt(e,t){try{if("string"===typeof e&&e.length>0)return function(e){if((e=String(e)).length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return NaN;const n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*qt;case"weeks":case"week":case"w":return n*Wt;case"days":case"day":case"d":return n*Gt;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Vt;case"minutes":case"minute":case"mins":case"min":case"m":return n*zt;case"seconds":case"second":case"secs":case"sec":case"s":return n*Ht;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:throw new Error(`The unit ${r} was matched, but no matching case exists.`)}}(e);if("number"===typeof e&&isFinite(e))return t?.long?function(e){const t=Math.abs(e);if(t>=Gt)return Zt(e,t,Gt,"day");if(t>=Vt)return Zt(e,t,Vt,"hour");if(t>=zt)return Zt(e,t,zt,"minute");if(t>=Ht)return Zt(e,t,Ht,"second");return`${e} ms`}(e):function(e){const t=Math.abs(e);if(t>=Gt)return`${Math.round(e/Gt)}d`;if(t>=Vt)return`${Math.round(e/Vt)}h`;if(t>=zt)return`${Math.round(e/zt)}m`;if(t>=Ht)return`${Math.round(e/Ht)}s`;return`${e}ms`}(e);throw new Error("Value is not a string or number.")}catch(n){const t=function(e){return"object"===typeof e&&null!==e&&"message"in e}(n)?`${n.message}. value=${JSON.stringify(e)}`:"An unknown error has occured.";throw new Error(t)}}function Zt(e,t,n,r){const o=t>=1.5*n;return`${Math.round(e/n)} ${r}${o?"s":""}`}const Yt=function(){try{return localStorage}catch(e){}}();const Jt=console.debug??console.log??(()=>{});const Xt=function(e){function t(e){let r,o,i,s=null;function a(...e){if(!a.enabled)return;const n=a,o=Number(new Date),i=o-(r||o);n.diff=i,n.prev=r,n.curr=o,r=o,e[0]=t.coerce(e[0]),"string"!==typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,o)=>{if("%%"===r)return"%";s++;const i=t.formatters[o];if("function"===typeof i){const t=e[s];r=i.call(n,t),e.splice(s,1),s--}return r})),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i),set:e=>{s=e}}),"function"===typeof t.init&&t.init(a),a}function n(e,n){const r=t(this.namespace+("undefined"===typeof n?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack??e.message;return e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"===typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Kt,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.setupFormatters(t.formatters),t.enable(t.load()),t}({formatArgs:function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Kt(this.diff),!this.useColors)return;const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(r=n))})),e.splice(r,0,t)},save:function(e){try{e?Yt?.setItem("debug",e):Yt?.removeItem("debug")}catch(t){}},load:function(){let e;try{e=Yt?.getItem("debug")}catch(t){}return!e&&"undefined"!==typeof globalThis.process&&"env"in globalThis.process&&(e=globalThis.process.env.DEBUG),e},useColors:function(){return!("undefined"===typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"===typeof navigator||null==navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!==typeof document&&document.documentElement?.style?.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&null!=navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/))},setupFormatters:function(e){e.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],storage:Yt,log:Jt});function Qt(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return Xt.enabled(`${e}:trace`)&&null!=Xt.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=Xt(`${e}:trace`)),Object.assign(Xt(e),{error:Xt(`${e}:error`),trace:t})}Xt.formatters.b=e=>null==e?"undefined":y.base58btc.baseEncode(e),Xt.formatters.t=e=>null==e?"undefined":te.base32.baseEncode(e),Xt.formatters.m=e=>null==e?"undefined":m.base64.baseEncode(e),Xt.formatters.p=e=>null==e?"undefined":e.toString(),Xt.formatters.c=e=>null==e?"undefined":e.toString(),Xt.formatters.k=e=>null==e?"undefined":e.toString(),Xt.formatters.a=e=>null==e?"undefined":e.toString(),Xt.formatters.e=e=>null==e?"undefined":e.stack??e.message;class en extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}}var tn={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,s){if("function"!==typeof r)throw new TypeError("The listener must be a function");var a=new o(r,i||e,s),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],a]:e._events[u].push(a):(e._events[u]=a,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,o=[];if(0===this._eventsCount)return o;for(r in e=this._events)t.call(e,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,s=new Array(i);o<i;o++)s[o]=r[o].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,o,i,s){var a=n?n+e:e;if(!this._events[a])return!1;var u,l,c=this._events[a],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,o),!0;case 5:return c.fn.call(c.context,t,r,o,i),!0;case 6:return c.fn.call(c.context,t,r,o,i,s),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,d=c.length;for(l=0;l<d;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,o);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},a.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,o){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||o&&!a.once||r&&a.context!==r||s(this,i);else{for(var u=0,l=[],c=a.length;u<c;u++)(a[u].fn!==t||o&&!a[u].once||r&&a[u].context!==r)&&l.push(a[u]);l.length?this._events[i]=1===l.length?l[0]:l:s(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a}(tn);var nn=tn.exports;const rn=(0,h.g)(nn);class on extends Error{constructor(e){super(e),this.name="TimeoutError"}}class sn extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const an=e=>void 0===globalThis.DOMException?new sn(e):new DOMException(e),un=e=>{const t=void 0===e.reason?an("This operation was aborted."):e.reason;return t instanceof Error?t:an(t)};function ln(e,t){const{milliseconds:n,fallback:r,message:o,customTimers:i={setTimeout:setTimeout,clearTimeout:clearTimeout}}=t;let s;const a=new Promise(((a,u)=>{if("number"!==typeof n||1!==Math.sign(n))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${n}\``);if(t.signal){const{signal:n}=t;n.aborted&&u(un(n));const r=()=>{u(un(n))};n.addEventListener("abort",r,{once:!0}),e.finally((()=>{n.removeEventListener("abort",r)}))}if(n===Number.POSITIVE_INFINITY)return void e.then(a,u);const l=new on;s=i.setTimeout.call(void 0,(()=>{if(r)try{a(r())}catch(t){u(t)}else"function"===typeof e.cancel&&e.cancel(),!1===o?a():o instanceof Error?u(o):(l.message=o??`Promise timed out after ${n} milliseconds`,u(l))}),n),(async()=>{try{a(await e)}catch(t){u(t)}})()})).finally((()=>{a.clear()}));return a.clear=()=>{i.clearTimeout.call(void 0,s),s=void 0},a}class cn{#f=[];enqueue(e,t){const n={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&this.#f[this.size-1].priority>=t.priority)return void this.#f.push(n);const r=function(e,t,n){let r=0,o=e.length;for(;o>0;){const i=Math.trunc(o/2);let s=r+i;n(e[s],t)<=0?(r=++s,o-=i+1):o=i}return r}(this.#f,n,((e,t)=>t.priority-e.priority));this.#f.splice(r,0,n)}dequeue(){const e=this.#f.shift();return e?.run}filter(e){return this.#f.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this.#f.length}}class fn extends rn{#h;#d;#p=0;#g;#y;#m=0;#b;#v;#f;#w;#E=0;#A;#C;#S;timeout;constructor(e){if(super(),!("number"===typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:cn,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#h=e.carryoverConcurrencyCount,this.#d=e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,this.#g=e.intervalCap,this.#y=e.interval,this.#f=new e.queueClass,this.#w=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#S=!0===e.throwOnTimeout,this.#C=!1===e.autoStart}get#T(){return this.#d||this.#p<this.#g}get#k(){return this.#E<this.#A}#x(){this.#E--,this.#I(),this.emit("next")}#O(){this.#B(),this.#D(),this.#v=void 0}get#N(){const e=Date.now();if(void 0===this.#b){const t=this.#m-e;if(!(t<0))return void 0===this.#v&&(this.#v=setTimeout((()=>{this.#O()}),t)),!0;this.#p=this.#h?this.#E:0}return!1}#I(){if(0===this.#f.size)return this.#b&&clearInterval(this.#b),this.#b=void 0,this.emit("empty"),0===this.#E&&this.emit("idle"),!1;if(!this.#C){const e=!this.#N;if(this.#T&&this.#k){const t=this.#f.dequeue();return!!t&&(this.emit("active"),t(),e&&this.#D(),!0)}}return!1}#D(){this.#d||void 0!==this.#b||(this.#b=setInterval((()=>{this.#B()}),this.#y),this.#m=Date.now()+this.#y)}#B(){0===this.#p&&0===this.#E&&this.#b&&(clearInterval(this.#b),this.#b=void 0),this.#p=this.#h?this.#E:0,this.#P()}#P(){for(;this.#I(););}get concurrency(){return this.#A}set concurrency(e){if(!("number"===typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#A=e,this.#P()}async#F(e){return new Promise(((t,n)=>{e.addEventListener("abort",(()=>{n(e.reason)}),{once:!0})}))}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:this.#S,...t},new Promise(((n,r)=>{this.#f.enqueue((async()=>{this.#E++,this.#p++;try{t.signal?.throwIfAborted();let r=e({signal:t.signal});t.timeout&&(r=ln(Promise.resolve(r),{milliseconds:t.timeout})),t.signal&&(r=Promise.race([r,this.#F(t.signal)]));const o=await r;n(o),this.emit("completed",o)}catch(o){if(o instanceof on&&!t.throwOnTimeout)return void n();r(o),this.emit("error",o)}finally{this.#x()}}),t),this.emit("add"),this.#I()}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this.#C?(this.#C=!1,this.#P(),this):this}pause(){this.#C=!0}clear(){this.#f=new this.#w}async onEmpty(){0!==this.#f.size&&await this.#_("empty")}async onSizeLessThan(e){this.#f.size<e||await this.#_("next",(()=>this.#f.size<e))}async onIdle(){0===this.#E&&0===this.#f.size||await this.#_("idle")}async#_(e,t){return new Promise((n=>{const r=()=>{t&&!t()||(this.off(e,r),n())};this.on(e,r)}))}get size(){return this.#f.size}sizeBy(e){return this.#f.filter(e).length}get pending(){return this.#E}get isPaused(){return this.#C}}function hn(e){const t=[vn.A];return null==e?t:Array.isArray(e)?0===e.length?t:e:[e]}function dn(e){return{Status:e.Status??0,TC:e.TC??e.flag_tc??!1,RD:e.RD??e.flag_rd??!1,RA:e.RA??e.flag_ra??!1,AD:e.AD??e.flag_ad??!1,CD:e.CD??e.flag_cd??!1,Question:(e.Question??e.questions??[]).map((e=>({name:e.name,type:vn[e.type]}))),Answer:(e.Answer??e.answers??[]).map((e=>({name:e.name,type:vn[e.type],TTL:e.TTL??e.ttl??60,data:e.data instanceof Uint8Array?J(e.data):e.data})))}}function pn(e,t={}){const n=new fn({concurrency:t.queryConcurrency??4});return async(t,r={})=>{const o=new URLSearchParams;o.set("name",t),hn(r.types).forEach((e=>{o.append("type",vn[e])})),r.onProgress?.(new en("dns:query",{detail:t}));const i=await n.add((async()=>{const t=await fetch(`${e}?${o}`,{headers:{accept:"application/dns-json"},signal:r?.signal});if(200!==t.status)throw new Error(`Unexpected HTTP status: ${t.status} - ${t.statusText}`);const n=dn(await t.json());return r.onProgress?.(new en("dns:response",{detail:n})),n}),{signal:r.signal});if(null==i)throw new Error("No DNS response received");return i}}var gn=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,n=Object.create(null),r=Object.create(null);function o(o,i){n[o]=i,++t>=e&&(t=0,r=n,n=Object.create(null))}return{has:function(e){return void 0!==n[e]||void 0!==r[e]},remove:function(e){void 0!==n[e]&&(n[e]=void 0),void 0!==r[e]&&(r[e]=void 0)},get:function(e){var t=n[e];return void 0!==t?t:void 0!==(t=r[e])?(o(e,t),t):void 0},set:function(e,t){void 0!==n[e]?n[e]=t:o(e,t)},clear:function(){n=Object.create(null),r=Object.create(null)}}};const yn=(0,h.g)(gn);class mn{lru;constructor(e){this.lru=yn(e)}get(e,t){let n=!0;const r=[];for(const o of t){const t=this.getAnswers(e,o);if(0===t.length){n=!1;break}r.push(...t)}if(n)return dn({answers:r})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,r=this.lru.get(n);if(null!=r){const e=r.filter((e=>e.expires>Date.now())).map((({expires:e,value:t})=>({...t,TTL:Math.round((e-Date.now())/1e3),type:vn[t.type]})));return 0===e.length&&this.lru.remove(n),e}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,r=this.lru.get(n)??[];r.push({expires:Date.now()+1e3*(t.TTL??60),value:t}),this.lru.set(n,r)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}class bn{resolvers;cache;constructor(e){var t;this.resolvers={},this.cache=(t=e.cacheSize??1e3,new mn(t)),Object.entries(e.resolvers??{}).forEach((([e,t])=>{Array.isArray(t)||(t=[t]),e.endsWith(".")||(e=`${e}.`),this.resolvers[e]=t})),null==this.resolvers["."]&&(this.resolvers["."]=[pn("https://cloudflare-dns.com/dns-query"),pn("https://dns.google/resolve")])}async query(e,t={}){const n=hn(t.types),r=!1!==t.cached?this.cache.get(e,n):void 0;if(null!=r)return t.onProgress?.(new en("dns:cache",{detail:r})),r;const o=`${e.split(".").pop()}.`,i=(this.resolvers[o]??this.resolvers["."]).sort((()=>Math.random()>.5?-1:1)),s=[];for(const u of i){if(!0===t.signal?.aborted)break;try{const r=await u(e,{...t,types:n});for(const t of r.Answer)this.cache.add(e,t);return r}catch(a){s.push(a),t.onProgress?.(new en("dns:error",{detail:a}))}}if(1===s.length)throw s[0];throw new AggregateError(s,`DNS lookup of ${e} ${n} failed`)}}var vn;function wn(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);}!function(e){e[e.A=1]="A",e[e.CNAME=5]="CNAME",e[e.TXT=16]="TXT",e[e.AAAA=28]="AAAA"}(vn||(vn={}));var En=n(2538),An=n(1625);n(8666);const Cn="/",Sn=(new TextEncoder).encode(Cn),Tn=Sn[0];class kn{_buf;constructor(e,t){if("string"===typeof e)this._buf=(0,oe.s)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==Tn)throw new Error("Invalid key")}toString(e="utf8"){return J(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new kn(e.join(Cn))}static random(){return new kn(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||"string"===typeof e?new kn(e):"function"===typeof e.uint8Array?new kn(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=Sn),this._buf[0]!==Tn){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Tn,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Tn;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let r=0;r<t.length;r++){if(n.length<r+1)return!1;const e=t[r],o=n[r];if(e<o)return!0;if(e>o)return!1}return t.length<n.length}reverse(){return kn.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Cn).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new kn(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Cn)||(e+=Cn),e+=this.type(),new kn(e)}parent(){const e=this.list();return 1===e.length?new kn(Cn):new kn(e.slice(0,-1).join(Cn))}child(e){return this.toString()===Cn?e:e.toString()===Cn?this:new kn(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return kn.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}var xn=n(9956);function In({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*On(e,t){if(null!=t&&"object"===typeof t)if(Array.isArray(t))for(const[n,r]of t.entries()){const t=[...e,n],o=K.T.asCID(r);null!=o?yield[t.join("/"),o]:"object"===typeof r&&(yield*Bn(r,t))}else{const n=K.T.asCID(t);null!=n?yield[e.join("/"),n]:yield*Bn(t,e)}}function*Bn(e,t){if(null==e||e instanceof Uint8Array)return;const n=K.T.asCID(e);null!=n&&(yield[t.join("/"),n]);for(const[r,o]of Object.entries(e)){const e=[...t,r];yield*On(e,o)}}function*Dn(e,t){if(Array.isArray(t))for(const[n,r]of t.entries()){const t=[...e,n];yield t.join("/"),"object"===typeof r&&null==K.T.asCID(r)&&(yield*Nn(r,t))}else yield*Nn(t,e)}function*Nn(e,t){if(null!=e&&"object"===typeof e)for(const[n,r]of Object.entries(e)){const e=[...t,n];yield e.join("/"),null==r||r instanceof Uint8Array||"object"!==typeof r||null!=K.T.asCID(r)||(yield*Dn(e,r))}}class Pn{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:n}){if(null==e||null==t||"undefined"===typeof n)throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:In(),bytes:In(),value:In(),asBlock:In()})}links(){return Bn(this.value,[])}tree(){return Nn(this.value,[])}get(e="/"){return function(e,t){let n=e;for(const[r,o]of t.entries()){if(n=n[o],null==n)throw new Error(`Object has no property at ${t.slice(0,r+1).map((e=>`[${JSON.stringify(e)}]`)).join("")}`);const e=K.T.asCID(n);if(null!=e)return{value:e,remaining:t.slice(r+1).join("/")}}return{value:n}}(this.value,e.split("/").filter(Boolean))}}const Fn="/pin/",_n="/pinned-block/",Ln=xn.base36;function Rn(e){return 0===e.version&&(e=e.toV1()),new kn(`${Fn}${e.toString(Ln)}`)}class Un{datastore;blockstore;getCodec;constructor(e,t,n){this.datastore=e,this.blockstore=t,this.getCodec=n}async*add(e,t={}){const n=Rn(e);if(await this.datastore.has(n))throw new Error("Already pinned");const r=Math.round(t.depth??1/0);if(r<0)throw new Error("Depth must be greater than or equal to 0");const o=new lt({concurrency:1});for await(const s of this.#L(e,o,{...t,depth:r}))await this.#R(s,(t=>null==t.pinnedBy.find((t=>Z(t,e.bytes)))&&(t.pinCount++,t.pinnedBy.push(e.bytes),!0)),t),yield s;const i={depth:r,metadata:t.metadata??{}};await this.datastore.put(n,(0,En.lF)(i),t)}async*#L(e,t,n){if(-1===n.depth)return;const r=await this.getCodec(e.code),o=function({bytes:e,cid:t,value:n,codec:r}){const o=void 0!==n?n:r?.decode(e);if(void 0===o)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Pn({cid:t,bytes:e,value:o})}({bytes:await this.blockstore.get(e,n),cid:e,codec:r});yield e;for await(const[,i]of o.links())yield*await t.add((async()=>this.#L(i,t,{...n,depth:n.depth-1})))}async#R(e,t,n){const r=new kn(`${_n}${Ln.encode(e.multihash.bytes)}`);let o={pinCount:0,pinnedBy:[]};try{o=(0,An.D4)(await this.datastore.get(r,n))}catch(i){if("NotFoundError"!==i.name)throw i}t(o)&&(0===o.pinCount&&await this.datastore.has(r)?await this.datastore.delete(r):(await this.datastore.put(r,(0,En.lF)(o),n),n.onProgress?.(new en("helia:pin:add",e))))}async*rm(e,t={}){const n=Rn(e),r=await this.datastore.get(n,t),o=(0,An.D4)(r);await this.datastore.delete(n,t);const i=new lt({concurrency:1});for await(const s of this.#L(e,i,{...t,depth:o.depth}))await this.#R(s,(t=>(t.pinCount--,t.pinnedBy=t.pinnedBy.filter((t=>Z(t,e.bytes))),!0)),{...t,depth:o.depth}),yield s}async*ls(e={}){for await(const{key:t,value:n}of this.datastore.query({prefix:Fn+(null!=e.cid?`${e.cid.toString(xn.base36)}`:"")},e)){const e=K.T.parse(t.toString().substring(5),xn.base36),r=(0,An.D4)(n);yield{cid:e,...r}}}async isPinned(e,t={}){const n=new kn(`${_n}${Ln.encode(e.multihash.bytes)}`);return this.datastore.has(n,t)}async get(e,t){const n=Rn(e),r=await this.datastore.get(n,t);return(0,An.D4)(r)}async setMetadata(e,t,n){const r=Rn(e),o=await this.datastore.get(r,n),i=(0,An.D4)(o);i.metadata=t??{},await this.datastore.put(r,(0,En.lF)(i),n)}}class Mn extends lt{has(e){return null!=this.find(e)}find(e){return this.queue.find((t=>e.equals(t.options.peerId)))}}function jn(...e){const t=[];for(const n of e)null==n[Symbol.asyncIterator]&&t.push(n);return t.length===e.length?function*(){for(const e of t)yield*e}():async function*(){const t=Ke({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(e.map((async e=>{for await(const n of e)t.push(n)}))),t.end()}catch(n){t.end(n)}})),yield*t}()}function $n(e){return null!=e&&"function"===typeof e.start&&"function"===typeof e.stop}async function Hn(...e){const t=[];for(const n of e)$n(n)&&t.push(n);await Promise.all(t.map((async e=>{null!=e.beforeStart&&await e.beforeStart()}))),await Promise.all(t.map((async e=>{await e.start()}))),await Promise.all(t.map((async e=>{null!=e.afterStart&&await e.afterStart()})))}async function zn(...e){const t=[];for(const n of e)$n(n)&&t.push(n);await Promise.all(t.map((async e=>{null!=e.beforeStop&&await e.beforeStop()}))),await Promise.all(t.map((async e=>{await e.stop()}))),await Promise.all(t.map((async e=>{null!=e.afterStop&&await e.afterStop()})))}class Vn{log;routers;providerLookupConcurrency;constructor(e,t){this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??5}async start(){await Hn(...this.routers)}async stop(){await zn(...this.routers)}async*findProviders(e,t={}){if(0===this.routers.length)throw new Pt("No content routers available");const n=new Mn({concurrency:this.providerLookupConcurrency});n.addEventListener("error",(()=>{}));for await(const r of jn(n.toGenerator(),...Gn(this.routers,"findProviders").map((n=>n.findProviders(e,t)))))if(null!=r){if(0===r.multiaddrs.length){if(null!=n.find(r.id))continue;n.add((async()=>{try{const e=await this.findPeer(r.id,t);return 0===e.multiaddrs.length?null:e}catch(e){return this.log.error("could not load multiaddrs for peer %p",r.id,e),null}}),{peerId:r.id,signal:t.signal}).catch((e=>{this.log.error("could not load multiaddrs for peer %p",r.id,e)}))}yield r}}async provide(e,t={}){if(0===this.routers.length)throw new Pt("No content routers available");await Promise.all(Gn(this.routers,"provide").map((async n=>{await n.provide(e,t)})))}async put(e,t,n){await Promise.all(Gn(this.routers,"put").map((async r=>{await r.put(e,t,n)})))}async get(e,t){return Promise.any(Gn(this.routers,"get").map((async n=>n.get(e,t))))}async findPeer(e,t){if(0===this.routers.length)throw new Pt("No peer routers available");const n=this,r=jn(...Gn(this.routers,"findPeer").map((r=>async function*(){try{yield await r.findPeer(e,t)}catch(o){n.log.error(o)}}())));for await(const o of r)if(null!=o)return o;throw new nt("Could not find peer in routing")}async*getClosestPeers(e,t={}){if(0===this.routers.length)throw new Pt("No peer routers available");for await(const n of jn(...Gn(this.routers,"getClosestPeers").map((n=>n.getClosestPeers(e,t)))))null!=n&&(yield n)}}function Gn(e,t){return e.filter((e=>null!=e[t]))}const Wn={},qn=e=>{e.addEventListener("message",(t=>{qn.dispatchEvent("message",e,t)})),null!=e.port&&e.port.addEventListener("message",(t=>{qn.dispatchEvent("message",e,t)}))};qn.addEventListener=(e,t)=>{null==Wn[e]&&(Wn[e]=[]),Wn[e].push(t)},qn.removeEventListener=(e,t)=>{null!=Wn[e]&&(Wn[e]=Wn[e].filter((e=>e===t)))},qn.dispatchEvent=function(e,t,n){null!=Wn[e]&&Wn[e].forEach((e=>e(t,n)))};const Kn="lock:worker:request-read",Zn="lock:worker:release-read",Yn="lock:master:grant-read",Jn="lock:worker:request-write",Xn="lock:worker:release-write",Qn="lock:master:grant-write",er=(e,t,n,r,o)=>(i,s)=>{if(s.data.type!==n)return;const a={type:s.data.type,name:s.data.name,identifier:s.data.identifier};e.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>{i.postMessage({type:o,name:a.name,identifier:a.identifier}),await new Promise((e=>{const t=n=>{if(null==n||null==n.data)return;const o=n.data.type,s=(n.data.name,n.data.identifier);o===r&&s===a.identifier&&(i.removeEventListener("message",t),e())};i.addEventListener("message",t)}))}}}))},tr=(e,t,n,r)=>async()=>{const o=Math.random().toString().substring(2);return globalThis.postMessage({type:t,identifier:o,name:e}),new Promise((t=>{const i=s=>{if(null==s||null==s.data)return;const a=s.data.type,u=s.data.identifier;a===n&&u===o&&(globalThis.removeEventListener("message",i),t((()=>{globalThis.postMessage({type:r,identifier:o,name:e})})))};globalThis.addEventListener("message",i)}))},nr={singleProcess:!1},rr={};let or;async function ir(e,t){let n;const r=new Promise((e=>{n=e}));return e.add((async()=>ln((async()=>{await new Promise((e=>{n((()=>{e()}))}))})(),{milliseconds:t.timeout}))),r}const sr={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function ar(e){const t=Object.assign({},sr,e);return null==or&&(or=(e=>{if(e=Object.assign({},nr,e),Boolean(globalThis.document)||e.singleProcess){const e=new EventTarget;return qn.addEventListener("message",er(e,"requestReadLock",Kn,Zn,Yn)),qn.addEventListener("message",er(e,"requestWriteLock",Jn,Xn,Qn)),e}return{isWorker:!0,readLock:e=>tr(e,Kn,Yn,Zn),writeLock:e=>tr(e,Jn,Qn,Xn)}})(t),!0!==or.isWorker&&(or.addEventListener("requestReadLock",(e=>{null!=rr[e.data.name]&&rr[e.data.name].readLock().then((async t=>e.data.handler().finally((()=>{t()}))))})),or.addEventListener("requestWriteLock",(async e=>{null!=rr[e.data.name]&&rr[e.data.name].writeLock().then((async t=>e.data.handler().finally((()=>{t()}))))})))),null==rr[t.name]&&(rr[t.name]=((e,t)=>{if(!0===or.isWorker)return{readLock:or.readLock(e,t),writeLock:or.writeLock(e,t)};const n=new fn({concurrency:1});let r;return{async readLock(){if(null!=r)return ir(r,t);r=new fn({concurrency:t.concurrency,autoStart:!1});const e=r,o=ir(r,t);return n.add((async()=>{e.start(),await e.onIdle().then((()=>{r===e&&(r=null)}))})),o},writeLock:async()=>(r=null,ir(n,t))}})(t.name,t)),rr[t.name]}class ur{lock;child;pins;started;constructor(e,t,n={}){this.child=e,this.pins=t,this.lock=ar({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await Hn(this.child),this.started=!0}async stop(){await zn(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,n={}){n?.signal?.throwIfAborted();const r=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{r()}}async*putMany(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{n()}}async get(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.get(e,t)}finally{n()}}async*getMany(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{n()}}async delete(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{n()}}async*deleteMany(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.writeLock();try{const n=this;yield*this.child.deleteMany(async function*(){for await(const t of e){if(await n.pins.isPinned(t))throw new Error("CID was pinned");yield t}}(),t)}finally{n()}}async has(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}async*getAll(e={}){e?.signal?.throwIfAborted();const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){return t?.signal?.throwIfAborted(),this.child.createSession(e,t)}}const lr=new kn("/version");var cr=n(374),fr=n(2954),hr=n(699),dr=n(9033),pr=n(6085);function gr(e){return null!=e?.then}var yr=n(7660),mr=n(7043);function br(e){const t=new globalThis.AbortController;function n(){t.abort();for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",n)}for(const o of e){if(!0===o?.aborted){n();break}null!=o?.addEventListener&&o.addEventListener("abort",n)}const r=t.signal;return r.clear=function(){for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",n)},r}class vr extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=vr.name;code=vr.code;constructor(e="Not Found"){super(e)}}class wr{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:n,block:r}of e)await this.put(n,r,t),yield n}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const n of e)yield{cid:n,block:await this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}}class Er extends wr{child;constructor(e){super(),this.child=e}put(e,t){return 0===e.multihash.code||null==this.child?e:this.child.put(e,t)}get(e){if(0===e.multihash.code)return e.multihash.digest;if(null==this.child)throw new vr;return this.child.get(e)}has(e){return 0===e.multihash.code||null!=this.child&&this.child.has(e)}delete(e){if(0!==e.code)return null!=this.child?this.child.delete(e):void 0}getAll(e){return null!=this.child?this.child.getAll(e):[]}}function Ar(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}}function Cr(e,t){let n=0;if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r,n++)&&(yield r)}();const r=Ar(e),{value:o,done:i}=r.next();if(!0===i)return function*(){}();const s=t(o,n++);if("function"===typeof s.then)return async function*(){await s&&(yield o);for await(const e of r)await t(e,n++)&&(yield e)}();const a=t;return function*(){!0===s&&(yield o);for(const e of r)a(e,n++)&&(yield e)}()}function Sr(e){return null!=e?.then}function Tr(e,t){let n=0;if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e){const e=t(r,n++);Sr(e)&&await e,yield r}}();const r=Ar(e),{value:o,done:i}=r.next();if(!0===i)return function*(){}();const s=t(o,n++);if("function"===typeof s?.then)return async function*(){yield o;for await(const e of r){const r=t(e,n++);Sr(r)&&await r,yield e}}();const a=t;return function*(){yield o;for(const e of r)a(e,n++),yield e}()}class kr{child;getHasher;log;logger;components;constructor(e){this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new Er(e.blockstore),this.getHasher=e.getHasher}async put(e,t,n={}){return await this.child.has(e,n)?(n.onProgress?.(new en("blocks:put:duplicate",e)),e):(n.onProgress?.(new en("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map((async r=>r.announce?.(e,t,n)))),n.onProgress?.(new en("blocks:put:blockstore:put",e)),this.child.put(e,t,n))}async*putMany(e,t={}){const n=Tr(Cr(e,(async({cid:e})=>{const n=await this.child.has(e,t);return n&&t.onProgress?.(new en("blocks:put-many:duplicate",e)),!n})),(async({cid:e,block:n})=>{t.onProgress?.(new en("blocks:put-many:providers:notify",e)),await Promise.all(this.components.blockBrokers.map((async r=>r.announce?.(e,n,t))))}));t.onProgress?.(new en("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(n,t)}async get(e,t={}){if(!0!==t.offline&&!await this.child.has(e,t)){const n=await this.getHasher(e.multihash.code);t.onProgress?.(new en("blocks:get:providers:get",e));const r=await Dr(e,this.components.blockBrokers,n,{...t,log:this.log});return t.onProgress?.(new en("blocks:get:blockstore:put",e)),await this.child.put(e,r,t),t.onProgress?.(new en("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map((async n=>n.announce?.(e,r,t)))),r}return t.onProgress?.(new en("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){t.onProgress?.(new en("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(Tr(e,(async e=>{if(!0!==t.offline&&!await this.child.has(e,t)){const n=await this.getHasher(e.multihash.code);t.onProgress?.(new en("blocks:get-many:providers:get",e));const r=await Dr(e,this.components.blockBrokers,n,{...t,log:this.log});t.onProgress?.(new en("blocks:get-many:blockstore:put",e)),await this.child.put(e,r,t),t.onProgress?.(new en("blocks:get-many:providers:notify",e)),await Promise.all(this.components.blockBrokers.map((async n=>n.announce?.(e,r,t))))}})))}async delete(e,t={}){t.onProgress?.(new en("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){t.onProgress?.(new en("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const t of e)yield t}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){e.onProgress?.(new en("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class xr extends kr{started;constructor(e){super(e),this.started=!1}isStarted(){return this.started}async start(){await Hn(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await zn(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(e,t){const n=this.components.blockBrokers.map((e=>null==e.createSession?e:e.createSession(t)));return new Ir({blockstore:this.child,blockBrokers:n,getHasher:this.getHasher,logger:this.logger},{root:e})}}class Ir extends kr{closeController;constructor(e,t){super(e),this.closeController=new AbortController,this.closeController.signal,this.log=e.logger.forComponent(`helia:session-storage:${t.root}`)}close(){this.closeController.abort()}async put(e,t,n={}){const r=br([this.closeController.signal,n.signal]);try{return await super.put(e,t,{...n,signal:r})}finally{r.clear()}}async*putMany(e,t={}){const n=br([this.closeController.signal,t.signal]);try{yield*super.putMany(e,{...t,signal:n})}finally{n.clear()}}async get(e,t={}){const n=br([this.closeController.signal,t.signal]);try{return await super.get(e,{...t,signal:n})}finally{n.clear()}}async*getMany(e,t={}){const n=br([this.closeController.signal,t.signal]);try{yield*super.getMany(e,{...t,signal:n})}finally{n.clear()}}async delete(e,t={}){const n=br([this.closeController.signal,t.signal]);try{await super.delete(e,{...t,signal:n})}finally{n.clear()}}async*deleteMany(e,t={}){const n=br([this.closeController.signal,t.signal]);try{yield*super.deleteMany(e,{...t,signal:n})}finally{n.clear()}}async has(e,t={}){const n=br([this.closeController.signal,t.signal]);try{return await super.has(e,{...t,signal:n})}finally{n.clear()}}async*getAll(e={}){const t=br([this.closeController.signal,e.signal]);try{yield*super.getAll({...e,signal:t})}finally{t.clear()}}}function Or(e){return"function"===typeof e.retrieve}const Br=(e,t)=>{if(null==t)throw new et(`No hasher configured for multihash code 0x${e.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async n=>{let r;const o=t.digest(n);if(r=gr(o)?await o:o,!Z(r.digest,e.multihash.digest))throw new ot("Hash of downloaded block did not match multihash from passed CID")}};async function Dr(e,t,n,r){const o=Br(e,n),i=new AbortController,s=br([i.signal,r.signal]);i.signal;const a=[];for(const u of t)Or(u)&&a.push(u);try{return await Promise.any(a.map((async t=>{try{let n=!1;const i=await t.retrieve(e,{...r,signal:s,validateFn:async e=>{await o(e),n=!0}});return n||await o(i),i}catch(n){throw r.log.error("could not retrieve verified block for %c",e,n),n}})))}finally{i.abort(),s.clear()}}const Nr=Symbol.for("@libp2p/content-routing"),Pr=Symbol.for("@libp2p/peer-routing");class Fr{blockstore;datastore;pins;logger;routing;getCodec;getHasher;dns;metrics;log;constructor(e){this.logger=e.logger??{forComponent:e=>Qt(e)},this.log=this.logger.forComponent("helia"),this.getHasher=function(e=[],t){const n={[mr.s.code]:mr.s,[mr.Z.code]:mr.Z,[yr.D.code]:yr.D};return e.forEach((e=>{n[e.code]=e})),async e=>{let r=n[e];if(null==r&&null!=t){const o=t(e);r=gr(o)?await o:o,n[r.code]=r}if(null!=r)return r;throw new Ft(`No hasher configured for multihash code 0x${e.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}(e.hashers,e.loadHasher),this.getCodec=function(e=[],t){const n={[hr.code]:hr,[pr.code]:pr,[cr.code]:cr,[fr.code]:fr,[dr.code]:dr};return e.forEach((e=>{n[e.code]=e})),async e=>{let r=n[e];if(null==r&&null!=t){const o=t(e);r=gr(o)?await o:o,n[r.code]=r}if(null!=r)return r;throw new _t(`Could not load codec for ${e}`)}}(e.codecs,e.loadCodec),this.dns=e.dns??function(e={}){return new bn(e)}(),this.metrics=e.metrics;const t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new Vn(t,{routers:(e.routers??[]).flatMap((e=>{const t=[e];return null!=e[Nr]&&t.push(e[Nr]),null!=e[Pr]&&t.push(e[Pr]),t})),providerLookupConcurrency:e.providerLookupConcurrency});const n=new xr(t);this.pins=new Un(e.datastore,n,this.getCodec),this.blockstore=new ur(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map((e=>e(t)))}async start(){await async function(e){if(!await e.has(lr))return void await e.put(lr,(0,oe.s)("1"));const t=J(await e.get(lr));if(1!==parseInt(t,10))throw new Error("Unknown datastore version, a datastore migration may be required")}(this.datastore),await Hn(this.blockstore,this.datastore,this.routing)}async stop(){await zn(this.blockstore,this.datastore,this.routing)}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const t=this,n=this.blockstore.unwrap();this.log("gc start"),await wn(n.deleteMany(async function*(){for await(const{cid:o}of n.getAll())try{if(await t.pins.isPinned(o,e))continue;yield o,e.onProgress?.(new en("helia:gc:deleted",o))}catch(r){t.log.error("Error during gc",r),e.onProgress?.(new en("helia:gc:error",r))}}()))}finally{t()}this.log("gc finished")}}class _r extends wr{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(te.base32.encode(e.multihash.bytes),t),e}get(e){const t=this.data.get(te.base32.encode(e.multihash.bytes));if(null==t)throw new vr;return t}has(e){return this.data.has(te.base32.encode(e.multihash.bytes))}async delete(e){this.data.delete(te.base32.encode(e.multihash.bytes))}async*getAll(){for(const[e,t]of this.data.entries())yield{cid:K.T.createV1(pr.code,(0,re.D4)(te.base32.decode(e))),block:t}}}function Lr(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const n of e)t.push(n);return t})();const t=[];for(const n of e)t.push(n);return t}function Rr(e,t){return null!=e[Symbol.asyncIterator]?async function*(){const n=await Lr(e);yield*n.sort(t)}():function*(){const n=Lr(e);yield*n.sort(t)}()}function Ur(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let n=0;if(!(t<1))for await(const r of e)if(yield r,n++,n===t)return}():function*(){let n=0;if(!(t<1))for(const r of e)if(yield r,n++,n===t)return}()}Qt("blockstore:core:tiered");class Mr{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:r}of e)await this.put(n,r,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(t,n){e.push({key:t,value:n})},delete(e){t.push(e)},commit:async n=>{await wn(this.putMany(e,n)),e=[],await wn(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(null!=e.prefix){const t=e.prefix;n=Cr(n,(e=>e.key.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>Cr(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>Rr(e,t)),n)),null!=e.offset){let t=0;const r=e.offset;n=Cr(n,(()=>t++>=r))}return null!=e.limit&&(n=Ur(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(null!=e.prefix){const t=e.prefix;n=Cr(n,(e=>e.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>Cr(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>Rr(e,t)),n)),null!=e.offset){const t=e.offset;let r=0;n=Cr(n,(()=>r++>=t))}return null!=e.limit&&(n=Ur(n,e.limit)),n}}class jr extends Mr{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){const t=this.data.get(e.toString());if(null==t)throw new vr;return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(const[e,t]of this.data.entries())yield{key:new kn(e),value:t}}*_allKeys(){for(const e of this.data.keys())yield new kn(e)}}new kn("SHARDING"),Qt("datastore:core:tiered");const $r=(e,t,n)=>e&t^e&n^t&n;class Hr extends mt{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=pt(this.buffer)}update(e){dt(this);const{view:t,buffer:n,blockLen:r}=this,o=(e=yt(e)).length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s!==r)n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=pt(e);for(;r<=o-i;i+=r)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){dt(this),function(e,t){ht(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let c=i;c<r;c++)t[c]=0;!function(e,t,n,r){if("function"===typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),u=r?4:0,l=r?0:4;e.setUint32(t+u,s,r),e.setUint32(t+l,a,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const s=pt(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<u;c++)s.setUint32(4*c,l[c],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}}const zr=BigInt(2**32-1),Vr=BigInt(32);function Gr(e,t=!1){return t?{h:Number(e&zr),l:Number(e>>Vr&zr)}:{h:0|Number(e>>Vr&zr),l:0|Number(e&zr)}}const Wr={fromBig:Gr,split:function(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let o=0;o<e.length;o++){const{h:i,l:s}=Gr(e[o],t);[n[o],r[o]]=[i,s]}return[n,r]},toBig:(e,t)=>BigInt(e>>>0)<<Vr|BigInt(t>>>0),shrSH:(e,t,n)=>e>>>n,shrSL:(e,t,n)=>e<<32-n|t>>>n,rotrSH:(e,t,n)=>e>>>n|t<<32-n,rotrSL:(e,t,n)=>e<<32-n|t>>>n,rotrBH:(e,t,n)=>e<<64-n|t>>>n-32,rotrBL:(e,t,n)=>e>>>n-32|t<<64-n,rotr32H:(e,t)=>t,rotr32L:(e,t)=>e,rotlSH:(e,t,n)=>e<<n|t>>>32-n,rotlSL:(e,t,n)=>t<<n|e>>>32-n,rotlBH:(e,t,n)=>t<<n-32|e>>>64-n,rotlBL:(e,t,n)=>e<<n-32|t>>>64-n,add:function(e,t,n,r){const o=(t>>>0)+(r>>>0);return{h:e+n+(o/2**32|0)|0,l:0|o}},add3L:(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),add3H:(e,t,n,r)=>t+n+r+(e/2**32|0)|0,add4L:(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),add4H:(e,t,n,r,o)=>t+n+r+o+(e/2**32|0)|0,add5H:(e,t,n,r,o,i)=>t+n+r+o+i+(e/2**32|0)|0,add5L:(e,t,n,r,o)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(o>>>0)},[qr,Kr]=(()=>Wr.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))))(),Zr=new Uint32Array(80),Yr=new Uint32Array(80);class Jr extends Hr{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:r,Ch:o,Cl:i,Dh:s,Dl:a,Eh:u,El:l,Fh:c,Fl:f,Gh:h,Gl:d,Hh:p,Hl:g}=this;return[e,t,n,r,o,i,s,a,u,l,c,f,h,d,p,g]}set(e,t,n,r,o,i,s,a,u,l,c,f,h,d,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|n,this.Bl=0|r,this.Ch=0|o,this.Cl=0|i,this.Dh=0|s,this.Dl=0|a,this.Eh=0|u,this.El=0|l,this.Fh=0|c,this.Fl=0|f,this.Gh=0|h,this.Gl=0|d,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let b=0;b<16;b++,t+=4)Zr[b]=e.getUint32(t),Yr[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const e=0|Zr[b-15],t=0|Yr[b-15],n=Wr.rotrSH(e,t,1)^Wr.rotrSH(e,t,8)^Wr.shrSH(e,t,7),r=Wr.rotrSL(e,t,1)^Wr.rotrSL(e,t,8)^Wr.shrSL(e,t,7),o=0|Zr[b-2],i=0|Yr[b-2],s=Wr.rotrSH(o,i,19)^Wr.rotrBH(o,i,61)^Wr.shrSH(o,i,6),a=Wr.rotrSL(o,i,19)^Wr.rotrBL(o,i,61)^Wr.shrSL(o,i,6),u=Wr.add4L(r,a,Yr[b-7],Yr[b-16]),l=Wr.add4H(u,n,s,Zr[b-7],Zr[b-16]);Zr[b]=0|l,Yr[b]=0|u}let{Ah:n,Al:r,Bh:o,Bl:i,Ch:s,Cl:a,Dh:u,Dl:l,Eh:c,El:f,Fh:h,Fl:d,Gh:p,Gl:g,Hh:y,Hl:m}=this;for(let b=0;b<80;b++){const e=Wr.rotrSH(c,f,14)^Wr.rotrSH(c,f,18)^Wr.rotrBH(c,f,41),t=Wr.rotrSL(c,f,14)^Wr.rotrSL(c,f,18)^Wr.rotrBL(c,f,41),v=c&h^~c&p,w=f&d^~f&g,E=Wr.add5L(m,t,w,Kr[b],Yr[b]),A=Wr.add5H(E,y,e,v,qr[b],Zr[b]),C=0|E,S=Wr.rotrSH(n,r,28)^Wr.rotrBH(n,r,34)^Wr.rotrBH(n,r,39),T=Wr.rotrSL(n,r,28)^Wr.rotrBL(n,r,34)^Wr.rotrBL(n,r,39),k=n&o^n&s^o&s,x=r&i^r&a^i&a;y=0|p,m=0|g,p=0|h,g=0|d,h=0|c,d=0|f,({h:c,l:f}=Wr.add(0|u,0|l,0|A,0|C)),u=0|s,l=0|a,s=0|o,a=0|i,o=0|n,i=0|r;const I=Wr.add3L(C,T,x);n=Wr.add3H(I,A,S,k),r=0|I}({h:n,l:r}=Wr.add(0|this.Ah,0|this.Al,0|n,0|r)),({h:o,l:i}=Wr.add(0|this.Bh,0|this.Bl,0|o,0|i)),({h:s,l:a}=Wr.add(0|this.Ch,0|this.Cl,0|s,0|a)),({h:u,l:l}=Wr.add(0|this.Dh,0|this.Dl,0|u,0|l)),({h:c,l:f}=Wr.add(0|this.Eh,0|this.El,0|c,0|f)),({h:h,l:d}=Wr.add(0|this.Fh,0|this.Fl,0|h,0|d)),({h:p,l:g}=Wr.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:y,l:m}=Wr.add(0|this.Hh,0|this.Hl,0|y,0|m)),this.set(n,r,o,i,s,a,u,l,c,f,h,d,p,g,y,m)}roundClean(){Zr.fill(0),Yr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Xr=bt((()=>new Jr)),Qr=BigInt(0),eo=BigInt(1),to=BigInt(2);function no(e){return e instanceof Uint8Array||null!=e&&"object"===typeof e&&"Uint8Array"===e.constructor.name}function ro(e){if(!no(e))throw new Error("Uint8Array expected")}function oo(e,t){if("boolean"!==typeof t)throw new Error(`${e} must be valid boolean, got "${t}".`)}const io=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function so(e){ro(e);let t="";for(let n=0;n<e.length;n++)t+=io[e[n]];return t}function ao(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function uo(e){if("string"!==typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}const lo={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function co(e){return e>=lo._0&&e<=lo._9?e-lo._0:e>=lo._A&&e<=lo._F?e-(lo._A-10):e>=lo._a&&e<=lo._f?e-(lo._a-10):void 0}function fo(e){if("string"!==typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let o=0,i=0;o<n;o++,i+=2){const t=co(e.charCodeAt(i)),n=co(e.charCodeAt(i+1));if(void 0===t||void 0===n){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[o]=16*t+n}return r}function ho(e){return uo(so(e))}function po(e){return ro(e),uo(so(Uint8Array.from(e).reverse()))}function go(e,t){return fo(e.toString(16).padStart(2*t,"0"))}function yo(e,t){return go(e,t).reverse()}function mo(e,t,n){let r;if("string"===typeof t)try{r=fo(t)}catch(i){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${i}`)}else{if(!no(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const o=r.length;if("number"===typeof n&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function bo(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];ro(n),t+=n.length}const n=new Uint8Array(t);for(let r=0,o=0;r<e.length;r++){const t=e[r];n.set(t,o),o+=t.length}return n}const vo=e=>"bigint"===typeof e&&Qr<=e;function wo(e,t,n){return vo(e)&&vo(t)&&vo(n)&&t<=e&&e<n}function Eo(e,t,n,r){if(!wo(t,n,r))throw new Error(`expected valid ${e}: ${n} <= n < ${r}, got ${typeof t} ${t}`)}function Ao(e){let t;for(t=0;e>Qr;e>>=eo,t+=1);return t}const Co=e=>(to<<BigInt(e-1))-eo,So=e=>new Uint8Array(e),To=e=>Uint8Array.from(e);function ko(e,t,n){if("number"!==typeof e||e<2)throw new Error("hashLen must be a number");if("number"!==typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!==typeof n)throw new Error("hmacFn must be a function");let r=So(e),o=So(e),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},a=(...e)=>n(o,r,...e),u=(e=So())=>{o=a(To([0]),e),r=a(),0!==e.length&&(o=a(To([1]),e),r=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return bo(...n)};return(e,t)=>{let n;for(s(),u(e);!(n=t(l()));)u();return s(),n}}const xo={bigint:e=>"bigint"===typeof e,function:e=>"function"===typeof e,boolean:e=>"boolean"===typeof e,string:e=>"string"===typeof e,stringOrUint8Array:e=>"string"===typeof e||no(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"===typeof e&&Number.isSafeInteger(e.outputLen)};function Io(e,t,n={}){const r=(t,n,r)=>{const o=xo[n];if("function"!==typeof o)throw new Error(`Invalid validator "${n}", expected function`);const i=e[t];if((!r||void 0!==i)&&!o(i,e))throw new Error(`Invalid param ${String(t)}=${i} (${typeof i}), expected ${n}`)};for(const[o,i]of Object.entries(t))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return e}function Oo(e){const t=new WeakMap;return(n,...r)=>{const o=t.get(n);if(void 0!==o)return o;const i=e(n,...r);return t.set(n,i),i}}const Bo=BigInt(0),Do=BigInt(1),No=BigInt(2),Po=BigInt(3),Fo=BigInt(4),_o=BigInt(5),Lo=BigInt(8);function Ro(e,t){const n=e%t;return n>=Bo?n:t+n}function Uo(e,t,n){if(n<=Bo||t<Bo)throw new Error("Expected power/modulo > 0");if(n===Do)return Bo;let r=Do;for(;t>Bo;)t&Do&&(r=r*e%n),e=e*e%n,t>>=Do;return r}function Mo(e,t,n){let r=e;for(;t-- >Bo;)r*=r,r%=n;return r}function jo(e,t){if(e===Bo||t<=Bo)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=Ro(e,t),r=t,o=Bo,i=Do;for(;n!==Bo;){const e=r%n,t=o-i*(r/n);r=n,n=e,o=i,i=t}if(r!==Do)throw new Error("invert: does not exist");return Ro(o,t)}function $o(e){if(e%Fo===Po){const t=(e+Do)/Fo;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%Lo===_o){const t=(e-_o)/Lo;return function(e,n){const r=e.mul(n,No),o=e.pow(r,t),i=e.mul(n,o),s=e.mul(e.mul(i,No),o),a=e.mul(i,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-Do)/No;let n,r,o;for(n=e-Do,r=0;n%No===Bo;n/=No,r++);for(o=No;o<e&&Uo(o,t,e)!==e-Do;o++);if(1===r){const t=(e+Do)/Fo;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const i=(n+Do)/No;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,u=e.pow(e.mul(e.ONE,o),n),l=e.pow(s,i),c=e.pow(s,n);for(;!e.eql(c,e.ONE);){if(e.eql(c,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(c);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);const n=e.pow(u,Do<<BigInt(a-t-1));u=e.sqr(n),l=e.mul(l,n),c=e.mul(c,u),a=t}return l}}(e)}BigInt(9),BigInt(16);const Ho=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function zo(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function Vo(e,t,n=!1,r={}){if(e<=Bo)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:i}=zo(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=$o(e),a=Object.freeze({ORDER:e,BITS:o,BYTES:i,MASK:Co(o),ZERO:Bo,ONE:Do,create:t=>Ro(t,e),isValid:t=>{if("bigint"!==typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return Bo<=t&&t<e},is0:e=>e===Bo,isOdd:e=>(e&Do)===Do,neg:t=>Ro(-t,e),eql:(e,t)=>e===t,sqr:t=>Ro(t*t,e),add:(t,n)=>Ro(t+n,e),sub:(t,n)=>Ro(t-n,e),mul:(t,n)=>Ro(t*n,e),pow:(e,t)=>function(e,t,n){if(n<Bo)throw new Error("Expected power > 0");if(n===Bo)return e.ONE;if(n===Do)return t;let r=e.ONE,o=t;for(;n>Bo;)n&Do&&(r=e.mul(r,o)),o=e.sqr(o),n>>=Do;return r}(a,e,t),div:(t,n)=>Ro(t*jo(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>jo(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,o)=>e.is0(r)?t:(n[o]=t,e.mul(t,r))),e.ONE),o=e.inv(r);return t.reduceRight(((t,r,o)=>e.is0(r)?t:(n[o]=e.mul(t,n[o]),e.mul(t,r))),o),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?yo(e,i):go(e,i),fromBytes:e=>{if(e.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${e.length}`);return n?po(e):ho(e)}});return Object.freeze(a)}function Go(e){if("bigint"!==typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Wo(e){const t=Go(e);return t+Math.ceil(t/2)}const qo=BigInt(0),Ko=BigInt(1),Zo=new WeakMap,Yo=new WeakMap;function Jo(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>{if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error(`Wrong window size=${e}, should be [1..${t}]`)},o=e=>{r(e);return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)}};return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,o=t;for(;n>qo;)n&Ko&&(r=r.add(o)),o=o.double(),n>>=Ko;return r},precomputeWindow(e,t){const{windows:n,windowSize:r}=o(t),i=[];let s=e,a=s;for(let o=0;o<n;o++){a=s,i.push(a);for(let e=1;e<r;e++)a=a.add(s),i.push(a);s=a.double()}return i},wNAF(t,r,i){const{windows:s,windowSize:a}=o(t);let u=e.ZERO,l=e.BASE;const c=BigInt(2**t-1),f=2**t,h=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let o=Number(i&c);i>>=h,o>a&&(o-=f,i+=Ko);const s=t,d=t+Math.abs(o)-1,p=e%2!==0,g=o<0;0===o?l=l.add(n(p,r[s])):u=u.add(n(g,r[d]))}return{p:u,f:l}},wNAFCached(e,t,n){const r=Yo.get(e)||1;let o=Zo.get(e);return o||(o=this.precomputeWindow(e,r),1!==r&&Zo.set(e,n(o))),this.wNAF(r,o,t)},setWindowSize(e,t){r(t),Yo.set(e,t),Zo.delete(e)}}}function Xo(e,t,n,r){if(!Array.isArray(n)||!Array.isArray(r)||r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");r.forEach(((e,n)=>{if(!t.isValid(e))throw new Error(`wrong scalar at index ${n}`)})),n.forEach(((t,n)=>{if(!(t instanceof e))throw new Error(`wrong point at index ${n}`)}));const o=Ao(BigInt(n.length)),i=o>12?o-3:o>4?o-2:o?2:1,s=(1<<i)-1,a=new Array(s+1).fill(e.ZERO),u=Math.floor((t.BITS-1)/i)*i;let l=e.ZERO;for(let c=u;c>=0;c-=i){a.fill(e.ZERO);for(let e=0;e<r.length;e++){const t=r[e],o=Number(t>>BigInt(c)&BigInt(s));a[o]=a[o].add(n[e])}let t=e.ZERO;for(let n=a.length-1,r=e.ZERO;n>0;n--)r=r.add(a[n]),t=t.add(r);if(l=l.add(t),0!==c)for(let e=0;e<i;e++)l=l.double()}return l}function Qo(e){return function(e){const t=Ho.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});Io(e,t)}(e.Fp),Io(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...zo(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const ei=BigInt(0),ti=BigInt(1),ni=BigInt(2),ri=BigInt(8),oi={zip215:!0};function ii(e){const t=function(e){const t=Qo(e);return Io(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:n,n:r,prehash:o,hash:i,randomBytes:s,nByteLength:a,h:u}=t,l=ni<<BigInt(8*a)-ti,c=n.create,f=Vo(t.n,t.nBitLength),h=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:n.sqrt(e*n.inv(t))}}catch(r){return{isValid:!1,value:ei}}}),d=t.adjustScalarBytes||(e=>e),p=t.domain||((e,t,n)=>{if(oo("phflag",n),t.length||n)throw new Error("Contexts/pre-hash are not supported");return e});function g(e,t){Eo("coordinate "+e,t,ei,l)}function y(e){if(!(e instanceof v))throw new Error("ExtendedPoint expected")}const m=Oo(((e,t)=>{const{ex:r,ey:o,ez:i}=e,s=e.is0();null==t&&(t=s?ri:n.inv(i));const a=c(r*t),u=c(o*t),l=c(i*t);if(s)return{x:ei,y:ti};if(l!==ti)throw new Error("invZ was invalid");return{x:a,y:u}})),b=Oo((e=>{const{a:n,d:r}=t;if(e.is0())throw new Error("bad point: ZERO");const{ex:o,ey:i,ez:s,et:a}=e,u=c(o*o),l=c(i*i),f=c(s*s),h=c(f*f),d=c(u*n);if(c(f*c(d+l))!==c(h+c(r*c(u*l))))throw new Error("bad point: equation left != right (1)");if(c(o*i)!==c(s*a))throw new Error("bad point: equation left != right (2)");return!0}));class v{constructor(e,t,n,r){this.ex=e,this.ey=t,this.ez=n,this.et=r,g("x",e),g("y",t),g("z",n),g("t",r),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof v)throw new Error("extended point not allowed");const{x:t,y:n}=e||{};return g("x",t),g("y",n),new v(t,n,ti,c(t*n))}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.ez)));return e.map(((e,n)=>e.toAffine(t[n]))).map(v.fromAffine)}static msm(e,t){return Xo(v,f,e,t)}_setWindowSize(e){A.setWindowSize(this,e)}assertValidity(){b(this)}equals(e){y(e);const{ex:t,ey:n,ez:r}=this,{ex:o,ey:i,ez:s}=e,a=c(t*s),u=c(o*r),l=c(n*s),f=c(i*r);return a===u&&l===f}is0(){return this.equals(v.ZERO)}negate(){return new v(c(-this.ex),this.ey,this.ez,c(-this.et))}double(){const{a:e}=t,{ex:n,ey:r,ez:o}=this,i=c(n*n),s=c(r*r),a=c(ni*c(o*o)),u=c(e*i),l=n+r,f=c(c(l*l)-i-s),h=u+s,d=h-a,p=u-s,g=c(f*d),y=c(h*p),m=c(f*p),b=c(d*h);return new v(g,y,b,m)}add(e){y(e);const{a:n,d:r}=t,{ex:o,ey:i,ez:s,et:a}=this,{ex:u,ey:l,ez:f,et:h}=e;if(n===BigInt(-1)){const e=c((i-o)*(l+u)),t=c((i+o)*(l-u)),n=c(t-e);if(n===ei)return this.double();const r=c(s*ni*h),d=c(a*ni*f),p=d+r,g=t+e,y=d-r,m=c(p*n),b=c(g*y),w=c(p*y),E=c(n*g);return new v(m,b,E,w)}const d=c(o*u),p=c(i*l),g=c(a*r*h),m=c(s*f),b=c((o+i)*(u+l)-d-p),w=m-g,E=m+g,A=c(p-n*d),C=c(b*w),S=c(E*A),T=c(b*A),k=c(w*E);return new v(C,S,k,T)}subtract(e){return this.add(e.negate())}wNAF(e){return A.wNAFCached(this,e,v.normalizeZ)}multiply(e){const t=e;Eo("scalar",t,ti,r);const{p:n,f:o}=this.wNAF(t);return v.normalizeZ([n,o])[0]}multiplyUnsafe(e){const t=e;return Eo("scalar",t,ei,r),t===ei?E:this.equals(E)||t===ti?this:this.equals(w)?this.wNAF(t).p:A.unsafeLadder(this,t)}isSmallOrder(){return this.multiplyUnsafe(u).is0()}isTorsionFree(){return A.unsafeLadder(this,r).is0()}toAffine(e){return m(this,e)}clearCofactor(){const{h:e}=t;return e===ti?this:this.multiplyUnsafe(e)}static fromHex(e,r=!1){const{d:o,a:i}=t,s=n.BYTES;e=mo("pointHex",e,s),oo("zip215",r);const a=e.slice(),u=e[s-1];a[s-1]=-129&u;const f=po(a),d=r?l:n.ORDER;Eo("pointHex.y",f,ei,d);const p=c(f*f),g=c(p-ti),y=c(o*p-i);let{isValid:m,value:b}=h(g,y);if(!m)throw new Error("Point.fromHex: invalid y coordinate");const w=(b&ti)===ti,E=0!==(128&u);if(!r&&b===ei&&E)throw new Error("Point.fromHex: x=0 and x_0=1");return E!==w&&(b=c(-b)),v.fromAffine({x:b,y:f})}static fromPrivateKey(e){return T(e).point}toRawBytes(){const{x:e,y:t}=this.toAffine(),r=yo(t,n.BYTES);return r[r.length-1]|=e&ti?128:0,r}toHex(){return so(this.toRawBytes())}}v.BASE=new v(t.Gx,t.Gy,ti,c(t.Gx*t.Gy)),v.ZERO=new v(ei,ti,ti,ei);const{BASE:w,ZERO:E}=v,A=Jo(v,8*a);function C(e){return Ro(e,r)}function S(e){return C(po(e))}function T(e){const t=a;e=mo("private key",e,t);const n=mo("hashed private key",i(e),2*t),r=d(n.slice(0,t)),o=n.slice(t,2*t),s=S(r),u=w.multiply(s),l=u.toRawBytes();return{head:r,prefix:o,scalar:s,point:u,pointBytes:l}}function k(e=new Uint8Array,...t){const n=bo(...t);return S(i(p(n,mo("context",e),!!o)))}const x=oi;w._setWindowSize(8);return{CURVE:t,getPublicKey:function(e){return T(e).pointBytes},sign:function(e,t,i={}){e=mo("message",e),o&&(e=o(e));const{prefix:s,scalar:u,pointBytes:l}=T(t),c=k(i.context,s,e),f=w.multiply(c).toRawBytes(),h=C(c+k(i.context,f,l,e)*u);return Eo("signature.s",h,ei,r),mo("result",bo(f,yo(h,n.BYTES)),2*a)},verify:function(e,t,r,i=x){const{context:s,zip215:a}=i,u=n.BYTES;e=mo("signature",e,2*u),t=mo("message",t),void 0!==a&&oo("zip215",a),o&&(t=o(t));const l=po(e.slice(u,2*u));let c,f,h;try{c=v.fromHex(r,a),f=v.fromHex(e.slice(0,u),a),h=w.multiplyUnsafe(l)}catch(p){return!1}if(!a&&c.isSmallOrder())return!1;const d=k(s,f.toRawBytes(),c.toRawBytes(),t);return f.add(c.multiplyUnsafe(d)).subtract(h).clearCofactor().equals(v.ZERO)},ExtendedPoint:v,utils:{getExtendedPublicKey:T,randomPrivateKey:()=>s(n.BYTES),precompute:(e=8,t=v.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}}const si=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ai=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const ui=BigInt(1),li=BigInt(2);BigInt(3);const ci=BigInt(5),fi=BigInt(8);function hi(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function di(e,t){const n=si,r=Ro(t*t*t,n),o=function(e){const t=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),i=si,s=e*e%i*e%i,a=Mo(s,li,i)*s%i,u=Mo(a,ui,i)*e%i,l=Mo(u,ci,i)*u%i,c=Mo(l,t,i)*l%i,f=Mo(c,n,i)*c%i,h=Mo(f,r,i)*f%i,d=Mo(h,o,i)*h%i,p=Mo(d,o,i)*h%i,g=Mo(p,t,i)*l%i;return{pow_p_5_8:Mo(g,li,i)*e%i,b2:s}}(e*Ro(r*r*t,n)).pow_p_5_8;let i=Ro(e*r*o,n);const s=Ro(t*i*i,n),a=i,u=Ro(i*ai,n),l=s===e,c=s===Ro(-e,n),f=s===Ro(-e*ai,n);return l&&(i=a),(c||f)&&(i=u),(Ro(i,n)&Do)===Do&&(i=Ro(-i,n)),{isValid:l||c,value:i}}const pi=(()=>Vo(si,void 0,!0))(),gi=(()=>({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:pi,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:fi,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Xr,randomBytes:vt,adjustScalarBytes:hi,uvRatio:di}))(),yi=(()=>ii(gi))();class mi{type="Ed25519";raw;constructor(e){this.raw=vi(e,32)}toMultihash(){return yr.D.digest(Au(this))}toCID(){return K.T.createV1(114,this.toMultihash())}toString(){return y.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&Z(this.raw,e.raw)}verify(e,t){return function(e,t,n){return yi.verify(t,n instanceof Uint8Array?n:n.subarray(),e)}(this.raw,t,e)}}function bi(e){return e=vi(e,32),new mi(e)}function vi(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new et(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var wi,Ei,Ai,Ci,Si=n(3902),Ti=n(4318),ki=n(5379),xi=n(8671);n(7198),n(3260),n(3337);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1"}(wi||(wi={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1"}(Ei||(Ei={})),function(e){e.codec=()=>(0,ki.e)(Ei)}(wi||(wi={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,xi.i)(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),wi.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t,n={})=>{const r={},o=null==t?e.len:e.pos+t;for(;e.pos<o;){const t=e.uint32();switch(t>>>3){case 1:r.Type=wi.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Ti.m)(t,e.codec()),e.decode=(t,n)=>(0,Si.Y)(t,e.codec(),n)}(Ai||(Ai={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,xi.i)(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),wi.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t,n={})=>{const r={},o=null==t?e.len:e.pos+t;for(;e.pos<o;){const t=e.uint32();switch(t>>>3){case 1:r.Type=wi.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Ti.m)(t,e.codec()),e.decode=(t,n)=>(0,Si.Y)(t,e.codec(),n)}(Ci||(Ci={}));const Ii=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Oi=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Bi=new Uint32Array(64);class Di extends Hr{constructor(){super(64,32,8,!1),this.A=0|Oi[0],this.B=0|Oi[1],this.C=0|Oi[2],this.D=0|Oi[3],this.E=0|Oi[4],this.F=0|Oi[5],this.G=0|Oi[6],this.H=0|Oi[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:a}=this;return[e,t,n,r,o,i,s,a]}set(e,t,n,r,o,i,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(e,t){for(let f=0;f<16;f++,t+=4)Bi[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const e=Bi[f-15],t=Bi[f-2],n=gt(e,7)^gt(e,18)^e>>>3,r=gt(t,17)^gt(t,19)^t>>>10;Bi[f]=r+Bi[f-7]+n+Bi[f-16]|0}let{A:n,B:r,C:o,D:i,E:s,F:a,G:u,H:l}=this;for(let f=0;f<64;f++){const e=l+(gt(s,6)^gt(s,11)^gt(s,25))+((c=s)&a^~c&u)+Ii[f]+Bi[f]|0,t=(gt(n,2)^gt(n,13)^gt(n,22))+$r(n,r,o)|0;l=u,u=a,a=s,s=i+e|0,i=o,o=r,r=n,n=e+t|0}var c;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,o,i,s,a,u,l)}roundClean(){Bi.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Ni=bt((()=>new Di));var Pi=n(6382).Buffer;class Fi{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=Fi.toUint8Array(e),r=Fi.toUint8Array(t);if(n.length!==r.byteLength)return!1;for(let o=0;o<n.length;o++)if(n[o]!==r[o])return!1;return!0}static concat(...e){let t;t=!Array.isArray(e[0])||e[1]instanceof Function?Array.isArray(e[0])&&e[1]instanceof Function?e[0]:e[e.length-1]instanceof Function?e.slice(0,e.length-1):e:e[0];let n=0;for(const i of t)n+=i.byteLength;const r=new Uint8Array(n);let o=0;for(const i of t){const e=this.toUint8Array(i);r.set(e,o),o+=e.length}return e[e.length-1]instanceof Function?this.toView(r,e[e.length-1]):r.buffer}}const _i="string",Li=/^[0-9a-f]+$/i,Ri=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Ui=/^[a-zA-Z0-9-_]+$/;class Mi{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n.buffer}static toString(e){const t=Fi.toUint8Array(e);let n="";for(let r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return decodeURIComponent(escape(n))}}class ji{static toString(e,t=!1){const n=Fi.toArrayBuffer(e),r=new DataView(n);let o="";for(let i=0;i<n.byteLength;i+=2){const e=r.getUint16(i,t);o+=String.fromCharCode(e)}return o}static fromString(e,t=!1){const n=new ArrayBuffer(2*e.length),r=new DataView(n);for(let o=0;o<e.length;o++)r.setUint16(2*o,e.charCodeAt(o),t);return n}}class $i{static isHex(e){return typeof e===_i&&Li.test(e)}static isBase64(e){return typeof e===_i&&Ri.test(e)}static isBase64Url(e){return typeof e===_i&&Ui.test(e)}static ToString(e,t="utf8"){const n=Fi.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return ji.toString(n,!0);case"utf16":case"utf16be":return ji.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return ji.fromString(e,!0);case"utf16":case"utf16be":return ji.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=Fi.toUint8Array(e);if("undefined"!==typeof btoa){const e=this.ToString(t,"binary");return btoa(e)}return Pi.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!$i.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!==typeof atob?this.FromBinary(atob(t)):new Uint8Array(Pi.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!$i.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=$i.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return Mi.fromString(e);case"utf16":case"utf16be":return ji.fromString(e);case"utf16le":case"usc2":return ji.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=$i.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return Mi.toString(e);case"utf16":case"utf16be":return ji.toString(e);case"utf16le":case"usc2":return ji.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n.buffer}static ToBinary(e){const t=Fi.toUint8Array(e);let n="";for(let r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n}static ToHex(e){const t=Fi.toUint8Array(e);let n="";const r=t.length;for(let o=0;o<r;o++){const e=t[o];e<16&&(n+="0"),n+=e.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!$i.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let r=0;r<t.length;r+=2){const e=t.slice(r,r+2);n[r/2]=parseInt(e,16)}return n.buffer}static ToUtf16String(e,t=!1){return ji.toString(e,t)}static FromUtf16String(e,t=!1){return ji.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(null===e||void 0===e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}function Hi(e,t){let n=0;if(1===e.length)return e[0];for(let r=e.length-1;r>=0;r--)n+=e[e.length-1-r]*Math.pow(2,t*r);return n}function zi(e,t,n=-1){const r=n;let o=e,i=0,s=Math.pow(2,t);for(let a=1;a<8;a++){if(e<s){let e;if(r<0)e=new ArrayBuffer(a),i=a;else{if(r<a)return new ArrayBuffer(0);e=new ArrayBuffer(r),i=r}const n=new Uint8Array(e);for(let r=a-1;r>=0;r--){const e=Math.pow(2,r*t);n[i-r-1]=Math.floor(o/e),o-=n[i-r-1]*e}return e}s*=Math.pow(2,t)}return new ArrayBuffer(0)}function Vi(...e){let t=0,n=0;for(const i of e)t+=i.length;const r=new ArrayBuffer(t),o=new Uint8Array(r);for(const i of e)o.set(i,n),n+=i.length;return o}function Gi(){const e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const t=255===e[0]&&128&e[1],n=0===e[0]&&0===(128&e[1]);(t||n)&&this.warnings.push("Needlessly long format")}const t=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(t);for(let s=0;s<this.valueHex.byteLength;s++)n[s]=0;n[0]=128&e[0];const r=Hi(n,8),o=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(o);for(let s=0;s<this.valueHex.byteLength;s++)i[s]=e[s];i[0]&=127;return Hi(i,8)-r}function Wi(e,t){const n=e.toString(10);if(t<n.length)return"";const r=t-n.length,o=new Array(r);for(let i=0;i<r;i++)o[i]="0";return o.join("").concat(n)}function qi(){if("undefined"===typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Ki(e){let t=0,n=0;for(let o=0;o<e.length;o++){t+=e[o].byteLength}const r=new Uint8Array(t);for(let o=0;o<e.length;o++){const t=e[o];r.set(new Uint8Array(t),n),n+=t.byteLength}return r.buffer}function Zi(e,t,n,r){return t instanceof Uint8Array?t.byteLength?n<0?(e.error="Wrong parameter: inputOffset less than zero",!1):r<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-n-r<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}$i.DEFAULT_UTF8_ENCODING="utf8";class Yi{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Ki(this.items)}}const Ji=[new Uint8Array([1])],Xi="0123456789",Qi="",es=new ArrayBuffer(0),ts=new Uint8Array(0),ns="EndOfContent",rs="OCTET STRING",os="BIT STRING";function is(e){var t;return(t=class extends e{constructor(...e){var t;super(...e);const n=e[0]||{};this.isHexOnly=null!==(t=n.isHexOnly)&&void 0!==t&&t,this.valueHexView=n.valueHex?Fi.toUint8Array(n.valueHex):ts}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}fromBER(e,t,n){const r=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!Zi(this,r,t,n))return-1;const o=t+n;return this.valueHexView=r.subarray(t,o),this.valueHexView.length?(this.blockLength=n,o):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",es)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:$i.ToHex(this.valueHexView)}}}).NAME="hexBlock",t}class ss{constructor({blockLength:e=0,error:t="",warnings:n=[],valueBeforeDecode:r=ts}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=Fi.toUint8Array(r)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:$i.ToHex(this.valueBeforeDecodeView)}}}ss.NAME="baseBlock";class as extends ss{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}as.NAME="valueBlock";class us extends(is(ss)){constructor({idBlock:e={}}={}){var t,n,r,o;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?Fi.toUint8Array(e.valueHex):ts,this.tagClass=null!==(n=e.tagClass)&&void 0!==n?n:-1,this.tagNumber=null!==(r=e.tagNumber)&&void 0!==r?r:-1,this.isConstructed=null!==(o=e.isConstructed)&&void 0!==o&&o):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",es}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const n=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,n[0]=t}return n.buffer}if(!this.isHexOnly){const n=zi(this.tagNumber,7),r=new Uint8Array(n),o=n.byteLength,i=new Uint8Array(o+1);if(i[0]=31|t,!e){for(let e=0;e<o-1;e++)i[e+1]=128|r[e];i[o]=r[o-1]}return i.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=31|t,!e){const e=this.valueHexView;for(let t=0;t<e.length-1;t++)n[t+1]=128|e[t];n[this.valueHexView.byteLength]=e[e.length-1]}return n.buffer}fromBER(e,t,n){const r=Fi.toUint8Array(e);if(!Zi(this,r,t,n))return-1;const o=r.subarray(t,t+n);if(0===o.length)return this.error="Zero buffer length",-1;switch(192&o[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32===(32&o[0]),this.isHexOnly=!1;const i=31&o[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),n=255;for(;128&o[e];){if(t[e-1]=127&o[e],e++,e>=o.length)return this.error="End of input reached before message was fully decoded",-1;if(e===n){n+=255;const e=new Uint8Array(n);for(let n=0;n<t.length;n++)e[n]=t[n];t=this.valueHexView=new Uint8Array(n)}}this.blockLength=e+1,t[e-1]=127&o[e];const r=new Uint8Array(e);for(let o=0;o<e;o++)r[o]=t[o];t=this.valueHexView=new Uint8Array(e),t.set(r),this.blockLength<=9?this.tagNumber=Hi(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}us.NAME="identificationBlock";class ls extends ss{constructor({lenBlock:e={}}={}){var t,n,r;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(n=e.longFormUsed)&&void 0!==n&&n,this.length=null!==(r=e.length)&&void 0!==r?r:0}fromBER(e,t,n){const r=Fi.toUint8Array(e);if(!Zi(this,r,t,n))return-1;const o=r.subarray(t,t+n);if(0===o.length)return this.error="Zero buffer length",-1;if(255===o[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===o[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&o[0]),!1===this.longFormUsed)return this.length=o[0],this.blockLength=1,t+this.blockLength;const i=127&o[0];if(i>8)return this.error="Too big integer",-1;if(i+1>o.length)return this.error="End of input reached before message was fully decoded",-1;const s=t+1,a=r.subarray(s,s+i);return 0===a[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=Hi(a,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const r=zi(this.length,8);if(r.byteLength>127)return this.error="Too big length",es;if(t=new ArrayBuffer(r.byteLength+1),e)return t;const o=new Uint8Array(r);n=new Uint8Array(t),n[0]=128|r.byteLength;for(let e=0;e<r.byteLength;e++)n[e+1]=o[e];return t}return t=new ArrayBuffer(1),!1===e&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}ls.NAME="lengthBlock";const cs={};class fs extends ss{constructor({name:e="",optional:t=!1,primitiveSchema:n,...r}={},o){super(r),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new us(r),this.lenBlock=new ls(r),this.valueBlock=o?new o(r):new as(r)}fromBER(e,t,n){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===r?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}toBER(e,t){const n=t||new Yi;t||hs(this);const r=this.idBlock.toBER(e);if(n.write(r),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;const r=this.lenBlock.toBER(e);n.write(r),n.write(t)}return t?es:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():$i.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${$i.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;return function(e,t){if(e.byteLength!==t.byteLength)return!1;const n=new Uint8Array(e),r=new Uint8Array(t);for(let o=0;o<n.length;o++)if(n[o]!==r[o])return!1;return!0}(this.toBER(),e.toBER())}}function hs(e){if(e instanceof cs.Constructed)for(const t of e.valueBlock.value)hs(t)&&(e.lenBlock.isIndefiniteForm=!0);return!!e.lenBlock.isIndefiniteForm}fs.NAME="BaseBlock";class ds extends fs{constructor({value:e="",...t}={},n){super(t,n),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,n){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===r?(this.error=this.valueBlock.error,r):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}ds.NAME="BaseStringBlock";class ps extends(is(as)){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}var gs,ys,ms,bs,vs,ws,Es,As,Cs,Ss,Ts,ks,xs,Is,Os,Bs,Ds,Ns,Ps,Fs,_s,Ls,Rs,Us,Ms,js,$s,Hs,zs,Vs,Gs,Ws,qs;ps.NAME="PrimitiveValueBlock";class Ks extends fs{constructor(e={}){super(e,ps),this.idBlock.isConstructed=!1}}function Zs(e,t=0,n=e.length){const r=t;let o=new fs({},as);const i=new ss;if(!Zi(i,e,t,n))return o.error=i.error,{offset:-1,result:o};if(!e.subarray(t,t+n).length)return o.error="Zero buffer length",{offset:-1,result:o};let s=o.idBlock.fromBER(e,t,n);if(o.idBlock.warnings.length&&o.warnings.concat(o.idBlock.warnings),-1===s)return o.error=o.idBlock.error,{offset:-1,result:o};if(t=s,n-=o.idBlock.blockLength,s=o.lenBlock.fromBER(e,t,n),o.lenBlock.warnings.length&&o.warnings.concat(o.lenBlock.warnings),-1===s)return o.error=o.lenBlock.error,{offset:-1,result:o};if(t=s,n-=o.lenBlock.blockLength,!o.idBlock.isConstructed&&o.lenBlock.isIndefiniteForm)return o.error="Indefinite length form used for primitive encoding form",{offset:-1,result:o};let a=fs;if(1===o.idBlock.tagClass){if(o.idBlock.tagNumber>=37&&!1===o.idBlock.isHexOnly)return o.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:o};switch(o.idBlock.tagNumber){case 0:if(o.idBlock.isConstructed&&o.lenBlock.length>0)return o.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:o};a=cs.EndOfContent;break;case 1:a=cs.Boolean;break;case 2:a=cs.Integer;break;case 3:a=cs.BitString;break;case 4:a=cs.OctetString;break;case 5:a=cs.Null;break;case 6:a=cs.ObjectIdentifier;break;case 10:a=cs.Enumerated;break;case 12:a=cs.Utf8String;break;case 13:a=cs.RelativeObjectIdentifier;break;case 14:a=cs.TIME;break;case 15:return o.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:o};case 16:a=cs.Sequence;break;case 17:a=cs.Set;break;case 18:a=cs.NumericString;break;case 19:a=cs.PrintableString;break;case 20:a=cs.TeletexString;break;case 21:a=cs.VideotexString;break;case 22:a=cs.IA5String;break;case 23:a=cs.UTCTime;break;case 24:a=cs.GeneralizedTime;break;case 25:a=cs.GraphicString;break;case 26:a=cs.VisibleString;break;case 27:a=cs.GeneralString;break;case 28:a=cs.UniversalString;break;case 29:a=cs.CharacterString;break;case 30:a=cs.BmpString;break;case 31:a=cs.DATE;break;case 32:a=cs.TimeOfDay;break;case 33:a=cs.DateTime;break;case 34:a=cs.Duration;break;default:{const e=o.idBlock.isConstructed?new cs.Constructed:new cs.Primitive;e.idBlock=o.idBlock,e.lenBlock=o.lenBlock,e.warnings=o.warnings,o=e}}}else a=o.idBlock.isConstructed?cs.Constructed:cs.Primitive;return o=function(e,t){if(e instanceof t)return e;const n=new t;return n.idBlock=e.idBlock,n.lenBlock=e.lenBlock,n.warnings=e.warnings,n.valueBeforeDecodeView=e.valueBeforeDecodeView,n}(o,a),s=o.fromBER(e,t,o.lenBlock.isIndefiniteForm?n:o.lenBlock.length),o.valueBeforeDecodeView=e.subarray(r,r+o.blockLength),{offset:s,result:o}}gs=Ks,cs.Primitive=gs,Ks.NAME="PRIMITIVE";class Ys extends as{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const r=Fi.toUint8Array(e);if(!Zi(this,r,t,n))return-1;if(this.valueBeforeDecodeView=r.subarray(t,t+n),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let o=t;for(;i=this.isIndefiniteForm,s=n,(i?1:s)>0;){const e=Zs(r,o,n);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(o=e.offset,this.blockLength+=e.result.blockLength,n-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===ns)break}var i,s;return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===ns?this.value.pop():this.warnings.push("No EndOfContent block encoded")),o}toBER(e,t){const n=t||new Yi;for(let r=0;r<this.value.length;r++)this.value[r].toBER(e,n);return t?es:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Ys.NAME="ConstructedValueBlock";class Js extends fs{constructor(e={}){super(e,Ys),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===r?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split("\n").map((e=>`  ${e}`)).join("\n"));const t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :\n${e.join("\n")}`:`${t} :`}}ys=Js,cs.Constructed=ys,Js.NAME="CONSTRUCTED";class Xs extends as{fromBER(e,t,n){return t}toBER(e){return es}}Xs.override="EndOfContentValueBlock";class Qs extends fs{constructor(e={}){super(e,Xs),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}ms=Qs,cs.EndOfContent=ms,Qs.NAME=ns;class ea extends fs{constructor(e={}){super(e,as),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const e=new Uint8Array(n);e[0]=5,e[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}bs=ea,cs.Null=bs,ea.NAME="NULL";class ta extends(is(as)){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=Fi.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,n){const r=Fi.toUint8Array(e);return Zi(this,r,t,n)?(this.valueHexView=r.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Gi.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}ta.NAME="BooleanValueBlock";class na extends fs{constructor(e={}){super(e,ta),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}vs=na,cs.Boolean=vs,na.NAME="BOOLEAN";class ra extends(is(Ys)){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let r=0;if(this.isConstructed){if(this.isHexOnly=!1,r=Ys.prototype.fromBER.call(this,e,t,n),-1===r)return r;for(let e=0;e<this.value.length;e++){const t=this.value[e].constructor.NAME;if(t===ns){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(t!==rs)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,r=super.fromBER(e,t,n),this.blockLength=n;return r}toBER(e,t){return this.isConstructed?Ys.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}ra.NAME="OctetStringValueBlock";class oa extends fs{constructor({idBlock:e={},lenBlock:t={},...n}={}){var r,o;null!==(r=n.isConstructed)&&void 0!==r||(n.isConstructed=!!(null===(o=n.value)||void 0===o?void 0:o.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},ra),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const o=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(o.byteLength){const e=Zs(o,0,o.byteLength);-1!==e.offset&&e.offset===n&&(this.valueBlock.value=[e.result])}}catch(r){}}return super.fromBER(e,t,n)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Js.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${$i.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof oa&&e.push(t.valueBlock.valueHexView);return Fi.concat(e)}}ws=oa,cs.OctetString=ws,oa.NAME=rs;class ia extends(is(Ys)){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let r=-1;if(this.isConstructed){if(r=Ys.prototype.fromBER.call(this,e,t,n),-1===r)return r;for(const e of this.value){const t=e.constructor.NAME;if(t===ns){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(t!==os)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const n=e.valueBlock;if(this.unusedBits>0&&n.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=n.unusedBits}return r}const o=Fi.toUint8Array(e);if(!Zi(this,o,t,n))return-1;const i=o.subarray(t,t+n);if(this.unusedBits=i[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const e=i.subarray(1);try{if(e.byteLength){const t=Zs(e,0,e.byteLength);-1!==t.offset&&t.offset===n-1&&(this.value=[t.result])}}catch(s){}}return this.valueHexView=i.subarray(1),this.blockLength=i.length,t+n}toBER(e,t){if(this.isConstructed)return Ys.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return es;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}ia.NAME="BitStringValueBlock";class sa extends fs{constructor({idBlock:e={},lenBlock:t={},...n}={}){var r,o;null!==(r=n.isConstructed)&&void 0!==r||(n.isConstructed=!!(null===(o=n.value)||void 0===o?void 0:o.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},ia),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Js.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const r of t)e.push(r.toString(2).padStart(8,"0"));const n=e.join("");return`${this.constructor.NAME} : ${n.substring(0,n.length-this.valueBlock.unusedBits)}`}}}function aa(e,t){const n=new Uint8Array([0]),r=new Uint8Array(e),o=new Uint8Array(t);let i=r.slice(0);const s=i.length-1,a=o.slice(0),u=a.length-1;let l=0;let c=0;for(let f=u<s?s:u;f>=0;f--,c++){if(!0===c<a.length)l=i[s-c]+a[u-c]+n[0];else l=i[s-c]+n[0];if(n[0]=l/10,!0===c>=i.length)i=Vi(new Uint8Array([l%10]),i);else i[s-c]=l%10}return n[0]>0&&(i=Vi(n,i)),i}function ua(e){if(e>=Ji.length)for(let t=Ji.length;t<=e;t++){const e=new Uint8Array([0]);let n=Ji[t-1].slice(0);for(let t=n.length-1;t>=0;t--){const r=new Uint8Array([(n[t]<<1)+e[0]]);e[0]=r[0]/10,n[t]=r[0]%10}e[0]>0&&(n=Vi(e,n)),Ji.push(n)}return Ji[e]}function la(e,t){let n=0;const r=new Uint8Array(e),o=new Uint8Array(t),i=r.slice(0),s=i.length-1,a=o.slice(0),u=a.length-1;let l,c=0;for(let f=u;f>=0;f--,c++)if(l=i[s-c]-a[u-c]-n,!0===l<0)n=1,i[s-c]=l+10;else n=0,i[s-c]=l;if(n>0)for(let f=s-u+1;f>=0;f--,c++){if(l=i[s-c]-n,!(l<0)){n=0,i[s-c]=l;break}n=1,i[s-c]=l+10}return i.slice()}Es=sa,cs.BitString=Es,sa.NAME=os;class ca extends(is(as)){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Gi.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){const t=e<0?-1*e:e;let n=128;for(let r=1;r<8;r++){if(t<=n){if(e<0){const e=zi(n-t,8,r);return new Uint8Array(e)[0]|=128,e}let o=zi(t,8,r),i=new Uint8Array(o);if(128&i[0]){const e=o.slice(0),t=new Uint8Array(e);o=new ArrayBuffer(o.byteLength+1),i=new Uint8Array(o);for(let n=0;n<e.byteLength;n++)i[n+1]=t[n];i[0]=0}return o}n*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,r=0){const o=this.fromBER(e,t,n);if(-1===o)return o;const i=this.valueHexView;return 0===i[0]&&0!==(128&i[1])?this.valueHexView=i.subarray(1):0!==r&&i.length<r&&(r-i.length>1&&(r=i.length+1),this.valueHexView=i.subarray(r-i.length)),o}toDER(e=!1){const t=this.valueHexView;switch(!0){case 0!==(128&t[0]):{const e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&0===(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,n){const r=super.fromBER(e,t,n);return-1===r||this.setValueHex(),r}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=8*this.valueHexView.length-1;let t,n=new Uint8Array(8*this.valueHexView.length/3),r=0;const o=this.valueHexView;let i="",s=!1;for(let a=o.byteLength-1;a>=0;a--){t=o[a];for(let o=0;o<8;o++){if(1===(1&t))if(r===e)n=la(ua(r),n),i="-";else n=aa(n,ua(r));r++,t>>=1}}for(let a=0;a<n.length;a++)n[a]&&(s=!0),s&&(i+=Xi.charAt(n[a]));return!1===s&&(i+=Xi.charAt(0)),i}}As=ca,ca.NAME="IntegerValueBlock",Object.defineProperty(As.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class fa extends fs{constructor(e={}){super(e,ca),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return qi(),BigInt(this.valueBlock.toString())}static fromBigInt(e){qi();const t=BigInt(e),n=new Yi,r=t.toString(16).replace(/^-/,""),o=new Uint8Array($i.FromHex(r));if(t<0){const e=new Uint8Array(o.length+(128&o[0]?1:0));e[0]|=128;const r=BigInt(`0x${$i.ToHex(e)}`)+t,i=Fi.toUint8Array($i.FromHex(r.toString(16)));i[0]|=128,n.write(i)}else 128&o[0]&&n.write(new Uint8Array([0])),n.write(o);return new fa({valueHex:n.final()})}convertToDER(){const e=new fa({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new fa({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}Cs=fa,cs.Integer=Cs,fa.NAME="INTEGER";class ha extends fa{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}Ss=ha,cs.Enumerated=Ss,ha.NAME="ENUMERATED";class da extends(is(as)){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const r=Fi.toUint8Array(e);if(!Zi(this,r,t,n))return-1;const o=r.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let s=0;s<n&&(this.valueHexView[s]=127&o[s],this.blockLength++,0!==(128&o[s]));s++);const i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength;s++)i[s]=this.valueHexView[s];return this.valueHexView=i,0!==(128&o[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Hi(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){qi();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let r=0;r<n.length;r++)n[r]=parseInt(t.slice(7*r,7*r+7),2)+(r+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,n=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)n[e]=128|t[e];return n[this.blockLength-1]=t[this.blockLength-1],n.buffer}const t=zi(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",es;const n=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),r=t.byteLength-1;for(let t=0;t<r;t++)n[t]=128|e[t];n[r]=e[r]}return n}toString(){let e="";if(this.isHexOnly)e=$i.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}da.NAME="sidBlock";class pa extends as{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let r=t;for(;n>0;){const t=new da;if(r=t.fromBER(e,r,n),-1===r)return this.blockLength=0,this.error=t.error,r;0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,n-=t.blockLength,this.value.push(t)}return r}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const r=this.value[n].toBER(e);if(0===r.byteLength)return this.error=this.value[n].error,es;t.push(r)}return Ki(t)}fromString(e){this.value=[];let t=0,n=0,r="",o=!1;do{if(n=e.indexOf(".",t),r=-1===n?e.substring(t):e.substring(t,n),t=n+1,o){const e=this.value[0];let t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:return void(this.value=[])}const n=parseInt(r,10);if(isNaN(n))return;e.valueDec=n+t,o=!1}else{const e=new da;if(r>Number.MAX_SAFE_INTEGER){qi();const t=BigInt(r);e.valueBigInt=t}else if(e.valueDec=parseInt(r,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,o=!0),this.value.push(e)}}while(-1!==n)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let r=this.value[n].toString();0!==n&&(e=`${e}.`),t?(r=`{${r}}`,this.value[n].isFirstSid?e=`2.{${r} - 80}`:e+=r):e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}pa.NAME="ObjectIdentifierValueBlock";class ga extends fs{constructor(e={}){super(e,pa),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Ts=ga,cs.ObjectIdentifier=Ts,ga.NAME="OBJECT IDENTIFIER";class ya extends(is(ss)){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(0===n)return t;const r=Fi.toUint8Array(e);if(!Zi(this,r,t,n))return-1;const o=r.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let s=0;s<n&&(this.valueHexView[s]=127&o[s],this.blockLength++,0!==(128&o[s]));s++);const i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength;s++)i[s]=this.valueHexView[s];return this.valueHexView=i,0!==(128&o[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Hi(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,n=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)n[e]=128|t[e];return n[this.blockLength-1]=t[this.blockLength-1],n.buffer}const t=zi(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",es;const n=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),r=t.byteLength-1;for(let t=0;t<r;t++)n[t]=128|e[t];n[r]=e[r]}return n.buffer}toString(){let e="";return e=this.isHexOnly?$i.ToHex(this.valueHexView):this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}ya.NAME="relativeSidBlock";class ma extends as{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let r=t;for(;n>0;){const t=new ya;if(r=t.fromBER(e,r,n),-1===r)return this.blockLength=0,this.error=t.error,r;this.blockLength+=t.blockLength,n-=t.blockLength,this.value.push(t)}return r}toBER(e,t){const n=[];for(let r=0;r<this.value.length;r++){const t=this.value[r].toBER(e);if(0===t.byteLength)return this.error=this.value[r].error,es;n.push(t)}return Ki(n)}fromString(e){this.value=[];let t=0,n=0,r="";do{n=e.indexOf(".",t),r=-1===n?e.substring(t):e.substring(t,n),t=n+1;const o=new ya;if(o.valueDec=parseInt(r,10),isNaN(o.valueDec))return!0;this.value.push(o)}while(-1!==n);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let r=this.value[n].toString();0!==n&&(e=`${e}.`),t?(r=`{${r}}`,e+=r):e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}ma.NAME="RelativeObjectIdentifierValueBlock";class ba extends fs{constructor(e={}){super(e,ma),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}ks=ba,cs.RelativeObjectIdentifier=ks,ba.NAME="RelativeObjectIdentifier";class va extends Js{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}xs=va,cs.Sequence=xs,va.NAME="SEQUENCE";class wa extends Js{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}Is=wa,cs.Set=Is,wa.NAME="SET";class Ea extends(is(as)){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Qi}toJSON(){return{...super.toJSON(),value:this.value}}}Ea.NAME="StringValueBlock";class Aa extends Ea{}Aa.NAME="SimpleStringValueBlock";class Ca extends ds{constructor({...e}={}){super(e,Aa)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,Fi.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);this.valueBlock.value=e}}Ca.NAME="SIMPLE STRING";class Sa extends Ca{fromBuffer(e){this.valueBlock.valueHexView=Fi.toUint8Array(e);try{this.valueBlock.value=$i.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=$i.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array($i.FromUtf8String(e)),this.valueBlock.value=e}}Sa.NAME="Utf8StringValueBlock";class Ta extends Sa{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}Os=Ta,cs.Utf8String=Os,Ta.NAME="UTF8String";class ka extends Ca{fromBuffer(e){this.valueBlock.value=$i.ToUtf16String(e),this.valueBlock.valueHexView=Fi.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array($i.FromUtf16String(e))}}ka.NAME="BmpStringValueBlock";class xa extends ka{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}Bs=xa,cs.BmpString=Bs,xa.NAME="BMPString";class Ia extends Ca{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let r=0;r<n.length;r+=4)n[r]=n[r+3],n[r+1]=n[r+2],n[r+2]=0,n[r+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let r=0;r<t;r++){const t=zi(e.charCodeAt(r),8),o=new Uint8Array(t);if(o.length>4)continue;const i=4-o.length;for(let e=o.length-1;e>=0;e--)n[4*r+e+i]=o[e]}this.valueBlock.value=e}}Ia.NAME="UniversalStringValueBlock";class Oa extends Ia{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}Ds=Oa,cs.UniversalString=Ds,Oa.NAME="UniversalString";class Ba extends Ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}Ns=Ba,cs.NumericString=Ns,Ba.NAME="NumericString";class Da extends Ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}Ps=Da,cs.PrintableString=Ps,Da.NAME="PrintableString";class Na extends Ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}Fs=Na,cs.TeletexString=Fs,Na.NAME="TeletexString";class Pa extends Ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}_s=Pa,cs.VideotexString=_s,Pa.NAME="VideotexString";class Fa extends Ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}Ls=Fa,cs.IA5String=Ls,Fa.NAME="IA5String";class _a extends Ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}Rs=_a,cs.GraphicString=Rs,_a.NAME="GraphicString";class La extends Ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}Us=La,cs.VisibleString=Us,La.NAME="VisibleString";class Ra extends Ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Ms=Ra,cs.GeneralString=Ms,Ra.NAME="GeneralString";class Ua extends Ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}js=Ua,cs.CharacterString=js,Ua.NAME="CharacterString";class Ma extends La{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,Fi.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null===t)return void(this.error="Wrong input string for conversion");const n=parseInt(t[1],10);this.year=n>=50?1900+n:2e3+n,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){const e=new Array(7);return e[0]=Wi(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=Wi(this.month,2),e[2]=Wi(this.day,2),e[3]=Wi(this.hour,2),e[4]=Wi(this.minute,2),e[5]=Wi(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}$s=Ma,cs.UTCTime=$s,Ma.NAME="UTCTime";class ja extends Ma{constructor(e={}){var t;super(e),null!==(t=this.millisecond)&&void 0!==t||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,n=!1,r="",o="",i=0,s=0,a=0;if("Z"===e[e.length-1])r=e.substring(0,e.length-1),n=!0;else{const t=new Number(e[e.length-1]);if(isNaN(t.valueOf()))throw new Error("Wrong input string for conversion");r=e}if(n){if(-1!==r.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==r.indexOf("-"))throw new Error("Wrong input string for conversion")}else{let e=1,t=r.indexOf("+"),n="";if(-1===t&&(t=r.indexOf("-"),e=-1),-1!==t){if(n=r.substring(t+1),r=r.substring(0,t),2!==n.length&&4!==n.length)throw new Error("Wrong input string for conversion");let o=parseInt(n.substring(0,2),10);if(isNaN(o.valueOf()))throw new Error("Wrong input string for conversion");if(s=e*o,4===n.length){if(o=parseInt(n.substring(2,4),10),isNaN(o.valueOf()))throw new Error("Wrong input string for conversion");a=e*o}}}let u=r.indexOf(".");if(-1===u&&(u=r.indexOf(",")),-1!==u){const e=new Number(`0${r.substring(u)}`);if(isNaN(e.valueOf()))throw new Error("Wrong input string for conversion");i=e.valueOf(),o=r.substring(0,u)}else o=r;switch(!0){case 8===o.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==u)throw new Error("Wrong input string for conversion");break;case 10===o.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==u){let e=60*i;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===o.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==u){let e=60*i;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===o.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==u){const e=1e3*i;this.millisecond=Math.floor(e)}break;default:throw new Error("Wrong input string for conversion")}const l=t.exec(o);if(null===l)throw new Error("Wrong input string for conversion");for(let c=1;c<l.length;c++)switch(c){case 1:this.year=parseInt(l[c],10);break;case 2:this.month=parseInt(l[c],10);break;case 3:this.day=parseInt(l[c],10);break;case 4:this.hour=parseInt(l[c],10)+s;break;case 5:this.minute=parseInt(l[c],10)+a;break;case 6:this.second=parseInt(l[c],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===n){const e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){const e=[];return e.push(Wi(this.year,4)),e.push(Wi(this.month,2)),e.push(Wi(this.day,2)),e.push(Wi(this.hour,2)),e.push(Wi(this.minute,2)),e.push(Wi(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(Wi(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}Hs=ja,cs.GeneralizedTime=Hs,ja.NAME="GeneralizedTime";class $a extends Ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}zs=$a,cs.DATE=zs,$a.NAME="DATE";class Ha extends Ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Vs=Ha,cs.TimeOfDay=Vs,Ha.NAME="TimeOfDay";class za extends Ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}Gs=za,cs.DateTime=Gs,za.NAME="DateTime";class Va extends Ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}Ws=Va,cs.Duration=Ws,Va.NAME="Duration";class Ga extends Ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}qs=Ga,cs.TIME=qs,Ga.NAME="TIME";class Wa extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class qa extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const Ka={get(e=globalThis){const t=e.crypto;if(null==t?.subtle)throw new qa("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};class Za{type="RSA";_key;_raw;_multihash;constructor(e,t){this._key=e,this._multihash=t}get raw(){return null==this._raw&&(this._raw=function(e){if(null==e.n||null==e.e)throw new et("JWK was missing components");const t=new va({value:[new va({value:[new ga({value:"1.2.840.113549.1.1.1"}),new ea]}),new sa({valueHex:new va({value:[fa.fromBigInt(Xa((0,oe.s)(e.n,"base64url"))),fa.fromBigInt(Xa((0,oe.s)(e.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(t,0,t.byteLength)}(this._key)),this._raw}toMultihash(){return this._multihash}toCID(){return K.T.createV1(114,this._multihash)}toString(){return y.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&Z(this.raw,e.raw)}verify(e,t){return async function(e,t,n){const r=await Ka.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Ka.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n instanceof Uint8Array?n:n.subarray())}(this._key,t,e)}}function Ya(e){const{result:t}=function(e){if(!e.byteLength){const e=new fs({},as);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Zs(Fi.toUint8Array(e).slice(),0,e.byteLength)}(e),n=t.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:J(Ja(n[0].toBigInt()),"base64url"),e:J(Ja(n[1].toBigInt()),"base64url")}}function Ja(e){let t=e.toString(16);t.length%2>0&&(t=`0${t}`);const n=t.length/2,r=new Uint8Array(n);let o=0,i=0;for(;o<n;)r[o]=parseInt(t.slice(i,i+2),16),o+=1,i+=2;return r}function Xa(e){const t=[];return e.forEach((function(e){let n=e.toString(16);n.length%2>0&&(n=`0${n}`),t.push(n)})),BigInt("0x"+t.join(""))}function Qa(e){const t=Ya(e);if(function(e){if("RSA"!==e.kty)throw new et("invalid key type");if(null==e.n)throw new et("invalid key modulus");return 8*(0,oe.s)(e.n,"base64url").length}(t)>8192)throw new tt("Key size is too large");const n=Ni(Ai.encode({Type:wi.RSA,Data:e})),r=(0,re.vt)(18,n);return new Za(t,r)}class eu extends mt{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!==typeof e||"function"!==typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");ft(e.outputLen),ft(e.blockLen)}(e);const n=yt(t);if(this.iHash=e.create(),"function"!==typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?e.create().update(n).digest():n);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=e.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),o.fill(0)}update(e){return dt(this),this.iHash.update(e),this}digestInto(e){dt(this),ht(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=r,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const tu=(e,t,n)=>new eu(e,t).update(n).digest();function nu(e){void 0!==e.lowS&&oo("lowS",e.lowS),void 0!==e.prehash&&oo("prehash",e.prehash)}tu.create=(e,t)=>new eu(e,t);const{Ph:ru,aT:ou}=r,iu={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(e,t)=>{const{Err:n}=iu;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(1&t.length)throw new n("tlv.encode: unpadded data");const r=t.length/2,o=ao(r);if(o.length/2&128)throw new n("tlv.encode: long form length too big");const i=r>127?ao(o.length/2|128):"";return`${ao(e)}${i}${o}${t}`},decode(e,t){const{Err:n}=iu;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const o=t[r++];let i=0;if(!!(128&o)){const e=127&o;if(!e)throw new n("tlv.decode(long): indefinite length not supported");if(e>4)throw new n("tlv.decode(long): byte length is too big");const s=t.subarray(r,r+e);if(s.length!==e)throw new n("tlv.decode: length bytes not complete");if(0===s[0])throw new n("tlv.decode(long): zero leftmost byte");for(const t of s)i=i<<8|t;if(r+=e,i<128)throw new n("tlv.decode(long): not minimal encoding")}else i=o;const s=t.subarray(r,r+i);if(s.length!==i)throw new n("tlv.decode: wrong value length");return{v:s,l:t.subarray(r+i)}}},_int:{encode(e){const{Err:t}=iu;if(e<su)throw new t("integer: negative integers are not allowed");let n=ao(e);if(8&Number.parseInt(n[0],16)&&(n="00"+n),1&n.length)throw new t("unexpected assertion");return n},decode(e){const{Err:t}=iu;if(128&e[0])throw new t("Invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("Invalid signature integer: unnecessary leading zero");return ru(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=iu,o="string"===typeof e?ou(e):e;ro(o);const{v:i,l:s}=r.decode(48,o);if(s.length)throw new t("Invalid signature: left bytes after parsing");const{v:a,l:u}=r.decode(2,i),{v:l,l:c}=r.decode(2,u);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(l)}},hexFromSig(e){const{_tlv:t,_int:n}=iu,r=`${t.encode(2,n.encode(e.r))}${t.encode(2,n.encode(e.s))}`;return t.encode(48,r)}},su=BigInt(0),au=BigInt(1);BigInt(2);const uu=BigInt(3);function lu(e){const t=function(e){const t=Qo(e);Io(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!==typeof n||"bigint"!==typeof n.beta||"function"!==typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=Vo(t.n,t.nBitLength),o=t.toBytes||((e,t,r)=>{const o=t.toAffine();return bo(Uint8Array.from([4]),n.toBytes(o.x),n.toBytes(o.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function s(e){const{a:r,b:o}=t,i=n.sqr(e),s=n.mul(i,e);return n.add(n.add(s,n.mul(e,r)),o)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function a(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:o,n:i}=t;if(n&&"bigint"!==typeof e){if(no(e)&&(e=so(e)),"string"!==typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"===typeof e?e:ho(mo("private key",e,r))}catch(a){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return o&&(s=Ro(s,i)),Eo("private key",s,au,i),s}function u(e){if(!(e instanceof f))throw new Error("ProjectivePoint expected")}const l=Oo(((e,t)=>{const{px:r,py:o,pz:i}=e;if(n.eql(i,n.ONE))return{x:r,y:o};const s=e.is0();null==t&&(t=s?n.ONE:n.inv(i));const a=n.mul(r,t),u=n.mul(o,t),l=n.mul(i,t);if(s)return{x:n.ZERO,y:n.ZERO};if(!n.eql(l,n.ONE))throw new Error("invZ was invalid");return{x:a,y:u}})),c=Oo((e=>{if(e.is0()){if(t.allowInfinityPoint&&!n.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:r,y:o}=e.toAffine();if(!n.isValid(r)||!n.isValid(o))throw new Error("bad point: x or y not FE");const i=n.sqr(o),a=s(r);if(!n.eql(i,a))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0}));class f{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required");Object.freeze(this)}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof f)throw new Error("projective point not allowed");const o=e=>n.eql(e,n.ZERO);return o(t)&&o(r)?f.ZERO:new f(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(f.fromAffine)}static fromHex(e){const t=f.fromAffine(i(mo("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return f.BASE.multiply(a(e))}static msm(e,t){return Xo(f,r,e,t)}_setWindowSize(e){d.setWindowSize(this,e)}assertValidity(){c(this)}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){u(e);const{px:t,py:r,pz:o}=this,{px:i,py:s,pz:a}=e,l=n.eql(n.mul(t,a),n.mul(i,o)),c=n.eql(n.mul(r,a),n.mul(s,o));return l&&c}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,o=n.mul(r,uu),{px:i,py:s,pz:a}=this;let u=n.ZERO,l=n.ZERO,c=n.ZERO,h=n.mul(i,i),d=n.mul(s,s),p=n.mul(a,a),g=n.mul(i,s);return g=n.add(g,g),c=n.mul(i,a),c=n.add(c,c),u=n.mul(e,c),l=n.mul(o,p),l=n.add(u,l),u=n.sub(d,l),l=n.add(d,l),l=n.mul(u,l),u=n.mul(g,u),c=n.mul(o,c),p=n.mul(e,p),g=n.sub(h,p),g=n.mul(e,g),g=n.add(g,c),c=n.add(h,h),h=n.add(c,h),h=n.add(h,p),h=n.mul(h,g),l=n.add(l,h),p=n.mul(s,a),p=n.add(p,p),h=n.mul(p,g),u=n.sub(u,h),c=n.mul(p,d),c=n.add(c,c),c=n.add(c,c),new f(u,l,c)}add(e){u(e);const{px:r,py:o,pz:i}=this,{px:s,py:a,pz:l}=e;let c=n.ZERO,h=n.ZERO,d=n.ZERO;const p=t.a,g=n.mul(t.b,uu);let y=n.mul(r,s),m=n.mul(o,a),b=n.mul(i,l),v=n.add(r,o),w=n.add(s,a);v=n.mul(v,w),w=n.add(y,m),v=n.sub(v,w),w=n.add(r,i);let E=n.add(s,l);return w=n.mul(w,E),E=n.add(y,b),w=n.sub(w,E),E=n.add(o,i),c=n.add(a,l),E=n.mul(E,c),c=n.add(m,b),E=n.sub(E,c),d=n.mul(p,w),c=n.mul(g,b),d=n.add(c,d),c=n.sub(m,d),d=n.add(m,d),h=n.mul(c,d),m=n.add(y,y),m=n.add(m,y),b=n.mul(p,b),w=n.mul(g,w),m=n.add(m,b),b=n.sub(y,b),b=n.mul(p,b),w=n.add(w,b),y=n.mul(m,w),h=n.add(h,y),y=n.mul(E,w),c=n.mul(v,c),c=n.sub(c,y),y=n.mul(v,m),d=n.mul(E,d),d=n.add(d,y),new f(c,h,d)}subtract(e){return this.add(e.negate())}is0(){return this.equals(f.ZERO)}wNAF(e){return d.wNAFCached(this,e,f.normalizeZ)}multiplyUnsafe(e){Eo("scalar",e,su,t.n);const r=f.ZERO;if(e===su)return r;if(e===au)return this;const{endo:o}=t;if(!o)return d.unsafeLadder(this,e);let{k1neg:i,k1:s,k2neg:a,k2:u}=o.splitScalar(e),l=r,c=r,h=this;for(;s>su||u>su;)s&au&&(l=l.add(h)),u&au&&(c=c.add(h)),h=h.double(),s>>=au,u>>=au;return i&&(l=l.negate()),a&&(c=c.negate()),c=new f(n.mul(c.px,o.beta),c.py,c.pz),l.add(c)}multiply(e){const{endo:r,n:o}=t;let i,s;if(Eo("scalar",e,au,o),r){const{k1neg:t,k1:o,k2neg:a,k2:u}=r.splitScalar(e);let{p:l,f:c}=this.wNAF(o),{p:h,f:p}=this.wNAF(u);l=d.constTimeNegate(t,l),h=d.constTimeNegate(a,h),h=new f(n.mul(h.px,r.beta),h.py,h.pz),i=l.add(h),s=c.add(p)}else{const{p:t,f:n}=this.wNAF(e);i=t,s=n}return f.normalizeZ([i,s])[0]}multiplyAndAddUnsafe(e,t,n){const r=f.BASE,o=(e,t)=>t!==su&&t!==au&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),i=o(this,t).add(o(e,n));return i.is0()?void 0:i}toAffine(e){return l(this,e)}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===au)return!0;if(n)return n(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===au?this:n?n(f,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return oo("isCompressed",e),this.assertValidity(),o(f,this,e)}toHex(e=!0){return oo("isCompressed",e),so(this.toRawBytes(e))}}f.BASE=new f(t.Gx,t.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const h=t.nBitLength,d=Jo(f,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:function(e){return wo(e,au,t.n)}}}function cu(e){const t=function(e){const t=Qo(e);return Io(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,o=n.BYTES+1,i=2*n.BYTES+1;function s(e){return Ro(e,r)}function a(e){return jo(e,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:l,weierstrassEquation:c,isWithinCurveOrder:f}=lu({...t,toBytes(e,t,r){const o=t.toAffine(),i=n.toBytes(o.x),s=bo;return oo("isCompressed",r),r?s(Uint8Array.from([t.hasEvenY()?2:3]),i):s(Uint8Array.from([4]),i,n.toBytes(o.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==o||2!==r&&3!==r){if(t===i&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}{const e=ho(s);if(!wo(e,au,n.ORDER))throw new Error("Point is not on curve");const t=c(e);let o;try{o=n.sqrt(t)}catch(a){const e=a instanceof Error?": "+a.message:"";throw new Error("Point is not on curve"+e)}return 1===(1&r)!==((o&au)===au)&&(o=n.neg(o)),{x:e,y:o}}}}),h=e=>so(go(e,t.nByteLength));function d(e){return e>r>>au}const p=(e,t,n)=>ho(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=mo("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=iu.toSig(mo("DER",e));return new g(t,n)}assertValidity(){Eo("r",this.r,au,r),Eo("s",this.s,au,r)}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:r,s:o,recovery:i}=this,l=v(mo("msgHash",e));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const c=2===i||3===i?r+t.n:r;if(c>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const f=0===(1&i)?"02":"03",d=u.fromHex(f+h(c)),p=a(c),g=s(-l*p),y=s(o*p),m=u.BASE.multiplyAndAddUnsafe(d,g,y);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return fo(this.toDERHex())}toDERHex(){return iu.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return fo(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const y={isValidPrivateKey(e){try{return l(e),!0}catch(t){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const e=Wo(t.n);return function(e,t,n=!1){const r=e.length,o=Go(t),i=Wo(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const s=Ro(n?ho(e):po(e),t-Do)+Do;return n?yo(s,o):go(s,o)}(t.randomBytes(e),t.n)},precompute:(e=8,t=u.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function m(e){const t=no(e),n="string"===typeof e,r=(t||n)&&e.length;return t?r===o||r===i:n?r===2*o||r===2*i:e instanceof u}const b=t.bits2int||function(e){const n=ho(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},v=t.bits2int_modN||function(e){return s(b(e))},w=Co(t.nBitLength);function E(e){return Eo(`num < 2^${t.nBitLength}`,e,su,w),go(e,t.nByteLength)}function A(e,r,o=C){if(["recovered","canonical"].some((e=>e in o)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:c}=t;let{lowS:h,prehash:p,extraEntropy:y}=o;null==h&&(h=!0),e=mo("msgHash",e),nu(o),p&&(e=mo("prehashed msgHash",i(e)));const m=v(e),w=l(r),A=[E(w),E(m)];if(null!=y&&!1!==y){const e=!0===y?c(n.BYTES):y;A.push(mo("extraEntropy",e))}const S=bo(...A),T=m;return{seed:S,k2sig:function(e){const t=b(e);if(!f(t))return;const n=a(t),r=u.BASE.multiply(t).toAffine(),o=s(r.x);if(o===su)return;const i=s(n*s(T+o*w));if(i===su)return;let l=(r.x===o?0:2)|Number(r.y&au),c=i;return h&&d(i)&&(c=function(e){return d(e)?s(-e):e}(i),l^=1),new g(o,c,l)}}}const C={lowS:t.lowS,prehash:!1},S={lowS:t.lowS,prehash:!1};return u.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return u.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(m(e))throw new Error("first arg must be private key");if(!m(t))throw new Error("second arg must be public key");return u.fromHex(t).multiply(l(e)).toRawBytes(n)},sign:function(e,n,r=C){const{seed:o,k2sig:i}=A(e,n,r),s=t;return ko(s.hash.outputLen,s.nByteLength,s.hmac)(o,i)},verify:function(e,n,r,o=S){const i=e;if(n=mo("msgHash",n),r=mo("publicKey",r),"strict"in o)throw new Error("options.strict was renamed to lowS");nu(o);const{lowS:l,prehash:c}=o;let f,h;try{if("string"===typeof i||no(i))try{f=g.fromDER(i)}catch(A){if(!(A instanceof iu.Err))throw A;f=g.fromCompact(i)}else{if("object"!==typeof i||"bigint"!==typeof i.r||"bigint"!==typeof i.s)throw new Error("PARSE");{const{r:e,s:t}=i;f=new g(e,t)}}h=u.fromHex(r)}catch(C){if("PARSE"===C.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(l&&f.hasHighS())return!1;c&&(n=t.hash(n));const{r:d,s:p}=f,y=v(n),m=a(p),b=s(y*m),w=s(d*m),E=u.BASE.multiplyAndAddUnsafe(h,b,w)?.toAffine();return!!E&&s(E.x)===d},ProjectivePoint:u,Signature:g,utils:y}}function fu(e){return{hash:e,hmac:(t,...n)=>tu(e,t,function(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];ht(n),t+=n.length}const n=new Uint8Array(t);for(let r=0,o=0;r<e.length;r++){const t=e[r];n.set(t,o),o+=t.length}return n}(...n)),randomBytes:vt}}BigInt(4);const hu=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),du=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),pu=BigInt(1),gu=BigInt(2),yu=(e,t)=>(e+t/gu)/t;const mu=Vo(hu,void 0,void 0,{sqrt:function(e){const t=hu,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),u=BigInt(88),l=e*e*e%t,c=l*l*e%t,f=Mo(c,n,t)*c%t,h=Mo(f,n,t)*c%t,d=Mo(h,gu,t)*l%t,p=Mo(d,o,t)*d%t,g=Mo(p,i,t)*p%t,y=Mo(g,a,t)*g%t,m=Mo(y,u,t)*y%t,b=Mo(m,a,t)*g%t,v=Mo(b,n,t)*c%t,w=Mo(v,s,t)*p%t,E=Mo(w,r,t)*l%t,A=Mo(E,gu,t);if(!mu.eql(mu.sqr(A),e))throw new Error("Cannot find square root");return A}}),bu=function(e,t){const n=t=>cu({...e,...fu(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:mu,n:du,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=du,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-pu*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),a=yu(i*e,t),u=yu(-r*e,t);let l=Ro(e-a*n-u*o,t),c=Ro(-a*r-u*i,t);const f=l>s,h=c>s;if(f&&(l=t-l),h&&(c=t-c),l>s||c>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:f,k1:l,k2neg:h,k2:c}}}},Ni);BigInt(0),bu.ProjectivePoint;n(9728),n(918),n(8151),n(1124),n(1025),n(7290);class vu{type="secp256k1";raw;_key;constructor(e){this._key=function(e){try{return bu.ProjectivePoint.fromHex(e),e}catch(t){throw new tt(String(t))}}(e),this.raw=function(e){const t=bu.ProjectivePoint.fromHex(e).toRawBytes(!0);return t}(this._key)}toMultihash(){return yr.D.digest(Au(this))}toCID(){return K.T.createV1(114,this.toMultihash())}toString(){return y.base58btc.encode(this.toMultihash().bytes).substring(1)}equals(e){return null!=e&&e.raw instanceof Uint8Array&&Z(this.raw,e.raw)}verify(e,t){return function(e,t,n){const r=mr.s.digest(n instanceof Uint8Array?n:n.subarray());if(null!=(o=r)&&"function"===typeof o.then&&"function"===typeof o.catch&&"function"===typeof o.finally)return r.then((({digest:n})=>bu.verify(t,n,e))).catch((e=>{throw new Wa(String(e))}));var o;try{return bu.verify(t,r.digest,e)}catch(i){throw new Wa(String(i))}}(this._key,t,e)}}function wu(e){return new vu(e)}function Eu(e){const{Type:t,Data:n}=Ai.decode(e.digest),r=n??new Uint8Array;switch(t){case wi.Ed25519:return bi(r);case wi.secp256k1:return wu(r);default:throw new it}}function Au(e){return Ai.encode({Type:wi[e.type],Data:e.raw})}const Cu=Symbol.for("@libp2p/peer-id"),Su=Symbol.for("nodejs.util.inspect.custom");class Tu{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Cu]=!0;toString(){return null==this.string&&(this.string=y.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return K.T.createV1(114,this.multihash)}toJSON(){return this.toString()}equals(e){if(null==e)return!1;if(e instanceof Uint8Array)return Z(this.multihash.bytes,e);if("string"===typeof e)return this.toString()===e;if(null!=e?.toMultihash()?.bytes)return Z(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[Su](){return`PeerId(${this.toString()})`}}class ku extends Tu{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class xu extends Tu{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}}class Iu extends Tu{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}}class Ou{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=yr.D.digest((0,oe.s)(this.url))}[Su](){return`PeerId(${this.url})`}[Cu]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return K.T.createV1(2336,this.toMultihash())}toJSON(){return this.toString()}equals(e){return null!=e&&(e instanceof Uint8Array&&(e=J(e)),e.toString()===this.toString())}}function Bu(e,t){let n;if("1"!==e.charAt(0)&&"Q"!==e.charAt(0))throw new et('Please pass a multibase decoder for strings that do not start with "1" or "Q"');return n=(0,re.D4)(y.base58btc.decode(`z${e}`)),Du(n)}function Du(e){if(function(e){return e.code===mr.s.code}(e))return new ku({multihash:e});if(function(e){return e.code===yr.D.code}(e))try{const t=Eu(e);if("Ed25519"===t.type)return new xu({multihash:e,publicKey:t});if("secp256k1"===t.type)return new Iu({multihash:e,publicKey:t})}catch(t){const n=J(e.digest);return new Ou(new URL(n))}throw new ot("Supplied PeerID Multihash is invalid")}function Nu(e){if(null==e?.multihash||null==e.version||1===e.version&&114!==e.code&&2336!==e.code)throw new rt("Supplied PeerID CID is invalid");if(2336===e.code){const t=J(e.multihash.digest);return new Ou(new URL(t))}return Du(e.multihash)}async function*Pu(e,t={}){const n=e.getReader();try{for(;;){const e=await n.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await n.cancel(),n.releaseLock()}}var Fu={exports:{}};!function(e){!function(){e.exports=y;var t=86400,n=3200,r=146097*n/400,o=t*r,i=1e3*o,s=864e13,a=4294967296,u=1e6,l="000000000",c=Math.trunc||function(e){var t=e-e%1;return 0==t&&(e<0||0===e&&1/e!=1/0)?-0:t},f=y.prototype,h=(y.fromDate=function(e){return new y(+e)},y.fromInt64BE=E(0,1,2,3,0,4),y.fromInt64LE=E(3,2,1,0,4,0),y.fromString=function(e){var t,n=new y;e=(e+="").replace(/^\s*[+\-]?\d+/,(function(e){var t=1970+((e=+e)-1970)%400;return n.year=e-t,t})).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,(function(e,n,r){return n<0&&(r*=-1),t=6e4*(60*+n+ +r),""})).replace(/\.\d+$/,(function(e){return n.nano=+(e+l).substr(1,9),""})).split(/\D+/);if(1<e.length?e[1]--:e[1]=0,n.time=t=Date.UTC.apply(Date,e)-(t||0),isNaN(t))throw new TypeError("Invalid Date");return m(n)},y.fromTimeT=function(e){return v(e,0)},f.year=0,f.time=0,f.nano=0,f.addNano=function(e){return this.nano+=+e||0,this},f.getNano=function(){var e=m(this);return(e.time%1e3*u+ +e.nano+1e9)%1e9},f.getTimeT=function(){var e=m(this),o=Math.floor(e.time/1e3);return(e=e.year)&&(o+=e*r*t/n),o},f.getYear=function(){return this.toDate().getUTCFullYear()+this.year},f.toDate=function(){return b(m(this).time)},f.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},f.toString=function(e){var t=this,n=t.toDate(),r={H:function(){return C(n.getUTCHours())},L:function(){return S(n.getUTCMilliseconds(),3)},M:function(){return C(n.getUTCMinutes())},N:function(){return S(t.getNano(),9)},S:function(){return C(n.getUTCSeconds())},Y:function(){var e=t.getYear();return 999999<e?"+"+e:9999<e?"+"+S(e,6):0<=e?S(e,4):-999999<=e?"-"+S(-e,6):e},a:function(){return p[n.getUTCDay()]},b:function(){return d[n.getUTCMonth()]},d:function(){return C(n.getUTCDate())},e:function(){return function(e){return(9<e?"":" ")+(0|e)}(n.getUTCDate())},m:function(){return C(n.getUTCMonth()+1)}};return function e(t){return t.replace(/%./g,(function(t){var n=t[1],o=g[n];n=r[n];return o?e(o):n?n():t}))}(e||h)},f.writeInt64BE=w(0,1,2,3,0,4),f.writeInt64LE=w(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:"\n",R:"%H:%M",T:"%H:%M:%S",t:"\t",X:"%T",Z:"GMT",z:"+0000"};return y;function y(e,t,n){var r=this;if(!(r instanceof y))return new y(e,t,n);r.time=+e||0,r.nano=+t||0,r.year=+n||0,m(r)}function m(e){var t,r,o,a=e.year,l=e.time,f=e.nano,h=((f<0||u<=f)&&(f-=(r=Math.floor(f/u))*u,l+=r,r=1),a%n);return(l<-s||s<l||h)&&((t=c(l/i))&&(a+=t*n,l-=t*i),(o=b(l)).setUTCFullYear(h+o.getUTCFullYear()),o=(l=+o)+(t=c((a-=h)/n))*i,t&&-s<=o&&o<=s&&(a-=t*n,l=o),r=1),r&&(e.year=a,e.time=l,e.nano=f),e}function b(e){var t=new Date(0);return t.setTime(e),t}function v(e,t){e=+e||0;var r=c((t=(0|t)*a)/o)+c(e/o);return(e=c((t=t%o+e%o)/o))&&(r+=e,t-=e*o),new y(1e3*t,0,r*n)}function w(e,o,i,s,u,l){return function(e,o){var i=m(this);A(e=e||new Array(8),o|=0);var s=Math.floor(i.time/1e3),h=(i=i.year*(r*t/n),c(i/a)+c(s/a));i=i%a+s%a;return(s=Math.floor(i/a))&&(h+=s,i-=s*a),f(e,o+u,h),f(e,o+l,i),e};function f(t,n,r){t[n+e]=r>>24&255,t[n+o]=r>>16&255,t[n+i]=r>>8&255,t[n+s]=255&r}}function E(e,t,n,r,o,i){return function(e,t){A(e,t|=0);var n=s(e,t+o);return v(s(e,t+i),n)};function s(o,i){return 16777216*o[i+e]+(o[i+t]<<16|o[i+n]<<8|o[i+r])}}function A(e,t){if(null==(e=e&&e.length))throw new TypeError("Invalid Buffer");if(e<t+8)throw new RangeError("Out of range")}function C(e){return(9<e?"":"0")+(0|e)}function S(e,t){return(l+(0|e)).substr(-t)}}()}(Fu);var _u=Fu.exports;const Lu=(0,h.g)(_u);class Ru extends Error{static name="SignatureVerificationError";constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}class Uu extends Error{static name="RecordExpiredError";constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}class Mu extends Error{static name="UnsupportedValidityError";constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}class ju extends Error{static name="RecordTooLargeError";constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}class $u extends Error{static name="InvalidValueError";constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}class Hu extends Error{static name="InvalidRecordDataError";constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}class zu extends Error{static name="InvalidEmbeddedPublicKeyError";constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}var Vu;!function(e){let t,n;(e.ValidityType||(e.ValidityType={})).EOL="EOL",function(e){e[e.EOL=0]="EOL"}(t||(t={})),function(e){e.codec=()=>(0,ki.e)(t)}(e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==n&&(n=(0,xi.i)(((t,n,r={})=>{!1!==r.lengthDelimited&&n.fork(),null!=t.value&&(n.uint32(10),n.bytes(t.value)),null!=t.signatureV1&&(n.uint32(18),n.bytes(t.signatureV1)),null!=t.validityType&&(n.uint32(24),e.ValidityType.codec().encode(t.validityType,n)),null!=t.validity&&(n.uint32(34),n.bytes(t.validity)),null!=t.sequence&&(n.uint32(40),n.uint64(t.sequence)),null!=t.ttl&&(n.uint32(48),n.uint64(t.ttl)),null!=t.pubKey&&(n.uint32(58),n.bytes(t.pubKey)),null!=t.signatureV2&&(n.uint32(66),n.bytes(t.signatureV2)),null!=t.data&&(n.uint32(74),n.bytes(t.data)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n,r={})=>{const o={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:o.value=t.bytes();break;case 2:o.signatureV1=t.bytes();break;case 3:o.validityType=e.ValidityType.codec().decode(t);break;case 4:o.validity=t.bytes();break;case 5:o.sequence=t.uint64();break;case 6:o.ttl=t.uint64();break;case 7:o.pubKey=t.bytes();break;case 8:o.signatureV2=t.bytes();break;case 9:o.data=t.bytes();break;default:t.skipType(7&n)}}return o}))),n),e.encode=t=>(0,Ti.m)(t,e.codec()),e.decode=(t,n)=>(0,Si.Y)(t,e.codec(),n)}(Vu||(Vu={}));const Gu=Qt("ipns:utils"),Wu=(0,oe.s)("/ipns/");function qu(e){let t;if(null!=e.pubKey)try{t=function(e){const{Type:t,Data:n}=Ai.decode(e),r=n??new Uint8Array;switch(t){case wi.RSA:return Qa(r);case wi.Ed25519:return bi(r);case wi.secp256k1:return wu(r);default:throw new it}}(e.pubKey)}catch(n){throw Gu.error(n),n}if(null!=t)return t}function Ku(e){return"signatureV1"in e?Vu.encode({value:(0,oe.s)(e.value),signatureV1:e.signatureV1,validityType:e.validityType,validity:(0,oe.s)(e.validity),sequence:e.sequence,ttl:e.ttl,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data}):Vu.encode({pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data})}function Zu(e){const t=Vu.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw new Ru("Missing data or signatureV2");const n=Xu(t.data),r=function(e){const t=J(e).trim();if(t.startsWith("/"))return t;try{return`/ipfs/${K.T.decode(e).toV1().toString()}`}catch{}try{return`/ipfs/${K.T.parse(t).toV1().toString()}`}catch{}throw new $u("Value must be a valid content path starting with /")}(n.Value),o=J(n.Validity);if(null!=t.value&&null!=t.signatureV1)return function(e){if(null==e.data)throw new Hu("Record data is missing");const t=Xu(e.data);if(!Z(t.Value,e.value??new Uint8Array(0)))throw new Ru('Field "value" did not match between protobuf and CBOR');if(!Z(t.Validity,e.validity??new Uint8Array(0)))throw new Ru('Field "validity" did not match between protobuf and CBOR');if(t.ValidityType!==e.validityType)throw new Ru('Field "validityType" did not match between protobuf and CBOR');if(t.Sequence!==e.sequence)throw new Ru('Field "sequence" did not match between protobuf and CBOR');if(t.TTL!==e.ttl)throw new Ru('Field "ttl" did not match between protobuf and CBOR')}(t),{value:r,validityType:Vu.ValidityType.EOL,validity:o,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:r,validityType:Vu.ValidityType.EOL,validity:o,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function Yu(e){return ee([Wu,e.bytes])}function Ju(e){const t=(0,re.D4)(e.slice(Wu.length));if(!Qu(t,0)&&!Qu(t,18))throw new ot("Multihash in IPNS key was not identity or sha2-256");return t}function Xu(e){const t=(0,An.D4)(e);if(0!==t.ValidityType)throw new Mu("The validity type is unsupported");return t.ValidityType=Vu.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t}function Qu(e,t){return e.code===t}const el=Qt("ipns:validator"),tl=async(e,t)=>{const n=Zu(t);let r;try{const t=(o=n.data,ee([(0,oe.s)("ipns-signature:"),o]));r=await e.verify(t,n.signatureV2)}catch(i){r=!1}var o;if(!r)throw el.error("record signature verification failed"),new Ru("Record signature verification failed");if(n.validityType===Vu.ValidityType.EOL){if(Lu.fromString(n.validity).toDate().getTime()<Date.now())throw el.error("record has expired"),new Uu("record has expired")}else if(null!=n.validityType)throw el.error("the validity type is unsupported"),new Mu("The validity type is unsupported");el("ipns record for %s is valid",n.value)};async function*nl(e){const t=/\r?\n/,n=new TextDecoder("utf8");let r="";for await(let o of e){"string"===typeof o&&(o=(new TextEncoder).encode(o)),r+=n.decode(o,{stream:!0});const e=r.split(t);r=e.pop()??"";for(let t=0;t<e.length;t++)yield JSON.parse(e[t])}r+=n.decode(),""!==r&&(yield JSON.parse(r))}class rl extends Error{static name="InvalidRequestError";constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}class ol extends Error{static name="BadResponseError";constructor(e="Bad response"){super(e),this.name="BadResponseError"}}function il(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t}function sl(e,t){let n=0;if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)yield t(r,n++)}();const r=Ar(e),{value:o,done:i}=r.next();if(!0===i)return function*(){}();const s=t(o,n++);if("function"===typeof s.then)return async function*(){yield await s;for await(const e of r)yield t(e,n++)}();const a=t;return function*(){yield s;for(const e of r)yield a(e,n++)}()}const al=(0,oe.s)("/ipns/");function ul(e){return Z(e.subarray(0,al.byteLength),al)}class ll{client;constructor(e){this.client=e}async*findProviders(e,t={}){yield*sl(this.client.getProviders(e,t),(e=>({id:e.ID,multiaddrs:e.Addrs??[]})))}async provide(){}async put(e,t,n){if(!ul(e))return;const r=Ju(e),o=K.T.createV1(114,r),i=Zu(t);await this.client.putIPNS(o,i,n)}async get(e,t){if(!ul(e))throw new nt("Not found");const n=Ju(e),r=K.T.createV1(114,n);try{return Ku(await this.client.getIPNS(r,t))}catch(o){if("BadResponseError"===o.name)throw new nt("Not found");throw o}}}class cl{client;constructor(e){this.client=e}async findPeer(e,t={}){const n=await il(this.client.getPeers(e,t));if(null!=n)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new nt("Not found")}async*getClosestPeers(e,t={}){}}const fl=Qt("delegated-routing-v1-http-api-client"),hl=4,dl=3e4;class pl{started;httpQueue;shutDownController;clientUrl;timeout;contentRouting;peerRouting;filterAddrs;filterProtocols;constructor(e,t={}){this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new fn({concurrency:t.concurrentRequests??hl}),this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??dl,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new ll(this),this.peerRouting=new cl(this)}get[Nr](){return this.contentRouting}get[Pr](){return this.peerRouting}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.shutDownController.abort(),this.started=!1}async*getProviders(e,t={}){fl("getProviders starts: %c",e);const n=AbortSignal.timeout(this.timeout),r=br([this.shutDownController.signal,n,t.signal]),o=Ve(),i=Ve();this.httpQueue.add((async()=>(o.resolve(),i.promise)));try{await o.promise;const n=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);this.#U(n,t.filterAddrs,t.filterProtocols);const i={headers:{Accept:"application/x-ndjson"},signal:r},s=await fetch(n,i);if(404===s.status)throw new nt("No matching records found");if(422===s.status)throw new rl("Request does not conform to schema or semantic constraints");if(null==s.body)throw new ol("Routing response had no body");if("application/json"===s.headers.get("Content-Type")){const e=await s.json();for(const t of e.Providers){const e=this.#M(t);null!=e&&(yield e)}}else for await(const e of nl(Pu(s.body))){const t=this.#M(e);null!=t&&(yield t)}}catch(s){fl.error("getProviders errored:",s)}finally{r.clear(),i.resolve(),fl("getProviders finished: %c",e)}}async*getPeers(e,t={}){fl("getPeers starts: %c",e);const n=AbortSignal.timeout(this.timeout),r=br([this.shutDownController.signal,n,t.signal]),o=Ve(),i=Ve();this.httpQueue.add((async()=>(o.resolve(),i.promise)));try{await o.promise;const n=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);this.#U(n,t.filterAddrs,t.filterProtocols);const i={headers:{Accept:"application/x-ndjson"},signal:r},s=await fetch(n,i);if(404===s.status)throw new nt("No matching records found");if(422===s.status)throw new rl("Request does not conform to schema or semantic constraints");if(null==s.body)throw new ol("Routing response had no body");if("application/json"===s.headers.get("Content-Type")){const e=await s.json();for(const t of e.Peers){const e=this.#M(t);null!=e&&(yield e)}}else for await(const e of nl(Pu(s.body))){const t=this.#M(e);null!=t&&(yield t)}}catch(s){fl.error("getPeers errored:",s)}finally{r.clear(),i.resolve(),fl("getPeers finished: %c",e)}}async getIPNS(e,t={}){fl("getIPNS starts: %s",e);const n=AbortSignal.timeout(this.timeout),r=br([this.shutDownController.signal,n,t.signal]),o=Ve(),i=Ve();this.httpQueue.add((async()=>(o.resolve(),i.promise)));const s=`${this.clientUrl}routing/v1/ipns/${e}`;try{await o.promise;const n={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:r},i=await fetch(s,n);if(fl("getIPNS GET %s %d",s,i.status),404===i.status)throw new nt("No matching records found");if(422===i.status)throw new rl("Request does not conform to schema or semantic constraints");if(null==i.body)throw new ol("GET ipns response had no body");const a=await i.arrayBuffer(),u=new Uint8Array(a,0,a.byteLength);return!1!==t.validate&&await async function(e,t){if(t.byteLength>10240)throw new ju("The record is too large");const n=Ju(e);let r;Qu(n,0)&&(r=Eu(n));const o=qu(Zu(t))??r;if(null==o)throw new zu("Could not extract public key from IPNS record or routing key");if(!Z(e,Yu(o.toMultihash())))throw new zu("Embedded public key did not match routing key");await tl(o,t)}(Yu(e.multihash),u),Zu(u)}catch(a){throw fl.error("getIPNS GET %s error:",s,a),a}finally{r.clear(),i.resolve(),fl("getIPNS finished: %s",e)}}async putIPNS(e,t,n={}){fl("putIPNS starts: %c",e);const r=AbortSignal.timeout(this.timeout),o=br([this.shutDownController.signal,r,n.signal]),i=Ve(),s=Ve();this.httpQueue.add((async()=>(i.resolve(),s.promise)));const a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await i.promise;const e={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:Ku(t),signal:o},n=await fetch(a,e);if(fl("putIPNS PUT %s %d",a,n.status),200!==n.status)throw new ol("PUT ipns response had status other than 200")}catch(u){throw fl.error("putIPNS PUT %s error:",a,u.stack),u}finally{o.clear(),s.resolve(),fl("putIPNS finished: %c",e)}}#M(e){try{const t=[],n=e.Addrs?.map(Fe)??[];return null!=e.Protocols&&t.push(...e.Protocols),null!=e.Protocol&&(t.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:Bu(e.ID),Addrs:n,Protocols:t}}catch(t){fl.error("could not conform record to peer schema",t)}}#U(e,t,n){if(null!=t||null!=this.filterAddrs){const n=t?.join(",")??this.filterAddrs?.join(",")??"";""!==n&&e.searchParams.set("filter-addrs",n)}if(null!=n||null!=this.filterProtocols){const t=n?.join(",")??this.filterProtocols?.join(",")??"";""!==t&&e.searchParams.set("filter-protocols",t)}}}const gl=(0,oe.s)("/ipns/");function yl(e){return Z(e.subarray(0,gl.byteLength),gl)}class ml{client;constructor(e){this.client=function(e,t={}){return new pl(new URL(e),t)}(e)}async provide(e,t){}async*findProviders(e,t){yield*sl(this.client.getProviders(e,t),(e=>({id:e.ID,multiaddrs:e.Addrs,protocols:e.Protocols})))}async put(e,t,n){if(!yl(e))return;const r=Ju(e),o=K.T.createV1(114,r),i=Zu(t);await this.client.putIPNS(o,i,n)}async get(e,t){if(!yl(e))throw new nt("Not found");const n=Ju(e),r=K.T.createV1(114,n);try{return Ku(await this.client.getIPNS(r,t))}catch(o){if("BadResponseError"===o.name)throw new nt("Not found");throw o}}async findPeer(e,t){const n=await il(this.client.getPeers(e,t));if(null!=n)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new nt("Not found")}async*getClosestPeers(e,t){}}function bl(e){return new ml(new URL(e))}const vl="[a-fA-F\\d:]",wl=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${vl})|(?<=${vl})(?=\\s|$))`:"",El="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Al="[a-fA-F\\d]{1,4}",Cl=`\n(?:\n(?:${Al}:){7}(?:${Al}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${Al}:){6}(?:${El}|:${Al}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${Al}:){5}(?::${El}|(?::${Al}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${Al}:){4}(?:(?::${Al}){0,1}:${El}|(?::${Al}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${Al}:){3}(?:(?::${Al}){0,2}:${El}|(?::${Al}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${Al}:){2}(?:(?::${Al}){0,3}:${El}|(?::${Al}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${Al}:){1}(?:(?::${Al}){0,4}:${El}|(?::${Al}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${Al}){0,5}:${El}|(?::${Al}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Sl=new RegExp(`(?:^${El}$)|(?:^${Cl}$)`),Tl=new RegExp(`^${El}$`),kl=new RegExp(`^${Cl}$`),xl=e=>e&&e.exact?Sl:new RegExp(`(?:${wl(e)}${El}${wl(e)})|(?:${wl(e)}${Cl}${wl(e)})`,"g");xl.v4=e=>e&&e.exact?Tl:new RegExp(`${wl(e)}${El}${wl(e)}`,"g"),xl.v6=e=>e&&e.exact?kl:new RegExp(`${wl(e)}${Cl}${wl(e)}`,"g");const{toString:Il}=Object.prototype;const Ol={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function Bl(e,t={}){if(n=e,"[object RegExp]"!==Il.call(n))throw new TypeError("Expected a RegExp instance");var n;const r=Object.keys(Ol).map((n=>("boolean"===typeof t[n]?t[n]:e[n])?Ol[n]:"")).join(""),o=new RegExp(t.source||e.source,r);return o.lastIndex="number"===typeof t.lastIndex?t.lastIndex:e.lastIndex,o}function Dl(e,t,{timeout:n}={}){try{return function(e){const t=(...t)=>e(...t);return Object.defineProperty(t,"name",{value:`functionTimeout(${e.name||"<anonymous>"})`,configurable:!0}),t}((()=>Bl(e).test(t)))()}catch(r){throw r}}const Nl={timeout:400};function Pl(e){return!(e.length>45)&&Dl(xl.v6({exact:!0}),e,Nl)}const Fl={http:"80",https:"443",ws:"80",wss:"443"},_l=["http","https","ws","wss"];function Ll(e,t){const n=(t=t??{}).defaultDnsType??"dns4",{scheme:r,hostname:o,port:i}=function(e){const[t]=e.split(":");_l.includes(t)||(e="http"+e.substring(t.length));let{protocol:n,hostname:r,port:o}=new URL(e);if(null==o||""===o){const e=function(e){if(null==e||""===e||null==Fl[e])return;return Fl[e]}(t);null!=e&&(o=e),null==e&&"http:"===n&&(o="80")}return{scheme:t,hostname:r,port:o}}(e);return Fe("/"+[Rl(o,n),Ul(i,r),Ml(r)].filter((e=>Boolean(e))).reduce(((e,t)=>e.concat(t)),[]).join("/"))}function Rl(e,t){if(null!=e&&""!==e){if(function(e){return!(e.length>15)&&Dl(xl.v4({exact:!0}),e,Nl)}(e))return["ip4",e];if(Pl(e))return["ip6",e];if("["===e[0]){const t=e.substring(1,e.length-1);if(Pl(t))return["ip6",t]}return[t,e]}}function Ul(e,t){if(null!=e&&""!==e)return"udp"===t?["udp",e]:["tcp",e]}function Ml(e){if(null==e.match(/^tcp$|^udp$/))return[e]}const jl=["https://trustless-gateway.link","https://4everland.io"];class $l{gateways;constructor(e={}){this.gateways=(e.gateways??jl).map((e=>function(e){return e=e.toString(),{id:Nu(K.T.createV1(2336,yr.D.digest((0,oe.s)(e)))),multiaddrs:[Ll(e)]}}(e)))}async*findProviders(e,t){yield*this.gateways.toSorted((()=>Math.random()>.5?1:-1)).map((e=>({...e,protocols:["transport-ipfs-gateway-http"]})))}}function Hl(e={}){return new $l(e)}var zl=n(9879),Vl=n(139);const Gl="explore.ipld.gatewayEnabled";async function Wl(e){const t=[],n=`${e.protocol??"http"}://${e.host}:${e.port}`;try{const e=new URL(n);t.push(Hl({gateways:[e.href]}))}catch(o){console.error("Invalid kuboGateway url string: %s",n,o)}(function(){const e=localStorage.getItem(Gl);return null==e||JSON.parse(e)})()&&(console.log("remote gateways and delegated routing are enabled"),t.push(bl("https://delegated-ipfs.dev")),t.push(Hl()));const r=await async function(e={}){const t=e.datastore??new jr,n=e.blockstore??new _r,r=new Fr({...e,datastore:t,blockstore:n,blockBrokers:e.blockBrokers??[$t()],routers:e.routers??[bl("https://delegated-ipfs.dev"),Hl()]});return!1!==e.start&&await r.start(),r}({blockBrokers:[$t(e.trustlessBlockBrokerConfig?.init)],routers:t,hashers:await(0,Vl.X)(17,18,19,20,27,30,45600,45632)});return await Promise.allSettled([(0,zl.yu)(r,"dag-json",{hello:"world"}),(0,zl.yu)(r,"dag-cbor",{hello:"world"},27),(0,zl.yu)(r,"json",{hello:"world"},20),(0,zl.yu)(r,"json",{hello:"world"},30),(0,zl.yu)(r,"raw",(new TextEncoder).encode("hello"),30),(0,zl.yu)(r,"dag-pb",{Data:(new TextEncoder).encode("hello"),Links:[]},45600),(0,zl.yu)(r,"dag-pb",{Data:(new TextEncoder).encode("hello"),Links:[]},45632)]),r}console.info(`\ud83c\udf9b\ufe0f Customise whether ipld-explorer-components fetches content from gateways by setting an '${Gl}' value to true/false in localStorage. e.g. localStorage.setItem('${Gl}', false) -- NOTE: defaults to true`);const ql={host:"127.0.0.1",port:"8080",protocol:"http",trustlessBlockBrokerConfig:{init:{allowLocal:!0}}},Kl=(0,i.createContext)(void 0),Zl=({children:e})=>{const[t,n]=(0,i.useState)(null),[r,a]=(0,i.useState)((()=>{const e=localStorage.getItem("kuboGateway");if(null!=e)try{const t=JSON.parse(e);return{...ql,...t}}catch(t){console.error("getDefaultKuboGatewayOptions error",t)}return ql})()),[u,l]=(0,i.useState)(null),c=(0,i.useCallback)((async()=>{try{const e=await Wl(r);l(null),n(e)}catch(e){console.error("doInitHelia error",e),l(e),n(null)}}),[r,n]);return o.j.jsx(Kl.Provider,{value:{helia:t,error:u,kuboGatewayOptions:r,selectHeliaReady:()=>null!==t,selectHeliaIdentity:()=>`@helia/http@${s["@helia/http"]}`,doInitHelia:c,setKuboGatewayOptions:e=>{a((t=>({...t,...e})))}},children:e})},Yl=()=>{const e=(0,i.useContext)(Kl);if(void 0===e)throw new Error("useHelia must be used within a HeliaProvider");return e}},5447:(e,t,n)=>{"use strict";n.d(t,{Fc:()=>o.F,Nh:()=>r.Nh,l4:()=>r.l4,pP:()=>o.p});var r=n(3216),o=n(1247)},8330:e=>{"use strict";e.exports=JSON.parse('{"rE":"4.4.1","El":{"@loadable/component":"^5.14.1","@multiformats/multiaddr":"^12.1.14","@multiformats/multiaddr-to-uri":"^9.0.7","@tableflip/react-dropdown":"^1.3.0","brace":"^0.11.1","change-case":"^3.1.0","chart.js":"^2.9.4","classnames":"^2.3.1","countly-sdk-web":"^19.8.0","d3":"^5.16.0","datatransfer-files-promise":"^1.3.1","details-polyfill":"^1.1.0","file-extension":"^4.0.5","filesize":"^6.3.0","hashlru":"^2.3.0","i18next":"^23.15.2","i18next-browser-languagedetector":"^8.0.0","i18next-chained-backend":"^3.0.2","i18next-http-backend":"^2.6.2","i18next-icu":"^2.3.0","i18next-localstorage-backend":"^3.1.3","internal-nav-helper":"^3.1.0","intl-messageformat":"^10.3.3","ip":"^1.1.9","ipfs-css":"^1.4.0","ipfs-geoip":"^9.1.0","ipfs-provider":"^2.1.0","ipld-explorer-components":"^8.1.3","is-ipfs":"^8.0.1","istextorbinary":"^6.0.0","it-all":"^1.0.5","it-first":"^1.0.6","it-last":"^1.0.5","it-map":"^1.0.5","kubo-rpc-client":"^4.1.1","milliseconds":"^1.0.3","money-clip":"^3.0.5","multiformats":"^13.0.1","p-memoize":"^4.0.0","p-queue":"^7.3.0","prop-types":"^15.7.2","react":"^16.14.0","react-ace":"^8.1.0","react-chartjs-2":"^2.10.0","react-copy-to-clipboard":"^5.0.2","react-country-flag":"^1.1.0","react-debounce-render":"^5.0.0","react-dnd":"^11.1.3","react-dnd-html5-backend":"^11.1.3","react-dom":"^16.14.0","react-faux-dom":"^4.5.0","react-helmet":"^5.2.1","react-hook-form":"^6.0.6","react-i18next":"^15.0.2","react-identicons":"^1.2.4","react-joyride":"^2.3.0","react-overlays":"^2.1.1","react-scripts":"5.0.1","react-virtualized":"^9.22.3","redux-bundler":"^26.1.0","redux-bundler-react":"^1.2.0","tachyons":"^4.12.0","topojson-client":"^3.1.0","window-or-global":"^1.0.1"}}')},6112:e=>{"use strict";e.exports=JSON.parse('{"ar":{"locale":"ar","nativeName":"\u0627\u0644\u0639\u0631\u0628\u064a\u0629","englishName":"Arabic"},"ca":{"locale":"ca","nativeName":"Catal\xe0","englishName":"Catalan"},"cs":{"locale":"cs","nativeName":"\u010ce\u0161tina","englishName":"Czech"},"da":{"locale":"da","nativeName":"Dansk","englishName":"Danish"},"de":{"locale":"de","nativeName":"Deutsch","englishName":"German"},"en":{"locale":"en","nativeName":"English","englishName":"English"},"es":{"locale":"es","nativeName":"Espa\xf1ol","englishName":"Spanish"},"fi":{"locale":"fi","nativeName":"Suomi","englishName":"Finnish"},"fr":{"locale":"fr","nativeName":"Fran\xe7ais","englishName":"French"},"hi-IN":{"locale":"hi-IN","nativeName":"\u0939\u093f\u0928\u094d\u0926\u0940","englishName":"Hindi"},"hu":{"locale":"hu","nativeName":"Magyar","englishName":"Hungarian"},"id":{"locale":"id","nativeName":"Bahasa Indonesia","englishName":"Indonesian"},"it":{"locale":"it","nativeName":"Italiano","englishName":"Italian"},"ja-JP":{"locale":"ja-JP","nativeName":"\u65e5\u672c\u8a9e","englishName":"Japanese"},"ko-KR":{"locale":"ko-KR","nativeName":"\ud55c\uad6d\uc5b4 (\u97e9\u56fd)","englishName":"Korean (Korea)"},"lt":{"locale":"lt","nativeName":"Lietuvi\u0173","englishName":"Lithuanian"},"nl":{"locale":"nl","nativeName":"Nederlands","englishName":"Dutch"},"no":{"locale":"no","nativeName":"Norsk","englishName":"Norwegian"},"pl":{"locale":"pl","nativeName":"Polski","englishName":"Polish"},"pt":{"locale":"pt","nativeName":"Portugu\xeas","englishName":"Portuguese"},"pt-BR":{"locale":"pt-BR","nativeName":"Portugu\xeas (Brasil)","englishName":"Portuguese (Brazil)"},"ro":{"locale":"ro","nativeName":"Rom\xe2n\u0103","englishName":"Romanian"},"ru":{"locale":"ru","nativeName":"\u0420\u0443\u0441\u0441\u043a\u0438\u0439","englishName":"Russian"},"sk":{"locale":"sk","nativeName":"Sloven\u010dina","englishName":"Slovak"},"sv":{"locale":"sv","nativeName":"Svenska","englishName":"Swedish"},"tr":{"locale":"tr","nativeName":"T\xfcrk\xe7e","englishName":"Turkish"},"uk":{"locale":"uk","nativeName":"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430","englishName":"Ukrainian"},"ur":{"locale":"ur","nativeName":"\u0627\u0631\u062f\u0648","englishName":"Urdu"},"zh-CN":{"locale":"zh-CN","nativeName":"\u4e2d\u6587\uff08\u4e2d\u56fd\uff09","englishName":"Chinese Simplified (China)"},"zh-HK":{"locale":"zh-HK","nativeName":"\u4e2d\u6587\uff08\u9999\u6e2f\uff09","englishName":"Chinese Traditional (Hong Kong)"},"zh-TW":{"locale":"zh-TW","nativeName":"\u4e2d\u6587\uff08\u53f0\u7063\uff09","englishName":"Chinese Traditional (Taiwan)"}}')}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,n.amdD=function(){throw new Error("define cannot be used indirect")},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o)return r;if("object"===typeof r&&r){if(4&o&&r.__esModule)return r;if(16&o&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&o&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>r[e]));return s.default=()=>r,n.d(i,s),i}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+"."+{124:"a6d5f8d1",139:"9b75e0ba",163:"125fd398",325:"3cbe1b85",380:"1ff1c64a",435:"0caf6bdf",479:"f58ebab7",504:"e6fae354",584:"3a83f231",603:"179dd843",658:"0ee224d1",672:"647e313f",853:"ef776716",868:"b1fdb004",904:"81cd9fe2",959:"b685249a",984:"50eceb2d",994:"8f82d200",996:"3da9b362"}[e]+".chunk.js",n.miniCssF=e=>"static/css/"+e+"."+{380:"e4a3e1e6",658:"823dc8df",853:"b512ec81",904:"743c6962"}[e]+".chunk.css",n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="ipfs-webui:";n.l=(r,o,i,s)=>{if(e[r])e[r].push(o);else{var a,u;if(void 0!==i)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var f=l[c];if(f.getAttribute("src")==r||f.getAttribute("data-webpack")==t+i){a=f;break}}a||(u=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+i),a.src=r),e[r]=[o];var h=(t,n)=>{a.onerror=a.onload=null,clearTimeout(d);var o=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((e=>e(n))),t)return t(n)},d=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),u&&document.head.appendChild(a)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="./",(()=>{if("undefined"!==typeof document){var e=e=>new Promise(((t,r)=>{var o=n.miniCssF(e),i=n.p+o;if(((e,t)=>{for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var o=(s=n[r]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(o===e||o===t))return s}var i=document.getElementsByTagName("style");for(r=0;r<i.length;r++){var s;if((o=(s=i[r]).getAttribute("data-href"))===e||o===t)return s}})(o,i))return t();((e,t,r,o,i)=>{var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",n.nc&&(s.nonce=n.nc),s.onerror=s.onload=n=>{if(s.onerror=s.onload=null,"load"===n.type)o();else{var r=n&&n.type,a=n&&n.target&&n.target.href||t,u=new Error("Loading CSS chunk "+e+" failed.\n("+r+": "+a+")");u.name="ChunkLoadError",u.code="CSS_CHUNK_LOAD_FAILED",u.type=r,u.request=a,s.parentNode&&s.parentNode.removeChild(s),i(u)}},s.href=t,r?r.parentNode.insertBefore(s,r.nextSibling):document.head.appendChild(s)})(e,i,null,t,r)})),t={792:0};n.f.miniCss=(n,r)=>{t[n]?r.push(t[n]):0!==t[n]&&{380:1,658:1,853:1,904:1}[n]&&r.push(t[n]=e(n).then((()=>{t[n]=0}),(e=>{throw delete t[n],e})))}}})(),(()=>{var e={792:0};n.f.j=(t,r)=>{var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)r.push(o[2]);else{var i=new Promise(((n,r)=>o=e[t]=[n,r]));r.push(o[2]=i);var s=n.p+n.u(t),a=new Error;n.l(s,(r=>{if(n.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var i=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",a.name="ChunkLoadError",a.type=i,a.request=s,o[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var o,i,s=r[0],a=r[1],u=r[2],l=0;if(s.some((t=>0!==e[t]))){for(o in a)n.o(a,o)&&(n.m[o]=a[o]);if(u)u(n)}for(t&&t(r);l<s.length;l++)i=s[l],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkipfs_webui=self.webpackChunkipfs_webui||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e=n(5043),t=n(7950),r=n(3026),o=function(e){return e?"A"===e.tagName?e:o(e.parentElement):null},i=function(e){return function(t){if(0===t.button&&!t.ctrlKey&&!t.shiftKey&&!t.altKey&&!t.metaKey){var n=o(t.target);if(n&&"_blank"!==n.target&&"_external"!==n.target&&"external"!==n.rel&&!n.hasAttribute("download")){var r=-1!==(i=n).href.indexOf(location.protocol+"//"+location.host)?i.href.split(location.host,2)[1]:null;r&&(t.preventDefault(),e(r))}}var i}},s=n(9412),a=n(6470),u=n(1684),l=n(465),c=n(5493),f=n(6064),h=n(5156),d=n(4600),p=n.n(d);const g=n.p+"static/media/ipfs-logo-text-vert.6fc9edd5f753fba1c9f20b667e26d29d.svg";const y=n.p+"static/media/ipfs-logo-text-horiz.2c5486c412b66a8fad882021ae564641.svg";function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(null,arguments)}const b=function(t){return e.createElement("svg",m({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},t),e.createElement("path",{d:"M76.595 19.785h-52.93a3.93 3.93 0 00-3.92 3.92v39.12a5.74 5.74 0 005.73 5.73h23.79v6.25h-9.67a4 4 0 00-4 4 3.59 3.59 0 00.08.81l.12.6h28.49l.13-.6a4.28 4.28 0 00.08-.81 4 4 0 00-4-4h-9.73v-6.25h25.83a3.67 3.67 0 003.66-3.67v-41.44a3.67 3.67 0 00-3.66-3.66zm-13.61 58.94h-25.95a2.52 2.52 0 012.56-2.42h20.88a2.51 2.51 0 012.51 2.42zm-39.32-55.94h52.93a.66.66 0 01.66.66v5.56h-54.51v-5.3a.92.92 0 01.92-.92zm52.93 42.77h-51.12a2.73 2.73 0 01-2.73-2.73v-32.29h54.53v34.35a.67.67 0 01-.68.67z"}),e.createElement("path",{d:"M68.315 35.735a3.61 3.61 0 00-3.61 3.61 3.58 3.58 0 00.74 2.17l-9.77 10.38a3.5 3.5 0 00-4.13.46l-7.4-5a3.61 3.61 0 10-6.9-1.48 3.58 3.58 0 00.41 1.63l-.06-.05-4.54 5.55a3.57 3.57 0 00-1.35-.27 3.62 3.62 0 102.6 1.11l4.29-5.21a3.53 3.53 0 002.3.86 3.62 3.62 0 002.39-.92l7.41 5a3.52 3.52 0 00-.37 1.43 3.635 3.635 0 107.27 0 3.57 3.57 0 00-.74-2.16l9.74-10.35a3.49 3.49 0 001.73.46 3.61 3.61 0 000-7.22zm-36.61 22.72a2.11 2.11 0 112.11-2.11 2.12 2.12 0 01-2.11 2.11zm9.15-10.45a2.11 2.11 0 112.11-2.11 2.12 2.12 0 01-2.11 2.11zm13.08 9.15a2.11 2.11 0 112.11-2.15 2.11 2.11 0 01-2.11 2.14zm14.38-15.7a2.11 2.11 0 112.11-2.11 2.11 2.11 0 01-2.11 2.11z"}))};function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(null,arguments)}const w=function(t){return e.createElement("svg",v({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},t),e.createElement("path",{d:"M36 33.4h14.21a1 1 0 000-2H36a1 1 0 000 2zm0 8.84h14.21a1 1 0 000-2H36a1 1 0 000 2zm30.08 7.57a1.07 1.07 0 00-.07-.19.64.64 0 010-.07l-.08-.08-.14-.15-.15-.1-.18-.08h-.2a.35.35 0 00-.11 0H36a1 1 0 00-1 1v17.68a.71.71 0 000 .2.64.64 0 00.06.18.36.36 0 010 .07.65.65 0 00.13.16 1.26 1.26 0 00.28.19h.08a1 1 0 00.34.07h29.24a1 1 0 001-1V50a1.62 1.62 0 00-.05-.19zm-4.52 1.26L37 66V51.07zm-22 15.68l24.52-14.9v14.9z"}),e.createElement("path",{d:"M75.13 37.17v-.05L56.55 17.8H30a5.51 5.51 0 00-5.5 5.5v53.4a5.51 5.51 0 005.5 5.5h40a5.51 5.51 0 005.5-5.5V37.51zM56.91 22.51l14 14.61h-7.08c-4 0-6.92-2.53-6.92-6zM70 79.2H30a2.5 2.5 0 01-2.5-2.5V23.3a2.5 2.5 0 012.5-2.5h24.91v10.31c0 4.64 3.75 8 8.92 8h8.63V76.7A2.5 2.5 0 0170 79.2z"}))};var E=n(4409);function A(){return A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},A.apply(null,arguments)}const C=function(t){return e.createElement("svg",A({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},t),e.createElement("path",{d:"M50.077 42.884h-.09a7.14 7.14 0 00-5 2.06 7.07 7.07 0 00-2.11 5 7.16 7.16 0 007.11 7.21 7.14 7.14 0 00.09-14.27zm-.09 11.67a4.57 4.57 0 01-4.54-4.54 4.46 4.46 0 011.34-3.19 4.54 4.54 0 013.2-1.34 4.53 4.53 0 014.48 4.67 4.54 4.54 0 01-4.48 4.4z"}),e.createElement("path",{d:"M83.697 56.764c-3.29-1.27-4.93-3.4-5-6.51-.07-3.29 1.56-5.53 5-6.86a1.3 1.3 0 00.82-1.38c-.25-2.51-3-9-4.45-10.72a1.3 1.3 0 00-1.53-.28c-3.25 1.52-6 1.15-8.27-1.14-2.27-2.29-2.71-5-1.17-8.39a1.29 1.29 0 00-.5-1.65 34.72 34.72 0 00-10.42-4.29 1.29 1.29 0 00-1.52.84c-1.11 3.22-3.1 4.9-6.1 5.12-3.57.27-6-1.41-7.36-5.11a1.31 1.31 0 00-1.53-.82 35.49 35.49 0 00-10.38 4.37 1.3 1.3 0 00-.48 1.66c1.56 3.28 1.21 6-1.07 8.32-2.28 2.32-5.05 2.74-8.38 1.21a1.31 1.31 0 00-1.66.5 35.31 35.31 0 00-4.23 10.38 1.31 1.31 0 00.82 1.51c3.34 1.23 5 3.35 5.07 6.51.07 3.16-1.55 5.53-5 6.86a1.3 1.3 0 00-.79 1.52 34.69 34.69 0 004.42 10.34 1.29 1.29 0 001.63.5c3.23-1.44 5.9-1.06 8.16 1.14s2.75 5 1.32 8.23a1.3 1.3 0 00.52 1.63 35.46 35.46 0 0010.37 4.23 1.15 1.15 0 00.26 0 1.44 1.44 0 001.23-.79 2.43 2.43 0 00.14-.28 6.89 6.89 0 0113-.17 1.7 1.7 0 002.16 1.06 35.78 35.78 0 009.44-3.9l.36-.24.11-.08a1.29 1.29 0 00.47-1.61c-1.32-3-1.06-5.51.8-7.68 2.29-2.66 5.12-3.22 8.67-1.71a1.29 1.29 0 001.61-.51 34.87 34.87 0 004.3-10.33 1.29 1.29 0 00-.84-1.48zm-5.16 9.55a9.16 9.16 0 00-10.55 2.82 9.05 9.05 0 00-1.62 9.36 33 33 0 01-7.63 3.16 9.36 9.36 0 00-8.75-5.5h-.14a9.5 9.5 0 00-8.38 5.54 32.24 32.24 0 01-7.63-3.12 9.06 9.06 0 00-2.32-10 9.11 9.11 0 00-10-2.08 32.48 32.48 0 01-3.2-7.57 9.1 9.1 0 005.67-8.91 9.08 9.08 0 00-5.69-8.44 32.5 32.5 0 013.09-7.62 9.08 9.08 0 0010.23-2.2 9 9 0 002-10.17 32.73 32.73 0 017.6-3.18 9.12 9.12 0 009.53 5.71 9 9 0 007.93-5.75 32.76 32.76 0 017.61 3.14 9.09 9.09 0 002.15 10.24 9.08 9.08 0 0010.19 2.07 37.24 37.24 0 013.13 7.6 9.49 9.49 0 00-.06 17.33 32.18 32.18 0 01-3.16 7.57z"}),e.createElement("path",{d:"M49.987 32.934a17.09 17.09 0 1017.08 17.08 17.1 17.1 0 00-17.08-17.08zm0 32.67a15.59 15.59 0 1115.58-15.59 15.61 15.61 0 01-15.58 15.59z"}))};var S=n(9597);const T=t=>{let{to:n,icon:r,alternative:o,disabled:i,children:s}=t;const a=r,{hash:u}=window.location,l=`#${n}`,c=o?u===l||u.startsWith(`${l}${o}`):u&&u.startsWith(l),f=p()({"bg-white-10 navbar-item-active":c,"o-50 no-pointer-events":i},["navbar-item dib db-l pt2 pb3 pv1-l white no-underline f5 hover-bg-white-10 tc bb bw2 bw0-l b--navy"]),h=p()({"o-100":c,"o-50":!c},["fill-current-color"]);return e.createElement("a",{href:i?null:l,className:f,role:"menuitem",title:s},e.createElement("div",{className:"db ph2 pv1"},e.createElement("div",{className:"db"},e.createElement(a,{width:"46",role:"presentation",className:h})),e.createElement("div",{className:(c?"o-100":"o-50")+" db f6 tc montserrat ttu fw1 ",style:{whiteSpace:"pre-wrap"}},s)))},k=(0,r.N)((0,a.CI)()((t=>{let{t:n}=t;const r="https://github.com/ipfs/ipfs-webui",o=`${r}/issues`,i="6785409",s=`${r}/commit/${i}`;return e.createElement("div",{className:"h-100 fixed-l flex flex-column justify-between",style:{overflowY:"auto",width:"inherit"}},e.createElement("div",{className:"flex flex-column"},e.createElement("a",{href:"#/welcome",role:"menuitem",title:n("welcome:description")},e.createElement("div",{className:"pt3 pb1 pb2-l"},e.createElement("img",{className:"navbar-logo-vert center db-l dn pt3 pb1",style:{height:94},src:g,alt:""}),e.createElement("img",{className:"navbar-logo-horiz center db dn-l",style:{height:70},src:y,alt:""}))),e.createElement("div",{className:"db overflow-x-scroll overflow-x-hidden-l nowrap tc",role:"menubar"},e.createElement(T,{to:"/",alternative:"status",icon:b},n("status:title")),e.createElement(T,{to:"/files",icon:w},n("files:title")),e.createElement(T,{to:"/explore",icon:S.A},n("explore:tabName")),e.createElement(T,{to:"/peers",icon:E.A},n("peers:title")),e.createElement(T,{to:"/settings",icon:C},n("settings:title")))),e.createElement("div",{className:"dn db-l navbar-footer mb2 tc center f7 o-80 glow"},i&&e.createElement("div",{className:"mb1"},e.createElement("a",{className:"link white",href:s,target:"_blank",rel:"noopener noreferrer"},n("app:terms.revision")," ",i)),e.createElement("div",{className:"mb1"},e.createElement("a",{className:"link white",href:r,target:"_blank",rel:"noopener noreferrer"},n("app:nav.codeLink"))),e.createElement("div",null,e.createElement("a",{className:"link white",href:o,target:"_blank",rel:"noopener noreferrer"},n("app:nav.bugsLink")))))})));var x=n(6506),I=n(6943);const O=t=>{let{error:n,children:r,onDismiss:o}=t;const i=n?"bg-yellow":"bg-green";return e.createElement("div",{className:"fixed bottom-0 tc pb2 z-max",style:{left:"50% ",transform:"translateX(-50%)"}},e.createElement("div",{className:`flex items-center f5 lh-copy avenir pl2 pl4-ns pv2 white br2 ${i}`},r,e.createElement(I.A,{className:"fill-current-color ph3 glow o-80 pointer",style:{height:"28px",transform:"scale(1.5)"},onClick:o})))},B=(0,r.N)("selectNotify","selectNotifyI18nKey","doNotifyDismiss",(0,a.CI)("notify")((t=>{let{t:n,notify:r,notifyI18nKey:o,doNotifyDismiss:i}=t;const{show:s,error:a,msgArgs:u}=r;return s?e.createElement(O,{error:a,onDismiss:i},n(o,u)):null}))),D=(0,r.N)("selectIpfsReady","selectIpfsConnected","doSetIsNodeInfoOpen",(0,a.CI)("notify")((t=>{let{t:n,className:r,size:o=28,ipfsReady:i,ipfsConnected:s,doSetIsNodeInfoOpen:a}=t;const u=n(((e,t)=>e&&t?"app:status.connectedToIpfs":e?"ipfsApiRequestFailed":"app:status.connectingToIpfs")(i,s)),l=((e,t)=>e&&t?"teal":e?"red":"gray")(i,s),c=s?"o-60":"o-100";return e.createElement("a",{title:u,className:`dib ${r}`,href:"#/status",onClick:()=>a(!0)},e.createElement("svg",{className:`${l} ${c} fill-current-color transition-all glow`,viewBox:"0 0 24 24",width:o,height:o,"aria-hidden":"true"},e.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM6.5 9L10 5.5 13.5 9H11v4H9V9H6.5zm11 6L14 18.5 10.5 15H13v-4h2v4h2.5z "})))}))),N=(0,r.N)("doEnableTours",(0,a.CI)("app")((t=>{let{doEnableTours:n,className:r="",size:o=23,t:i}=t;return e.createElement("button",{className:`dib mr1 ml4-m pointer ${r}`,onClick:()=>{n()},"aria-label":i("startTourHelper")},e.createElement("svg",{className:"fill-teal o-60 glow",viewBox:"0 0 44 44",width:o,height:o,"aria-hidden":"true"},e.createElement("path",{d:"m22,0c-12.2,0-22,9.8-22,22s9.8,22 22,22 22-9.8 22-22-9.8-22-22-22zm2,34c0,0.6-0.4,1-1,1h-2c-0.6,0-1-0.4-1-1v-2c0-0.6 0.4-1 1-1h2c0.6,0 1,0.4 1,1v2zm2.7-8.9c-1.4,1.2-2.4,2-2.7,3.1-0.1,0.5-0.5,0.8-1,0.8h-2c-0.6,0-1.1-0.5-1-1.1 0.4-2.9 2.5-4.5 4.2-5.9 1.8-1.4 2.8-2.3 2.8-4 0-2.8-2.2-5-5-5s-5,2.2-5,5c0,0.2 0,0.4 0,0.6 0.1,0.5-0.2,1-0.7,1.1l-1.9,.6c-0.6,0.2-1.2-0.2-1.3-0.8-0.1-0.5-0.1-1-0.1-1.5 0-5 4-9 9-9s9,4 9,9c0,3.7-2.4,5.6-4.3,7.1z"})))})));var P=n(1969),F=n(2004),_=n(446),L=n(5447),R=n(579);const U=t=>{let{onBrowse:n}=t;const[r,o]=(0,e.useState)(""),{doExploreUserProvidedPath:i}=(0,L.Nh)(),{t:s}=(0,a.Bd)("files"),u=(0,e.useMemo)((()=>r.trim()),[r]),l=(0,e.useMemo)((()=>""!==u&&(P.J3(u)||P.Ae(u))),[u]),c=(0,e.useMemo)((()=>""===u?"focus-outline":l?"b--green-muted focus-outline-green":"b--red-muted focus-outline-red"),[u,l]),f=(0,e.useCallback)((e=>{e.preventDefault(),l&&(i(u),o(""))}),[i,l,u]),h=(0,e.useCallback)((e=>{if(e.preventDefault(),l){let e=u;P.J3(u)&&(e=`/ipfs/${u}`),n({path:e}),o("")}}),[l,u,n]);return(0,R.jsxs)("div",{"data-id":"FilesExploreForm",className:"sans-serif black-80 flex",children:[(0,R.jsx)("div",{className:"flex-auto",children:(0,R.jsxs)("div",{className:"relative",children:[(0,R.jsx)("input",{id:"ipfs-path",className:`input-reset bn pa2 mb2 db w-100 f6 br-0 placeholder-light ${c}`,style:{borderRadius:"3px 0 0 3px"},type:"text",placeholder:"QmHash/bafyHash","aria-describedby":"ipfs-path-desc",onChange:e=>{o(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&h(e)},value:r}),(0,R.jsx)("small",{id:"ipfs-path-desc",className:"o-0 absolute f6 black-60 db mb2",children:"Paste in a CID or IPFS path"})]})}),(0,R.jsxs)("div",{className:"flex flex-row-reverse mb2",children:[(0,R.jsxs)(_.A,{minWidth:0,disabled:!l,danger:!l,title:s("app:actions.inspect"),style:{borderRadius:"0 3px 3px 0"},onClick:f,bg:"bg-teal",className:"ExploreFormButton button-reset pv1 ph2 ba f7 fw4 white overflow-hidden tc",children:[(0,R.jsx)(S.A,{style:{height:"2em"},className:"dib fill-current-color v-mid"}),(0,R.jsx)("span",{className:"ml2",children:s("app:actions.inspect")})]}),(0,R.jsxs)(_.A,{minWidth:0,disabled:!l,danger:!l,style:{borderRadius:"0"},title:s("app:actions.browse"),onClick:h,className:"ExploreFormButton button-reset pv1 ph2 ba f7 fw4 white bg-gray overflow-hidden tc",children:[(0,R.jsx)(F.A,{style:{height:"2em"},className:"dib fill-current-color v-mid"}),(0,R.jsx)("span",{className:"ml2",children:s("app:actions.browse")})]})]})]})};class M extends e.Component{constructor(e){super(e),this.addFiles=async e=>{const{doFilesWrite:t,doUpdateHash:n,routeInfo:r,filesPathInfo:o}=this.props,i="/files*"===r.pattern,s=i?(null===o||void 0===o?void 0:o.realPath)||r.params.path:"/",a=await e;t((0,u.Vl)(a),s),i||n("/files")},this.handleJoyrideCb=e=>{"close"===e.action&&this.props.doDisableTooltip()},e.doSetupLocalStorage()}componentDidMount(){this.props.doTryInitIpfs()}render(){const{t:t,route:n,ipfsReady:r,doFilesNavigateTo:o,routeInfo:{url:a},connectDropTarget:u,canDrop:l,isOver:c,showTooltip:d}=this.props;return u(e.createElement("div",{className:"sans-serif h-100 relative",onClick:i(this.props.doUpdateUrl)},l&&c&&e.createElement("div",{className:"h-100 top-0 right-0 fixed appOverlay",style:{background:"rgba(99, 202, 210, 0.2)"}}),e.createElement("div",{className:"flex flex-row-reverse-l flex-column-reverse justify-end justify-start-l",style:{minHeight:"100vh"}},e.createElement("div",{className:"flex-auto-l"},e.createElement("div",{className:"flex items-center ph3 ph4-l",style:{WebkitAppRegion:"drag",height:75,background:"#F0F6FA",paddingTop:"20px",paddingBottom:"15px"}},e.createElement("div",{className:"joyride-app-explore",style:{width:560}},e.createElement(U,{onBrowse:o})),e.createElement("div",{className:"dn flex-ns flex-auto items-center justify-end"},e.createElement(N,null),e.createElement(D,{className:"joyride-app-status"}))),e.createElement("main",{className:"bg-white pv3 pa3 pa4-l"},r||"/welcome"===a||a.startsWith("/settings")?e.createElement(n,null):e.createElement(x.A,null))),e.createElement("div",{className:"navbar-container flex-none-l bg-navy"},e.createElement(k,null))),e.createElement(s.Ay,{run:d,steps:f.MQ.getSteps({t:t}),styles:f.MQ.styles,callback:this.handleJoyrideCb,scrollToFirstStep:!0,disableOverlay:!0,locale:(0,h.Y)(t)}),e.createElement(B,null)))}}const j=(0,l.DropTarget)(c.FILE,{drop:(e,t,n)=>{if(t.didDrop())return;const{filesPromise:r}=t.getItem();n.addFiles(r)},canDrop:e=>!e.filesPathInfo||e.filesPathInfo.isMfs},((e,t)=>({connectDropTarget:e.dropTarget(),isOver:t.isOver(),canDrop:t.canDrop()})))(M),$=(0,r.N)("selectRoute","selectRouteInfo","selectIpfsReady","selectShowTooltip","doFilesNavigateTo","doUpdateUrl","doUpdateHash","doSetupLocalStorage","doTryInitIpfs","doFilesWrite","doDisableTooltip","selectFilesPathInfo",(0,a.CI)("app")(j));var H=n(7766),z=n(9909);const V={idleTimeout:2e3,idleAction:"APP_IDLE",stopWhenTabInactive:!1},G={timeout:500},W=e=>({name:"appIdle",init:t=>{const n=Object.assign({},V,e),{idleAction:r,idleTimeout:o}=n;let i;var s,a,u;o&&(s=n.stopWhenTabInactive,a=o,u=()=>t.dispatch({type:r}),i=(0,H.sg)((()=>{s?(0,H.er)((()=>(0,H.VO)(u,G))):(0,H.VO)(u,G)}),a));const l=()=>{i&&i()};t.subscribe(l),l()}});const q=function(e){return(e=e||{}).windowSize=e.windowSize||864e5,{name:"nodeBandwidthChart",reducer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{data:{in:[],out:[]}},t=arguments.length>1?arguments[1]:void 0;return"NODE_BANDWIDTH_CHART_DATA_UPDATED"===t.type?{...e,data:t.payload.chartData}:e},selectNodeBandwidthChartData:e=>e.nodeBandwidthChart.data,doUpdateNodeBandwidthChartData:(t,n,r)=>o=>{let{dispatch:i}=o;const s=(r={in:r.in.concat({x:n,y:parseInt(t.rateIn.toFixed(0),10)}),out:r.out.concat({x:n,y:parseInt(-1*t.rateOut.toFixed(0),10)})}).in.findIndex((t=>t.x>=n-e.windowSize));s>0&&(r.in=r.in.slice(s),r.out=r.out.slice(s)),i({type:"NODE_BANDWIDTH_CHART_DATA_UPDATED",payload:{chartData:r}})},reactUpdateNodeBandwidthChartData:(0,H.Mz)("selectNodeBandwidth","selectNodeBandwidthLastSuccess","selectNodeBandwidthEnabled","selectNodeBandwidthChartData",((e,t,n,r)=>{if(e&&n)return!r.in.length||t>r.in[r.in.length-1].x?{actionCreator:"doUpdateNodeBandwidthChartData",args:[e,t,r]}:void 0}))}};var K=n(638),Z=n.n(K),Y=n(8760),J=n.n(Y);const X=(0,H.re)({name:"nodeBandwidth",actionBaseType:"NODE_BANDWIDTH",getPromise:async e=>{let{getIpfs:t}=e;try{return await J()(t().stats.bw())}catch(n){if(/bandwidth reporter disabled in config/.test(n))return{disabled:!0};throw n}},staleAfter:Z().seconds(3),retryAfter:Z().seconds(3),persist:!1,checkIfOnline:!1});X.selectNodeBandwidthEnabled=e=>!!e.nodeBandwidth.data&&!e.nodeBandwidth.data.disabled,X.selectNodeBandwidthLastSuccess=e=>e.nodeBandwidth.lastSuccess,X.reactNodeBandwidthFetchWhenIdle=(0,H.Mz)("selectNodeBandwidthShouldUpdate","selectIpfsReady",((e,t)=>{if(e&&t)return{actionCreator:"doFetchNodeBandwidth"}}));const Q=X;var ee=n(2831);const te=Z().seconds(10),ne=(0,H.re)({name:"peers",actionBaseType:"PEERS",getPromise:e=>{let{getIpfs:t}=e;return t().swarm.peers({verbose:!0,timeout:te})},staleAfter:te,persist:!1,checkIfOnline:!1}),re=ne.reducer;ne.reducer=(e,t)=>{const n=re(e,t);return"SET_SELECTED_PEER"===t.type?{...n,selectedPeers:t.payload}:n},ne.selectPeersCount=(0,H.Mz)("selectPeers",(e=>Array.isArray(e)?e.length:0)),ne.doConnectSwarm=(e,t)=>async n=>{let{dispatch:r,getIpfs:o,store:i}=n;r({type:"SWARM_CONNECT_STARTED",payload:{addr:e}});const s=o();try{if(await s.swarm.connect(e),t){const t=(0,ee.HZ)(e),n=t.getPeerId(),r=t.decapsulateCode(421).toString();let o=await s.config.get("Peering.Peers")||[];const a=o.find((e=>e.ID===n));a?a.Addrs.find((e=>e===r))||a.Addrs.push(r):o=[...o,{ID:n,Addrs:[r]}],await s.config.set("Peering.Peers",o),await i.doMarkConfigAsOutdated()}}catch(a){return r({type:"SWARM_CONNECT_FAILED",payload:{addr:e,error:a}})}return r({type:"SWARM_CONNECT_FINISHED",payload:{addr:e}})},ne.reactPeersFetchWhenIdle=(0,H.Mz)("selectPeersShouldUpdate","selectIpfsConnected",((e,t)=>{if(e&&t)return{actionCreator:"doFetchPeers"}})),ne.reactPeersFetchWhenActive=(0,H.Mz)("selectAppTime","selectRouteInfo","selectPeersRaw","selectIpfsConnected",((e,t,n,r,o)=>{const i=n.lastSuccess||0;if("/peers"===t.url&&o&&!n.isLoading&&e-i>Z().seconds(5))return{actionCreator:"doFetchPeers"}})),ne.selectSelectedPeers=e=>e.peers.selectedPeers,ne.doSetSelectedPeers=e=>t=>{let{dispatch:n}=t;n({type:"SET_SELECTED_PEER",payload:e})};const oe=ne;function ie(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function se(e,t){const n=function(){if(navigator.userAgentData||!/Safari\//.test(navigator.userAgent)||/Chrom(e|ium)\//.test(navigator.userAgent)||!indexedDB.databases)return Promise.resolve();let e;return new Promise((t=>{const n=()=>indexedDB.databases().finally(t);e=setInterval(n,100),n()})).finally((()=>clearInterval(e)))}().then((()=>{const n=indexedDB.open(e);return n.onupgradeneeded=()=>n.result.createObjectStore(t),ie(n)}));return(e,r)=>n.then((n=>r(n.transaction(t,e).objectStore(t))))}let ae;function ue(){return ae||(ae=se("keyval-store","keyval")),ae}function le(e,t){return e("readonly",(e=>(e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},ie(e.transaction))))}var ce={__proto__:null,clear:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue())("readwrite",(e=>(e.clear(),ie(e.transaction))))},createStore:se,del:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue())("readwrite",(t=>(t.delete(e),ie(t.transaction))))},entries:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue();const t=[];return le(e,(e=>t.push([e.key,e.value]))).then((()=>t))},get:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue())("readonly",(t=>ie(t.get(e))))},getMany:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue())("readonly",(t=>Promise.all(e.map((e=>ie(t.get(e)))))))},keys:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue();const t=[];return le(e,(e=>t.push(e.key))).then((()=>t))},promisifyRequest:ie,set:function(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:ue())("readwrite",(n=>(n.put(t,e),ie(n.transaction))))},setMany:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue())("readwrite",(t=>(e.forEach((e=>t.put(e[1],e[0]))),ie(t.transaction))))},update:function(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:ue())("readwrite",(n=>new Promise(((r,o)=>{n.get(e).onsuccess=function(){try{n.put(t(this.result),e),r(ie(n.transaction))}catch(i){o(i)}}}))))},values:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue();const t=[];return le(e,(e=>t.push(e.value))).then((()=>t))}},fe={maxAge:1/0,version:0,lib:ce},he=function(e){return Object.assign({},fe,e)},de=function(e,t,n){var r=he(t),o=r.maxAge,i=r.version,s=r.lib;return s.get(e,n).then(JSON.parse).then((function(t){return Date.now()-t.time>o||i!==t.version?(s.del(e,n),null):t.data})).catch((function(){return null}))},pe=function(e){var t,n=he(e);return n.name&&(t=se(n.name,n.name)),{get:function(e){return de(e,n,t)},set:function(e,r){return function(e,t,n,r){var o=he(n),i=o.lib,s=o.version;return i.set(e,JSON.stringify({version:s,time:Date.now(),data:t}),r).catch((function(){return null}))}(e,r,n,t)},getAll:function(){return function(e,t){var n,r=he(e);return r.lib.keys(t).then((function(e){return n=e,Promise.all(n.map((function(e){return de(e,r,t)})))})).then((function(e){return e.reduce((function(e,t,r){return t&&(e[n[r]]=t),e}),{})})).catch((function(){}))}(n,t)},del:function(e){return n.lib.del(e,t)},clear:function(){return n.lib.clear(t)},keys:function(){return n.lib.keys(t)}}},ge=Object.create,ye=Object.defineProperty,me=Object.getOwnPropertyDescriptor,be=Object.getOwnPropertyNames,ve=Object.getPrototypeOf,we=Object.prototype.hasOwnProperty,Ee=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ae=(e,t,n)=>(n=null!=e?ge(ve(e)):{},((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let o of be(t))!we.call(e,o)&&o!==n&&ye(e,o,{get:()=>t[o],enumerable:!(r=me(t,o))||r.enumerable});return e})(!t&&e&&e.__esModule?n:ye(n,"default",{value:e,enumerable:!0}),e)),Ce=Ee((e=>{e.byteLength=function(e){var t=s(e),n=t[0],r=t[1];return 3*(n+r)/4-r},e.toByteArray=function(e){var t,n,i=s(e),a=i[0],u=i[1],l=new o(function(e,t,n){return 3*(t+n)/4-n}(0,a,u)),c=0,f=u>0?a-4:a;for(n=0;n<f;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;return 2===u&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,l[c++]=255&t),1===u&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t),l},e.fromByteArray=function(e){for(var t,r=e.length,o=r%3,i=[],s=16383,a=0,l=r-o;a<l;a+=s)i.push(u(e,a,a+s>l?l:a+s));return 1===o?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===o&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),i.join("")};var t,n=[],r=[],o=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=0,64;t<64;++t)n[t]=i[t],r[i.charCodeAt(t)]=t;function s(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function a(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function u(e,t,n){for(var r,o=[],i=t;i<n;i+=3)r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(a(r));return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63})),Se=Ee((e=>{e.read=function(e,t,n,r,o){var i,s,a=8*o-r-1,u=(1<<a)-1,l=u>>1,c=-7,f=n?o-1:0,h=n?-1:1,d=e[t+f];for(f+=h,i=d&(1<<-c)-1,d>>=-c,c+=a;c>0;i=256*i+e[t+f],f+=h,c-=8);for(s=i&(1<<-c)-1,i>>=-c,c+=r;c>0;s=256*s+e[t+f],f+=h,c-=8);if(0===i)i=1-l;else{if(i===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),i-=l}return(d?-1:1)*s*Math.pow(2,i-r)},e.write=function(e,t,n,r,o,i){var s,a,u,l=8*i-o-1,c=(1<<l)-1,f=c>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:i-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(s++,u/=2),s+f>=c?(a=0,s=c):s+f>=1?(a=(t*u-1)*Math.pow(2,o),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,o),s=0));o>=8;e[n+d]=255&a,d+=p,a/=256,o-=8);for(s=s<<o|a,l+=o;l>0;e[n+d]=255&s,d+=p,s/=256,l-=8);e[n+d-p]|=128*g}})),Te=Ee((e=>{var t=Ce(),n=Se(),r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=s,e.SlowBuffer=function(e){return+e!=e&&(e=0),s.alloc(+e)},e.INSPECT_MAX_BYTES=50;var o=2147483647;function i(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}return a(e,t,n)}function a(e,t,n){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);let n=0|d(e,t),r=i(n),o=r.write(e,t);return o!==n&&(r=r.slice(0,o)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(q(e,Uint8Array)){let t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return c(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(q(e,ArrayBuffer)||e&&q(e.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(q(e,SharedArrayBuffer)||e&&q(e.buffer,SharedArrayBuffer)))return f(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');let r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return s.from(r,t,n);let o=function(e){if(s.isBuffer(e)){let t=0|h(e.length),n=i(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||K(e.length)?i(0):c(e);if("Buffer"===e.type&&Array.isArray(e.data))return c(e.data)}(e);if(o)return o;if(typeof Symbol<"u"&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return u(e),i(e<0?0:0|h(e))}function c(e){let t=e.length<0?0:0|h(e.length),n=i(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,s.prototype),r}function h(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function d(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||q(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let o=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(e).length;default:if(o)return r?-1:V(e).length;t=(""+t).toLowerCase(),o=!0}}function p(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0)||(n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return x(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),K(n=+n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,o){let i,s=1,a=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){let r=-1;for(i=n;i<a;i++)if(l(e,i)===l(t,-1===r?0:i-r)){if(-1===r&&(r=i),i-r+1===u)return r*s}else-1!==r&&(i-=i-r),r=-1}else for(n+u>a&&(n=a-u),i=n;i>=0;i--){let n=!0;for(let r=0;r<u;r++)if(l(e,i+r)!==l(t,r)){n=!1;break}if(n)return i}return-1}function b(e,t,n,r){n=Number(n)||0;let o=e.length-n;r?(r=Number(r))>o&&(r=o):r=o;let i,s=t.length;for(r>s/2&&(r=s/2),i=0;i<r;++i){let r=parseInt(t.substr(2*i,2),16);if(K(r))return i;e[n+i]=r}return i}function v(e,t,n,r){return W(V(t,e.length-n),e,n,r)}function w(e,t,n,r){return W(function(e){let t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return W(G(t),e,n,r)}function A(e,t,n,r){return W(function(e,t){let n,r,o,i=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(t,e.length-n),e,n,r)}function C(e,n,r){return 0===n&&r===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,r))}function S(e,t,n){n=Math.min(e.length,n);let r=[],o=t;for(;o<n;){let t=e[o],i=null,s=t>239?4:t>223?3:t>191?2:1;if(o+s<=n){let n,r,a,u;switch(s){case 1:t<128&&(i=t);break;case 2:n=e[o+1],128===(192&n)&&(u=(31&t)<<6|63&n,u>127&&(i=u));break;case 3:n=e[o+1],r=e[o+2],128===(192&n)&&128===(192&r)&&(u=(15&t)<<12|(63&n)<<6|63&r,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:n=e[o+1],r=e[o+2],a=e[o+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(u=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&a,u>65535&&u<1114112&&(i=u))}}null===i?(i=65533,s=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),o+=s}return function(e){let t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=T));return n}(r)}e.kMaxLength=o,s.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch{return!1}}(),!s.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,n){return a(e,t,n)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,n){return function(e,t,n){return u(e),e<=0?i(e):void 0!==t?"string"==typeof n?i(e).fill(t,n):i(e).fill(t):i(e)}(e,t,n)},s.allocUnsafe=function(e){return l(e)},s.allocUnsafeSlow=function(e){return l(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(q(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),q(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let r=s.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){let t=e[n];if(q(t,Uint8Array))o+t.length>r.length?(s.isBuffer(t)||(t=s.from(t)),t.copy(r,o)):Uint8Array.prototype.set.call(r,t,o);else{if(!s.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,o)}o+=t.length}return r},s.byteLength=d,s.prototype._isBuffer=!0,s.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)g(this,t,t+1);return this},s.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},s.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},s.prototype.toString=function(){let e=this.length;return 0===e?"":0===arguments.length?S(this,0,e):p.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){let t="",n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(e,t,n,r,o){if(q(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(this===e)return 0;let i=(o>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),u=Math.min(i,a),l=this.slice(r,o),c=e.slice(t,n);for(let s=0;s<u;++s)if(l[s]!==c[s]){i=l[s],a=c[s];break}return i<a?-1:a<i?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}let o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let i=!1;for(;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":case"latin1":case"binary":return w(this,e,t,n);case"base64":return E(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function k(e,t,n){let r="";n=Math.min(e.length,n);for(let o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function x(e,t,n){let r="";n=Math.min(e.length,n);for(let o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function I(e,t,n){let r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let o="";for(let i=t;i<n;++i)o+=Z[e[i]];return o}function O(e,t,n){let r=e.slice(t,n),o="";for(let i=0;i<r.length-1;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function B(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,n,r,o,i){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function N(e,t,n,r,o){j(t,r,o,e,n,7);let i=Number(t&BigInt(4294967295));e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function P(e,t,n,r,o){j(t,r,o,e,n,7);let i=Number(t&BigInt(4294967295));e[n+7]=i,i>>=8,e[n+6]=i,i>>=8,e[n+5]=i,i>>=8,e[n+4]=i;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function F(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function _(e,t,r,o,i){return t=+t,r>>>=0,i||F(e,0,r,4),n.write(e,t,r,o,23,4),r+4}function L(e,t,r,o,i){return t=+t,r>>>=0,i||F(e,0,r,8),n.write(e,t,r,o,52,8),r+8}s.prototype.slice=function(e,t){let n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);let r=this.subarray(e,t);return Object.setPrototypeOf(r,s.prototype),r},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);let r=this[e],o=1,i=0;for(;++i<t&&(o*=256);)r+=this[e+i]*o;return r},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);let r=this[e+--t],o=1;for(;t>0&&(o*=256);)r+=this[e+--t]*o;return r},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readBigUInt64LE=Y((function(e){$(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&H(e,this.length-8);let r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,o=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(o)<<BigInt(32))})),s.prototype.readBigUInt64BE=Y((function(e){$(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&H(e,this.length-8);let r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],o=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(o)})),s.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);let r=this[e],o=1,i=0;for(;++i<t&&(o*=256);)r+=this[e+i]*o;return o*=128,r>=o&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);let r=t,o=1,i=this[e+--r];for(;r>0&&(o*=256);)i+=this[e+--r]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*t)),i},s.prototype.readInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||B(e,2,this.length);let n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){e>>>=0,t||B(e,2,this.length);let n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readBigInt64LE=Y((function(e){$(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&H(e,this.length-8);let r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),s.prototype.readBigInt64BE=Y((function(e){$(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&H(e,this.length-8);let r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),s.prototype.readFloatLE=function(e,t){return e>>>=0,t||B(e,4,this.length),n.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||B(e,4,this.length),n.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||B(e,8,this.length),n.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||B(e,8,this.length),n.read(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){D(this,e,t,n,Math.pow(2,8*n)-1,0)}let o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){D(this,e,t,n,Math.pow(2,8*n)-1,0)}let o=n-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+n},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigUInt64LE=Y((function(e,t=0){return N(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),s.prototype.writeBigUInt64BE=Y((function(e,t=0){return P(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){let r=Math.pow(2,8*n-1);D(this,e,t,n,r-1,-r)}let o=0,i=1,s=0;for(this[t]=255&e;++o<n&&(i*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/i|0)-s&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){let r=Math.pow(2,8*n-1);D(this,e,t,n,r-1,-r)}let o=n-1,i=1,s=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/i|0)-s&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigInt64LE=Y((function(e,t=0){return N(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),s.prototype.writeBigInt64BE=Y((function(e,t=0){return P(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),s.prototype.writeFloatLE=function(e,t,n){return _(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return _(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!r&&0!==r&&(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);let o=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),o},s.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){let t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{let i=s.isBuffer(e)?e:s.from(e,r),a=i.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=i[o%a]}return this};var R={};function U(e,t,n){R[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function M(e){let t="",n=e.length,r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function j(e,t,n,r,o,i){if(e>n||e<t){let r,o="bigint"==typeof t?"n":"";throw r=i>3?0===t||t===BigInt(0)?`>= 0${o} and < 2${o} ** ${8*(i+1)}${o}`:`>= -(2${o} ** ${8*(i+1)-1}${o}) and < 2 ** ${8*(i+1)-1}${o}`:`>= ${t}${o} and <= ${n}${o}`,new R.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){$(t,"offset"),(void 0===e[t]||void 0===e[t+n])&&H(t,e.length-(n+1))}(r,o,i)}function $(e,t){if("number"!=typeof e)throw new R.ERR_INVALID_ARG_TYPE(t,"number",e)}function H(e,t,n){throw Math.floor(e)!==e?($(e,n),new R.ERR_OUT_OF_RANGE(n||"offset","an integer",e)):t<0?new R.ERR_BUFFER_OUT_OF_BOUNDS:new R.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}U("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),U("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),U("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,o=n;return Number.isInteger(n)&&Math.abs(n)>2**32?o=M(String(n)):"bigint"==typeof n&&(o=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(o=M(o)),o+="n"),r+=` It must be ${t}. Received ${o}`,r}),RangeError);var z=/[^+/0-9A-Za-z-_]/g;function V(e,t){t=t||1/0;let n,r=e.length,o=null,i=[];for(let s=0;s<r;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function G(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(z,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function W(e,t,n,r){let o;for(o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}function q(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function K(e){return e!==e}var Z=function(){let e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){let r=16*n;for(let o=0;o<16;++o)t[r+o]=e[n]+e[o]}return t}();function Y(e){return typeof BigInt>"u"?J:e}function J(){throw new Error("BigInt not supported")}})),ke=Ee((()=>{})),xe=Ee((e=>{var t=e,{Buffer:n}=Te(),r=ke();t.toBuffer=function(e,t,r){let o;if(r=~~r,this.isV4Format(e))o=t||n.alloc(r+4),e.split(/\./g).map((e=>{o[r++]=255&parseInt(e,10)}));else if(this.isV6Format(e)){let i,s=e.split(":",8);for(i=0;i<s.length;i++){let e;this.isV4Format(s[i])&&(e=this.toBuffer(s[i]),s[i]=e.slice(0,2).toString("hex")),e&&++i<8&&s.splice(i,0,e.slice(2,4).toString("hex"))}if(""===s[0])for(;s.length<8;)s.unshift("0");else if(""===s[s.length-1])for(;s.length<8;)s.push("0");else if(s.length<8){for(i=0;i<s.length&&""!==s[i];i++);let e=[i,1];for(i=9-s.length;i>0;i--)e.push("0");s.splice(...e)}for(o=t||n.alloc(r+16),i=0;i<s.length;i++){let e=parseInt(s[i],16);o[r++]=e>>8&255,o[r++]=255&e}}if(!o)throw Error(`Invalid ip address: ${e}`);return o},t.toString=function(e,t,n){t=~~t;let r=[];if(4===(n=n||e.length-t)){for(let o=0;o<n;o++)r.push(e[t+o]);r=r.join(".")}else if(16===n){for(let o=0;o<n;o+=2)r.push(e.readUInt16BE(t+o).toString(16));r=r.join(":"),r=r.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),r=r.replace(/:{3,4}/,"::")}return r};var o=/^(\d{1,3}\.){3,3}\d{1,3}$/,i=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;function s(e){return 4===e?"ipv4":6===e?"ipv6":e?e.toLowerCase():"ipv4"}t.isV4Format=function(e){return o.test(e)},t.isV6Format=function(e){return i.test(e)},t.fromPrefixLen=function(e,r){let o=4;"ipv6"===(r=e>32?"ipv6":s(r))&&(o=16);let i=n.alloc(o);for(let t=0,n=i.length;t<n;++t){let n=8;e<8&&(n=e),e-=n,i[t]=255&~(255>>n)}return t.toString(i)},t.mask=function(e,r){e=t.toBuffer(e),r=t.toBuffer(r);let o,i=n.alloc(Math.max(e.length,r.length));if(e.length===r.length)for(o=0;o<e.length;o++)i[o]=e[o]&r[o];else if(4===r.length)for(o=0;o<r.length;o++)i[o]=e[e.length-4+o]&r[o];else{for(o=0;o<i.length-6;o++)i[o]=0;for(i[10]=255,i[11]=255,o=0;o<e.length;o++)i[o+12]=e[o]&r[o+12];o+=12}for(;o<i.length;o++)i[o]=0;return t.toString(i)},t.cidr=function(e){let n=e.split("/"),r=n[0];if(2!==n.length)throw new Error(`invalid CIDR subnet: ${r}`);let o=t.fromPrefixLen(parseInt(n[1],10));return t.mask(r,o)},t.subnet=function(e,n){let r=t.toLong(t.mask(e,n)),o=t.toBuffer(n),i=0;for(let t=0;t<o.length;t++)if(255===o[t])i+=8;else{let e=255&o[t];for(;e;)e=e<<1&255,i++}let s=2**(32-i);return{networkAddress:t.fromLong(r),firstAddress:s<=2?t.fromLong(r):t.fromLong(r+1),lastAddress:s<=2?t.fromLong(r+s-1):t.fromLong(r+s-2),broadcastAddress:t.fromLong(r+s-1),subnetMask:n,subnetMaskLength:i,numHosts:s<=2?s:s-2,length:s,contains:e=>r===t.toLong(t.mask(e,n))}},t.cidrSubnet=function(e){let n=e.split("/"),r=n[0];if(2!==n.length)throw new Error(`invalid CIDR subnet: ${r}`);let o=t.fromPrefixLen(parseInt(n[1],10));return t.subnet(r,o)},t.not=function(e){let n=t.toBuffer(e);for(let t=0;t<n.length;t++)n[t]=255^n[t];return t.toString(n)},t.or=function(e,n){if(e=t.toBuffer(e),n=t.toBuffer(n),e.length===n.length){for(let t=0;t<e.length;++t)e[t]|=n[t];return t.toString(e)}let r=e,o=n;n.length>e.length&&(r=n,o=e);let i=r.length-o.length;for(let t=i;t<r.length;++t)r[t]|=o[t-i];return t.toString(r)},t.isEqual=function(e,n){if(e=t.toBuffer(e),n=t.toBuffer(n),e.length===n.length){for(let t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}if(4===n.length){let t=n;n=e,e=t}for(let t=0;t<10;t++)if(0!==n[t])return!1;let r=n.readUInt16BE(10);if(0!==r&&65535!==r)return!1;for(let t=0;t<4;t++)if(e[t]!==n[t+12])return!1;return!0},t.isPrivate=function(e){return/^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^f[cd][0-9a-f]{2}:/i.test(e)||/^fe80:/i.test(e)||/^::1$/.test(e)||/^::$/.test(e)},t.isPublic=function(e){return!t.isPrivate(e)},t.isLoopback=function(e){return/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})/.test(e)||/^fe80::1$/.test(e)||/^::1$/.test(e)||/^::$/.test(e)},t.loopback=function(e){if("ipv4"!==(e=s(e))&&"ipv6"!==e)throw new Error("family must be ipv4 or ipv6");return"ipv4"===e?"127.0.0.1":"fe80::1"},t.address=function(e,n){let o=r.networkInterfaces();if(n=s(n),e&&"private"!==e&&"public"!==e){let t=o[e].filter((e=>s(e.family)===n));return 0===t.length?void 0:t[0].address}let i=Object.keys(o).map((r=>{let i=o[r].filter((r=>(r.family=s(r.family),r.family===n&&!t.isLoopback(r.address)&&(!e||("public"===e?t.isPrivate(r.address):t.isPublic(r.address))))));return i.length?i[0].address:void 0})).filter(Boolean);return i.length?i[0]:t.loopback(n)},t.toLong=function(e){let t=0;return e.split(".").forEach((e=>{t<<=8,t+=parseInt(e)})),t>>>0},t.fromLong=function(e){return`${e>>>24}.${e>>16&255}.${e>>8&255}.${255&e}`}})),Ie=Ee(((e,t)=>{var n,r=typeof self<"u"?self:e,o=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();n=o,function(e){var t="URLSearchParams"in n,r="Symbol"in n&&"iterator"in Symbol,o="FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch{return!1}}(),i="FormData"in n,s="ArrayBuffer"in n;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function l(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function g(e){var t=new FileReader,n=p(t);return t.readAsArrayBuffer(e),n}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:o&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:t&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&o&&function(e){return e&&DataView.prototype.isPrototypeOf(e)}(e)?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,n=p(t);return t.readAsText(e),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=l(e),t=c(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},h.prototype.delete=function(e){delete this.map[l(e)]},h.prototype.get=function(e){return e=l(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(l(e))},h.prototype.set=function(e,t){this.map[l(e)]=c(t)},h.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),f(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),f(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),f(e)},r&&(h.prototype[Symbol.iterator]=h.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v(e,t){var n=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!n&&null!=e._bodyInit&&(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new h(t.headers)),this.method=function(e){var t=e.toUpperCase();return b.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function w(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(o))}})),t}function E(e){var t=new h;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var o=n.join(":").trim();t.append(r,o)}})),t}function A(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},m.call(v.prototype),m.call(A.prototype),A.prototype.clone=function(){return new A(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},A.error=function(){var e=new A(null,{status:0,statusText:""});return e.type="error",e};var C=[301,302,303,307,308];A.redirect=function(e,t){if(-1===C.indexOf(t))throw new RangeError("Invalid status code");return new A(null,{status:t,headers:{location:e}})},e.DOMException=n.DOMException;try{new e.DOMException}catch{e.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function S(t,n){return new Promise((function(r,i){var s=new v(t,n);if(s.signal&&s.signal.aborted)return i(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e={status:a.status,statusText:a.statusText,headers:E(a.getAllResponseHeaders()||"")};e.url="responseURL"in a?a.responseURL:e.headers.get("X-Request-URL");var t="response"in a?a.response:a.responseText;r(new A(t,e))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new e.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"i